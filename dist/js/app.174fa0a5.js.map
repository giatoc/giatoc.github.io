{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue","webpack:///./src/components/FamilyChart.vue","webpack:///./src/components/FamilyChart.vue?890d","webpack:///./src/App.vue?dfb6","webpack:///./src/main.js","webpack:///./src/components/family-chart/dist/family-chart.js","webpack:///./src/App.vue?3f7e"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","id","class","style","mounted","cont","document","querySelector","store","createStore","node_separation","level_separation","svg","createSvg","Card","elements","card_dim","w","h","text_x","text_y","img_w","img_h","img_x","img_y","card_display","mini_tree","link_break","setOnUpdate","props","view","getTree","updateTree","initial","render","components","FamilyChart","createApp","App","mount","global","factory","_typeof","require","define","this","_d3","_interopNamespace","e","keys","forEach","k","getOwnPropertyDescriptor","freeze","_d3__namespace","d3","sortChildrenWithSpouses","datum","rels","children","sort","a","b","a_d","find","b_d","a_p2","otherParent","b_p2","a_i","spouses","indexOf","b_i","gender","p1","d0","mother","father","calculateEnterAndExitPositions","entering","exiting","depth","spouse","_x","x","_y","y","is_ancestry","parent","psx","toggleRels","tree_datum","hide_rels","rels_","showHideAncestry","rel_type","showHideChildren","concat","_toConsumableArray","sp","ch_id","includes","main","toggleAllRels","tree_data","checkIfRelativesConnectedWithoutPerson","data_stash","r_ids","filter","r_id","rels_not_to_main","_loop","line","findPersonLineToMain","_ret","without_persons","isM","checkIfAnyRelIsMain","history","runAllRels","f","d_id","check","checkRels","person","createForm","_ref","fields","postSubmit","addRelative","deletePerson","onCancel","editFirst","form_creator","onSubmit","submitFormChanges","_new_rel_data","onDelete","deletePersonWithPostSubmit","activate","addRelativeCancel","addRelativeActive","is_active","editable","title","label","new_rel","can_delete","getData","gender_field","type","initial_value","options","field","preventDefault","form_data","FormData","target","v","to_add","delete","moveToAddToAdded","removeToAdd","executeDelete","success","error","Array","isArray","findIndex","did","createTreeDataWithMainNode","cleanupDataJson","data_json","data_no_to_add","JSON","parse","stringify","handleRelsOfNewDatum","_ref2","rel_datum","addChild","other_parent","addChildToSpouseAndParentToChild","spouse_id","addOtherParent","new_spouse","createNewPersonWithGenderFromRel","addSpouse","addNewPerson","addParent","is_father","parent_to_add_id","addNewParent","handleSpouse","removeIfToAdd","handleNewRel","_ref3","new_rel_datum","createNewPerson","child_id","child","_ref4","generateUUID","_ref5","getGenderFromRelative","assign","_ref6","_ref7","version","addNewPersonAndHandleRels","_ref8","Date","getTime","d2","performance","now","replace","Math","random","floor","toString","manualZoom","_ref9","amount","_ref9$transition_time","transition_time","zoom","__zoomObj","select","transition","duration","delay","scaleBy","isAllRelativeDisplayed","all_rels","every","rel_id","some","CalculateTree","_ref10","_ref10$main_id","main_id","_ref10$node_separatio","_ref10$level_separati","dim","width","height","is_vertical","createRelsToAdd","tree_children","calculateTreePositions","tree_parents","levelOutEachSide","tree","mergeSides","setupChildrenAndParents","setupSpouses","nodePositioning","all_rels_displayed","calculateTreeDim","rt","hierarchyGetter","hierarchyGetterChildren","hierarchyGetterParents","d3_tree","nodeSize","separation","root","hierarchy","descendants","offset","sameParent","someSpouses","offsetOnPartners","sameBothParents","hasSpouses","map","parents","mid_diff","_ref11","d_x","_ref12","_loop2","side","sp_id","added","sx","p2","midd","_ref13","d1","_ref14","w_extent","extent","h_extent","x_off","y_off","to_add_spouses","_loop3","createToAddSpouse","initial_state","onUpdate","state","main_id_history","calcTree","updateMainId","updateData","getMainId","getMainDatum","getDatum","getTreeMainDatum","getTreeDatum","getLastAvailableMainDatum","methods","reverse","positionTree","_ref15","_ref15$transition_tim","el_listener","parentNode","transform","zoomIdentity","scale","translate","treeFit","_ref16","svg_dim","tree_dim","with_transition","calculateTreeFit","min","cardToMiddle","_ref17","createLinks","_ref18","links","handleAncestrySide","handleProgenySide","_ref19","getMid","Link","_d","_p","curve","linkId","source","_ref20","_or","_ref21","getRel","is_","hy","_len","arguments","args","_key","join","condition","dist_xy","sqrt","pow","pathToMain","cards","main_datum","links_data","links_node_to_main","cards_node_to_main","links_to_main","itteration1","_loop4","spouse_link","child_link","_ret2","each","link","node","cards_to_main","getCardsToMain","card","_loop5","sameArray","_ret3","arr1","arr2","first_parent","all_cards","reduce","acc","getChildren","createPath","curveMonotoneY","lineCurve","curveBasis","path_data","updateLinks","undefined","selectAll","link_exit","exit","link_enter","enter","append","attr","link_update","merge","linkEnter","linkUpdate","path","calculateDelay","linkExit","on","remove","updateCards","card_exit","card_enter","card_update","cardEnter","cardUpdateNoEnter","cardUpdate","cardExit","g","updateCardsHtml","div","assignUniqueIdToTreeData","unique_id","setupHtmlSvg","getHtmlSvg","getCardsViewFake","onZoomSetup","getSvgView","getHtmlView","setupReactiveTreeData","new_tree_data","tree_data_exit","getTreeDataExit","createHtmlSvg","f3Canvas","cardHtml","old_tree_data","getUniqueId","htmlHandlers","__proto__","updateCardsComponent","card_element","cardComponent","tree_position","getBoundingClientRect","delay_level","ancestry_levels","max","svg_html","getOrCreateF3Canvas","temp_div","innerHTML","appendChild","setupZoom","el","__zoom","onZoom","zoomed","zoom_polite","zoomFilter","ctrlKey","touches","cardChangeMain","_ref22","tree_fit_on_change","cardEdit","_ref23","cardEditForm","cardShowHideRels","_ref24","userIcon","bgCircle","userEditIcon","userPlusIcon","userPlusCloseIcon","plusIcon","pencilIcon","pencilOffIcon","trashIcon","historyBackIcon","historyForwardIcon","personIcon","miniTreeIcon","userSvgIcon","svgWrapper","userEditSvgIcon","userPlusSvgIcon","userPlusCloseSvgIcon","plusSvgIcon","pencilSvgIcon","pencilOffSvgIcon","trashSvgIcon","historyBackSvgIcon","historyForwardSvgIcon","personSvgIcon","miniTreeSvgIcon","icon","viewBox","match","dataIcon","icons","formInfoSetup","closeCallback","formContainer","createElement","update","formHtml","getHtml","setupEventListeners","form","addEventListener","cancel_btn","edit_btn","onEdit","delete_btn","add_relative_btn","close_btn","other_parent_field","display","closeBtn","no_edit","addRelativeBtn","spaceDiv","editBtn","genderRadio","otherParentField","deleteBtn","option","infoField","createHistory","getStoreData","history_index","changed","back","forward","canForward","canBack","clean_data","createHistoryControls","history_controls","back_btn","updateButtons","forward_btn","html","destroy","classed","handlers","CardBody","_ref25","template","CardText","_ref26","cd","CardBodyAddNew","_ref27","card_add","CardBodyOutline","_ref28","is_new","PencilIcon","_ref29","MiniTree","_ref30","PlusIcon","_ref31","LinkBreakIcon","_ref32","closed","LinkBreakIconWrapper","_ref33","_r","_rels","areParents","areChildren","sp_r","_sp_r","CardImage","_ref34","image","maleIcon","femaleIcon","GenderlessIcon","appendTemplate","is_first","createElementNS","insertBefore","firstChild","CardElements","miniTree","lineBreak","cardBody","cardImage","cardEditIcon","cardAdd","cardAddIcon","stopPropagation","onMiniTreeClick","unknown_lbl","onCardClick","avatar","appendElement","el_maybe","setupCardSvgDefs","curvedRectPath","no_curve_corners","ncc","ncc_check","corner","lx","rx","ry","ly","insertAdjacentHTML","updateCardSvgDefs","setupProps","_this","gender_class","img","onCardUpdates","fn","onCardUpdate","default_props","CardHtml","cardInner","cardInnerDefault","cardInnerImageCircleRect","cardInnerImageCircle","cardInnerImageRect","cardInnerRect","getClassList","getMiniTree","onCardMouseenter","onCardMouseleave","getCardInnerImageCircle","getCardStyle","getCardImageStyle","noImageIcon","textDisplay","getCardInnerImageRect","getCardInnerRect","newRelDataDisplay","attr_list","other_parent_id","class_list","height_auto","_len2","_key2","_construct","AddRelative","cancelCallback","onSubmitCallback","onChange","store_data","addRelLabels","addRelLabelsDefault","getDatumRelsData","datum_rels","getDatumRels","new_son","son","new_daughter","daughter","findRel","rel","findAndPushRel","editTree","_len3","_key3","EditTree","form_cont","is_fixed","init","createChart","_len4","_key4","CreateChart","getCard","is_card_html","beforeUpdate","afterUpdate","setCont","processCardDisplay","card_display_arr","CardSvgWrapper","_len5","_key5","CardSvg","onCardClickDefault","CardHtmlWrapper","_len6","_key6","CardHtml$1","updated_datum","console","setAddRelLabels","add_rel_labels","addRelativeInstance","setupAddRelative","open","openWithoutRelCancel","_this2","is_new_rel","openFormWithId","f3","_objectSpread","closeForm","updateHistory","openForm","fixed","absolute","setCardClickOpen","_this3","setOnCardClick","historyUpdateTree","controls","_this$store$getMainDa","setNoEdit","setEdit","setFields","new_fields","_step","_iterator","_createForOfIteratorHelper","done","err","setOnChange","setEditFirst","isAddingRelative","getDataJson","_this4","setCard","_ref35","_ref35$initial","setCardYSpacing","card_y_spacing","setCardXSpacing","card_x_spacing","is_html","setTransitionTime","updateMain","setBeforeUpdate","setAfterUpdate","_this5","setCardDisplay","setCardDim","val","setMiniTree","setLinkBreak","setCardTextSvg","cardTextSvg","card_node","card_text","card_text_g","_this6","setStyle","setOnCardUpdate","resetCardDim","setOnHoverPathToMain","onEnterPathToMain","onLeavePathToMain","unsetOnHoverPathToMain","_this7","to_transition","_pathToMain","_pathToMain2","_slicedToArray","abs"],"mappings":"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","file":"js/app.174fa0a5.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/family-tree/dist/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","<template>\n  <FamilyChart />\n</template>\n\n<script>\nimport FamilyChart from \"./components/FamilyChart.vue\";\nexport default {\n  name: \"App\",\n  components: {\n    FamilyChart,\n  },\n};\n</script>\n\n<style>\nhtml {\n  font-family: \"sans-serif\";\n}\n</style>\n","\n<template>\n  <div id=\"app\">\n    <div id=\"FamilyChart\" class=\"f3\" style=\"width:100%;height:900px;margin:auto;background-color:rgb(33,33,33);color:#fff;\"></div>\n  </div>\n</template>\n\n<script>\nimport ft from './data.json';\nimport f3 from \"./family-chart/dist/family-chart.js\";\nimport './family-chart.css';  // create file 'family-chart.css' in same directory, copy/paste css from examples/create-tree\n\nexport default {\n  mounted() {\n  // fetch('https://raw.githubusercontent.com/giatoc/family-tree/refs/heads/master/src/components/data.json')\n  // .then(res => res.json())\n  // .then(data => create(data))\n  // .catch(err => console.error(err))\n\n    create(data())\n\n    function create(data) {\n      const cont = document.querySelector(\"div#FamilyChart\")  // make sure to create div with id FamilyChart\n      const store = f3.createStore({\n        data,\n        node_separation: 250,\n        level_separation: 150\n      })\n      const svg = f3.createSvg(cont)\n      const Card = f3.elements.Card({\n        store,\n        svg,\n        card_dim: {w:220,h:70,text_x:75,text_y:15,img_w:60,img_h:60,img_x:5,img_y:5},\n        card_display: [d => `${d.data['first name'] || ''} ${d.data['last name'] || ''}`, d => `${d.data['birthday'] || ''}`],\n        mini_tree: true,\n        link_break: false\n      })\n\n      store.setOnUpdate(props => f3.view(store.getTree(), svg, Card, props || {}))\n      store.updateTree({initial: true})\n    }\n\n    function data() {\n      return ft\n    }\n  }\n};\n</script>\n<style></style>","import { render } from \"./FamilyChart.vue?vue&type=template&id=0e403f39&bindings={}\"\nimport script from \"./FamilyChart.vue?vue&type=script&lang=js\"\nexport * from \"./FamilyChart.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./App.vue?vue&type=template&id=37fb207f&bindings={}\"\nimport script from \"./App.vue?vue&type=script&lang=js\"\nexport * from \"./App.vue?vue&type=script&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&lang=css\"\nscript.render = render\n\nexport default script","import { createApp } from 'vue'\nimport App from './App.vue'\n\ncreateApp(App).mount('#app')\n","// https://donatso.github.io/family-chart/ v0.1.1 Copyright 2024 donatso\n(function (global, factory) {\ntypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('d3')) :\ntypeof define === 'function' && define.amd ? define(['d3'], factory) :\n(global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.f3 = factory(global.f3));\n}(this, (function (_d3) { 'use strict';\n\nfunction _interopNamespace(e) {\nif (e && e.__esModule) return e;\nvar n = Object.create(null);\nif (e) {\nObject.keys(e).forEach(function (k) {\nif (k !== 'default') {\nvar d = Object.getOwnPropertyDescriptor(e, k);\nObject.defineProperty(n, k, d.get ? d : {\nenumerable: true,\nget: function () {\nreturn e[k];\n}\n});\n}\n});\n}\nn['default'] = e;\nreturn Object.freeze(n);\n}\n\nvar _d3__namespace = /*#__PURE__*/_interopNamespace(_d3);\n\nvar d3 = typeof window === \"object\" && !!window.d3 ? window.d3 : _d3__namespace;\n\nfunction sortChildrenWithSpouses(data) {\n  data.forEach(datum => {\n    if (!datum.rels.children) return\n    datum.rels.children.sort((a, b) => {\n      const a_d = data.find(d => d.id === a),\n        b_d = data.find(d => d.id === b),\n        a_p2 = otherParent(a_d, datum, data) || {},\n        b_p2 = otherParent(b_d, datum, data) || {},\n        a_i = datum.rels.spouses.indexOf(a_p2.id),\n        b_i = datum.rels.spouses.indexOf(b_p2.id);\n\n      if (datum.data.gender === \"M\") return a_i - b_i\n      else return b_i - a_i\n    });\n  });\n}\n\nfunction otherParent(d, p1, data) {\n  return data.find(d0 => (d0.id !== p1.id) && ((d0.id === d.rels.mother) || (d0.id === d.rels.father)))\n}\n\nfunction calculateEnterAndExitPositions(d, entering, exiting) {\n  d.exiting = exiting;\n  if (entering) {\n    if (d.depth === 0 && !d.spouse) {d._x = d.x; d._y = d.y;}\n    else if (d.spouse) {d._x = d.spouse.x; d._y = d.spouse.y;}\n    else if (d.is_ancestry) {d._x = d.parent.x; d._y = d.parent.y;}\n    else {d._x = d.psx; d._y = d.parent.y;}\n  } else if (exiting) {\n    const x = d.x > 0 ? 1 : -1,\n      y = d.y > 0 ? 1 : -1;\n    {d._x = d.x+400*x; d._y = d.y+400*y;}\n  }\n}\n\nfunction toggleRels(tree_datum, hide_rels) {\n  const\n    rels = hide_rels ? 'rels' : '_rels',\n    rels_ = hide_rels ? '_rels' : 'rels';\n  \n  if (tree_datum.is_ancestry || tree_datum.data.main) {showHideAncestry('father'); showHideAncestry('mother');}\n  else {showHideChildren();}\n\n  function showHideAncestry(rel_type) {\n    if (!tree_datum.data[rels] || !tree_datum.data[rels][rel_type]) return\n    if (!tree_datum.data[rels_]) tree_datum.data[rels_] = {};\n    tree_datum.data[rels_][rel_type] = tree_datum.data[rels][rel_type];\n    delete tree_datum.data[rels][rel_type];\n  }\n\n  function showHideChildren() {\n    if (!tree_datum.data[rels] || !tree_datum.data[rels].children) return\n    const\n      children = tree_datum.data[rels].children.slice(0),\n      spouses = tree_datum.spouse ? [tree_datum.spouse] : tree_datum.spouses || [];\n\n    [tree_datum, ...spouses].forEach(sp => children.forEach(ch_id => {\n      if (sp.data[rels].children.includes(ch_id)) {\n        if (!sp.data[rels_]) sp.data[rels_] = {};\n        if (!sp.data[rels_].children) sp.data[rels_].children = [];\n        sp.data[rels_].children.push(ch_id);\n        sp.data[rels].children.splice(sp.data[rels].children.indexOf(ch_id), 1);\n      }\n    }));\n  }\n}\n\nfunction toggleAllRels(tree_data, hide_rels) {\n  tree_data.forEach(d => {d.data.hide_rels = hide_rels; toggleRels(d, hide_rels);});\n}\n\nfunction checkIfRelativesConnectedWithoutPerson(datum, data_stash) {\n  const r = datum.rels,\n    r_ids = [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])].filter(r_id => !!r_id),\n    rels_not_to_main = [];\n\n  for (let i = 0; i < r_ids.length; i++) {\n    const line = findPersonLineToMain(data_stash.find(d => d.id === r_ids[i]), [datum]);\n    if (!line) {rels_not_to_main.push(r_ids[i]); break;}\n  }\n  return rels_not_to_main.length === 0;\n\n  function findPersonLineToMain(datum, without_persons) {\n    let line;\n    if (isM(datum)) line = [datum];\n    checkIfAnyRelIsMain(datum, [datum]);\n    return line\n\n    function checkIfAnyRelIsMain(d0, history) {\n      if (line) return\n      history = [...history, d0];\n      runAllRels(check);\n      if (!line) runAllRels(checkRels);\n\n      function runAllRels(f) {\n        const r = d0.rels;\n        [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])]\n          .filter(d_id => (d_id && ![...without_persons, ...history].find(d => d.id === d_id)))\n          .forEach(d_id => f(d_id));\n      }\n\n      function check(d_id) {\n        if (isM(d_id)) line = history;\n      }\n\n      function checkRels(d_id) {\n        const person = data_stash.find(d => d.id === d_id);\n        checkIfAnyRelIsMain(person, history);\n      }\n    }\n  }\n  function isM(d0) {return typeof d0 === 'object' ? d0.id === data_stash[0].id : d0 === data_stash[0].id}  // todo: make main more exact\n}\n\nfunction createForm({datum, store, fields, postSubmit, addRelative, deletePerson, onCancel, editFirst}) {\n  const form_creator = {\n    fields: [],\n    onSubmit: submitFormChanges,\n  };\n  if (!datum._new_rel_data) {\n    form_creator.onDelete = deletePersonWithPostSubmit;\n    form_creator.addRelative = () => addRelative.activate(datum),\n    form_creator.addRelativeCancel = () => addRelative.onCancel();\n    form_creator.addRelativeActive = addRelative.is_active;\n\n    form_creator.editable = false;\n  }\n  if (datum._new_rel_data) {\n    form_creator.title = datum._new_rel_data.label;\n    form_creator.new_rel = true;\n    form_creator.editable = true;\n    form_creator.onCancel = onCancel;\n  }\n  if (form_creator.onDelete) form_creator.can_delete = checkIfRelativesConnectedWithoutPerson(datum, store.getData());\n\n  if (editFirst) form_creator.editable = true;\n\n  form_creator.gender_field = {\n    id: 'gender', \n    type: 'switch',\n    label: 'Gender',\n    initial_value: datum.data.gender,\n    options: [{value: 'M', label: 'Male'}, {value: 'F', label: 'Female'}]\n  };\n\n  fields.forEach(d => {\n    const field = {\n      id: d.id,\n      type: d.type,\n      label: d.label,\n      initial_value: datum.data[d.id],\n    };\n    form_creator.fields.push(field);\n  });\n\n  return form_creator\n\n  function submitFormChanges(e) {\n    e.preventDefault();\n    const form_data = new FormData(e.target);\n    form_data.forEach((v, k) => datum.data[k] = v);\n    if (datum.to_add) delete datum.to_add;\n    postSubmit();\n  }\n\n  function deletePersonWithPostSubmit() {\n    deletePerson();\n    postSubmit({delete: true});\n  }\n}\n\nfunction moveToAddToAdded(datum, data_stash) {\n  delete datum.to_add;\n  return datum\n}\n\nfunction removeToAdd(datum, data_stash) {\n  deletePerson(datum, data_stash);\n  return false\n}\n\nfunction deletePerson(datum, data_stash) {\n  if (!checkIfRelativesConnectedWithoutPerson(datum, data_stash)) return {success: false, error: 'checkIfRelativesConnectedWithoutPerson'}\n  executeDelete();\n  return {success: true};\n\n  function executeDelete() {\n    data_stash.forEach(d => {\n      for (let k in d.rels) {\n        if (!d.rels.hasOwnProperty(k)) continue\n        if (d.rels[k] === datum.id) {\n          delete d.rels[k];\n        } else if (Array.isArray(d.rels[k]) && d.rels[k].includes(datum.id)) {\n          d.rels[k].splice(d.rels[k].findIndex(did => did === datum.id), 1);\n        }\n      }\n    });\n    data_stash.splice(data_stash.findIndex(d => d.id === datum.id), 1);\n    data_stash.forEach(d => {if (d.to_add) deletePerson(d, data_stash);});  // full update of tree\n    if (data_stash.length === 0) data_stash.push(createTreeDataWithMainNode({}).data[0]);\n  }\n}\n\nfunction cleanupDataJson(data_json) {\n  let data_no_to_add = JSON.parse(data_json);\n  data_no_to_add.forEach(d => d.to_add ? removeToAdd(d, data_no_to_add) : d);\n  data_no_to_add.forEach(d => delete d.main);\n  data_no_to_add.forEach(d => delete d.hide_rels);\n  return JSON.stringify(data_no_to_add, null, 2)\n}\n\nfunction handleRelsOfNewDatum({datum, data_stash, rel_type, rel_datum}) {\n  if (rel_type === \"daughter\" || rel_type === \"son\") addChild(datum);\n  else if (rel_type === \"father\" || rel_type === \"mother\") addParent(datum);\n  else if (rel_type === \"spouse\") addSpouse(datum);\n\n  function addChild(datum) {\n    if (datum.data.other_parent) {\n      addChildToSpouseAndParentToChild(datum.data.other_parent);\n      delete datum.data.other_parent;\n    }\n    datum.rels[rel_datum.data.gender === 'M' ? 'father' : 'mother'] = rel_datum.id;\n    if (!rel_datum.rels.children) rel_datum.rels.children = [];\n    rel_datum.rels.children.push(datum.id);\n    return datum\n\n    function addChildToSpouseAndParentToChild(spouse_id) {\n      if (spouse_id === \"_new\") spouse_id = addOtherParent().id;\n\n      const spouse = data_stash.find(d => d.id === spouse_id);\n      datum.rels[spouse.data.gender === 'M' ? 'father' : 'mother'] = spouse.id;\n      if (!spouse.rels.hasOwnProperty('children')) spouse.rels.children = [];\n      spouse.rels.children.push(datum.id);\n\n      function addOtherParent() {\n        const new_spouse = createNewPersonWithGenderFromRel({rel_type: \"spouse\", rel_datum});\n        addSpouse(new_spouse);\n        addNewPerson({data_stash, datum: new_spouse});\n        return new_spouse\n      }\n    }\n  }\n\n  function addParent(datum) {\n    const is_father = datum.data.gender === \"M\",\n      parent_to_add_id = rel_datum.rels[is_father ? 'father' : 'mother'];\n    if (parent_to_add_id) removeToAdd(data_stash.find(d => d.id === parent_to_add_id), data_stash);\n    addNewParent();\n\n    function addNewParent() {\n      rel_datum.rels[is_father ? 'father' : 'mother'] = datum.id;\n      handleSpouse();\n      datum.rels.children = [rel_datum.id];\n      return datum\n\n      function handleSpouse() {\n        const spouse_id = rel_datum.rels[!is_father ? 'father' : 'mother'];\n        if (!spouse_id) return\n        const spouse = data_stash.find(d => d.id === spouse_id);\n        datum.rels.spouses = [spouse_id];\n        if (!spouse.rels.spouses) spouse.rels.spouses = [];\n        spouse.rels.spouses.push(datum.id);\n        return spouse\n      }\n    }\n  }\n\n  function addSpouse(datum) {\n    removeIfToAdd();\n    if (!rel_datum.rels.spouses) rel_datum.rels.spouses = [];\n    rel_datum.rels.spouses.push(datum.id);\n    datum.rels.spouses = [rel_datum.id];\n\n    function removeIfToAdd() {\n      if (!rel_datum.rels.spouses) return\n      rel_datum.rels.spouses.forEach(spouse_id => {\n        const spouse = data_stash.find(d => d.id === spouse_id);\n        if (spouse.to_add) removeToAdd(spouse, data_stash);\n      });\n    }\n  }\n}\n\nfunction handleNewRel({datum, new_rel_datum, data_stash}) {\n  const rel_type = new_rel_datum._new_rel_data.rel_type;\n\n  if (rel_type === \"son\" || rel_type === \"daughter\") {\n    let mother = data_stash.find(d => d.id === new_rel_datum.rels.mother);\n    let father = data_stash.find(d => d.id === new_rel_datum.rels.father);\n    if (!mother) {\n      mother = createNewPerson({data: {gender: \"F\"}, rels: {children: [], spouses: [datum.id]}});\n      mother.to_add = true;\n      mother.id = new_rel_datum.rels.mother;\n      if (!datum.rels.spouses) datum.rels.spouses = [];\n      datum.rels.spouses.push(mother.id);\n      data_stash.push(mother);\n    }\n\n    if (!father) {\n      father = createNewPerson({data: {gender: \"F\"}, rels: {children: [], spouses: [datum.id]}});\n      father.to_add = true;\n      father.id = new_rel_datum.rels.father;\n      if (!datum.rels.spouses) datum.rels.spouses = [];\n      datum.rels.spouses.push(father.id);\n      data_stash.push(father);\n    }\n\n    if (!father.rels.children) father.rels.children = [];\n    father.rels.children.push(new_rel_datum.id);\n    if (!mother.rels.children) mother.rels.children = [];\n    mother.rels.children.push(new_rel_datum.id);\n    \n    new_rel_datum.rels = {\n      mother: mother.id,\n      father: father.id\n    };\n  }\n\n  if (rel_type === \"spouse\") {\n    if (!datum.rels.spouses) datum.rels.spouses = [];\n    if (!datum.rels.spouses.includes(new_rel_datum.id)) datum.rels.spouses.push(new_rel_datum.id);\n\n    // if rel is added in same same add relative tree then we need to clean up duplicate parent\n    new_rel_datum.rels.children = new_rel_datum.rels.children.filter(child_id => {\n      const child = data_stash.find(d => d.id === child_id);\n      if (!child) return false\n      if (child.rels.mother !== datum.id) {\n        if (data_stash.find(d => d.id === child.rels.mother)) data_stash.splice(data_stash.findIndex(d => d.id === child.rels.mother), 1);\n        child.rels.mother = new_rel_datum.id;\n      }\n      if (child.rels.father !== datum.id) {\n        if (data_stash.find(d => d.id === child.rels.father)) data_stash.splice(data_stash.findIndex(d => d.id === child.rels.father), 1);\n        child.rels.father = new_rel_datum.id;\n      }\n      return true\n    });\n\n    new_rel_datum.rels = {\n      spouses: [datum.id],\n      children: new_rel_datum.rels.children\n    };\n  }\n\n  if (rel_type === \"father\") {\n    datum.rels.father = new_rel_datum.id;\n    new_rel_datum.rels = {\n      children: [datum.id],\n    };\n    if (datum.rels.mother) {\n      new_rel_datum.rels.spouses = [datum.rels.mother];\n      const mother = data_stash.find(d => d.id === datum.rels.mother);\n      if (!mother.rels.spouses) mother.rels.spouses = [];\n      mother.rels.spouses.push(new_rel_datum.id);\n    }\n  }\n\n  if (rel_type === \"mother\") {\n    datum.rels.mother = new_rel_datum.id;\n    new_rel_datum.rels = {\n      children: [datum.id],\n    };\n    if (datum.rels.father) {\n      new_rel_datum.rels.spouses = [datum.rels.father];\n      const father = data_stash.find(d => d.id === datum.rels.father);\n      if (!father.rels.spouses) father.rels.spouses = [];\n      father.rels.spouses.push(new_rel_datum.id);\n    }\n  }\n\n  delete new_rel_datum._new_rel_data;\n  data_stash.push(new_rel_datum);\n}\n\nfunction createNewPerson({data, rels}) {\n  return {id: generateUUID(), data: data || {}, rels: rels || {}}\n}\n\nfunction createNewPersonWithGenderFromRel({data, rel_type, rel_datum}) {\n  const gender = getGenderFromRelative(rel_datum, rel_type);\n  data = Object.assign(data || {}, {gender});\n  return createNewPerson({data})\n\n  function getGenderFromRelative(rel_datum, rel_type) {\n    return ([\"daughter\", \"mother\"].includes(rel_type) || rel_type === \"spouse\" && rel_datum.data.gender === \"M\") ? \"F\" : \"M\"\n  }\n}\n\nfunction addNewPerson({data_stash, datum}) {\n  data_stash.push(datum);\n}\n\nfunction createTreeDataWithMainNode({data, version}) {\n  return {data: [createNewPerson({data})], version}\n}\n\nfunction addNewPersonAndHandleRels({datum, data_stash, rel_type, rel_datum}) {\n  addNewPerson({data_stash, datum});\n  handleRelsOfNewDatum({datum, data_stash, rel_type, rel_datum});\n}\n\nfunction generateUUID() {\n  var d = new Date().getTime();\n  var d2 = (performance && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16;\n    if(d > 0){//Use timestamp until depleted\n      r = (d + r)%16 | 0;\n      d = Math.floor(d/16);\n    } else {//Use microseconds since page-load if supported\n      r = (d2 + r)%16 | 0;\n      d2 = Math.floor(d2/16);\n    }\n    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n  });\n}\n\nfunction manualZoom({amount, svg, transition_time=500}) {\n  const zoom = svg.__zoomObj;\n  d3.select(svg).transition().duration(transition_time || 0).delay(transition_time ? 100 : 0)  // delay 100 because of weird error of undefined something in d3 zoom\n    .call(zoom.scaleBy, amount);\n}\n\nfunction isAllRelativeDisplayed(d, data) {\n  const r = d.data.rels,\n    all_rels = [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])].filter(v => v);\n  return all_rels.every(rel_id => data.some(d => d.data.id === rel_id))\n}\n\nfunction CalculateTree({data, main_id=null, node_separation=250, level_separation=150}) {\n  if (!data || !data.length) return {data: [], data_stash: [], dim: {width: 0, height: 0}, main_id: null}\n  const is_vertical = true;\n  const data_stash = createRelsToAdd(data);\n  sortChildrenWithSpouses(data_stash);\n  const main = (main_id !== null && data_stash.find(d => d.id === main_id)) || data_stash[0];\n  const tree_children = calculateTreePositions(main, 'children', false);\n  const tree_parents = calculateTreePositions(main, 'parents', true);\n\n  data_stash.forEach(d => d.main = d === main);\n  levelOutEachSide(tree_parents, tree_children);\n  const tree = mergeSides(tree_parents, tree_children);\n  setupChildrenAndParents({tree});\n  setupSpouses({tree, node_separation});\n  nodePositioning({tree, is_vertical});\n  tree.forEach(d => d.all_rels_displayed = isAllRelativeDisplayed(d, tree));\n\n  const dim = calculateTreeDim(tree, node_separation, level_separation, is_vertical);\n\n  return {data: tree, data_stash, dim, main_id: main.id}\n\n  function calculateTreePositions(datum, rt, is_ancestry) {\n    const hierarchyGetter = rt === \"children\" ? hierarchyGetterChildren : hierarchyGetterParents,\n      d3_tree = d3.tree().nodeSize([node_separation, level_separation]).separation(separation),\n      root = d3.hierarchy(datum, hierarchyGetter);\n    d3_tree(root);\n    return root.descendants()\n\n    function separation(a, b) {\n      let offset = 1;\n      if (!is_ancestry) {\n        if (!sameParent(a, b)) offset+=.25;\n        if (someSpouses(a,b)) offset+=offsetOnPartners(a,b);\n        if (sameParent(a, b) && !sameBothParents(a,b)) offset+=.125;\n      }\n      return offset\n    }\n    function sameParent(a, b) {return a.parent == b.parent}\n    function sameBothParents(a, b) {return (a.data.rels.father === b.data.rels.father) && (a.data.rels.mother === b.data.rels.mother)}\n    function hasSpouses(d) {return d.data.rels.spouses && d.data.rels.spouses.length > 0}\n    function someSpouses(a, b) {return hasSpouses(a) || hasSpouses(b)}\n\n    function hierarchyGetterChildren(d) {\n      return [...(d.rels.children || [])].map(id => data_stash.find(d => d.id === id))\n    }\n\n    function hierarchyGetterParents(d) {\n      return [d.rels.father, d.rels.mother]\n        .filter(d => d).map(id => data_stash.find(d => d.id === id))\n    }\n\n    function offsetOnPartners(a,b) {\n      return ((a.data.rels.spouses || []).length + (b.data.rels.spouses || []).length)*.5\n    }\n  }\n\n  function levelOutEachSide(parents, children) {\n    const mid_diff = (parents[0].x - children[0].x) / 2;\n    parents.forEach(d => d.x-=mid_diff);\n    children.forEach(d => d.x+=mid_diff);\n  }\n\n  function mergeSides(parents, children) {\n    parents.forEach(d => {d.is_ancestry = true;});\n    parents.forEach(d => d.depth === 1 ? d.parent = children[0] : null);\n\n    return [...children, ...parents.slice(1)];\n  }\n  function nodePositioning({tree, is_vertical}) {\n    tree.forEach(d => {\n      d.y *= (d.is_ancestry ? -1 : 1);\n      if (!is_vertical) {\n        const d_x = d.x; d.x = d.y; d.y = d_x;\n      }\n    });\n  }\n\n  function setupSpouses({tree, node_separation}) {\n    for (let i = tree.length; i--;) {\n      const d = tree[i];\n      if (!d.is_ancestry && d.data.rels.spouses && d.data.rels.spouses.length > 0){\n        const side = d.data.data.gender === \"M\" ? -1 : 1;  // female on right\n        d.x += d.data.rels.spouses.length/2*node_separation*side;\n        d.data.rels.spouses.forEach((sp_id, i) => {\n          const spouse = {data: data_stash.find(d0 => d0.id === sp_id), added: true};\n\n          spouse.x = d.x-(node_separation*(i+1))*side;\n          spouse.y = d.y;\n          spouse.sx = i > 0 ? spouse.x : spouse.x + (node_separation/2)*side;\n          spouse.depth = d.depth;\n          spouse.spouse = d;\n          if (!d.spouses) d.spouses = [];\n          d.spouses.push(spouse);\n          tree.push(spouse);\n\n          tree.forEach(d0 => (\n            (d0.data.rels.father === d.data.id && d0.data.rels.mother === spouse.data.id) ||\n            (d0.data.rels.mother === d.data.id && d0.data.rels.father === spouse.data.id)\n            ) ? d0.psx = spouse.sx : null\n          );\n        });\n      }\n      if (d.parents && d.parents.length === 2) {\n        const p1 = d.parents[0],\n          p2 = d.parents[1],\n          midd = p1.x - (p1.x - p2.x)/2,\n          x = (d,sp) => midd + (node_separation/2)*(d.x < sp.x ? 1 : -1);\n\n        p2.x = x(p1, p2); p1.x = x(p2, p1);\n      }\n    }\n  }\n\n  function setupChildrenAndParents({tree}) {\n    tree.forEach(d0 => {\n      delete d0.children;\n      tree.forEach(d1 => {\n        if (d1.parent === d0) {\n          if (d1.is_ancestry) {\n            if (!d0.parents) d0.parents = [];\n            d0.parents.push(d1);\n          } else {\n            if (!d0.children) d0.children = [];\n            d0.children.push(d1);\n          }\n        }\n      });\n    });\n  }\n\n  function calculateTreeDim(tree, node_separation, level_separation, is_vertical) {\n    if (!is_vertical) [node_separation, level_separation] = [level_separation, node_separation];\n    const w_extent = d3.extent(tree, d => d.x),\n      h_extent = d3.extent(tree, d => d.y);\n    return {\n      width: w_extent[1] - w_extent[0]+node_separation, height: h_extent[1] - h_extent[0]+level_separation, x_off: -w_extent[0]+node_separation/2, y_off: -h_extent[0]+level_separation/2\n    }\n  }\n\n  function createRelsToAdd(data) {\n    const to_add_spouses = [];\n    for (let i = 0; i < data.length; i++) {\n      const d = data[i];\n      if (d.rels.children && d.rels.children.length > 0) {\n        if (!d.rels.spouses) d.rels.spouses = [];\n        const is_father = d.data.gender === \"M\";\n        let spouse;\n\n        d.rels.children.forEach(d0 => {\n          const child = data.find(d1 => d1.id === d0);\n          if (child.rels[is_father ? 'father' : 'mother'] !== d.id) return\n          if (child.rels[!is_father ? 'father' : 'mother']) return\n          if (!spouse) {\n            spouse = createToAddSpouse(d);\n            d.rels.spouses.push(spouse.id);\n          }\n          spouse.rels.children.push(child.id);\n          child.rels[!is_father ? 'father' : 'mother'] = spouse.id;\n        });\n      }\n    }\n    to_add_spouses.forEach(d => data.push(d));\n    return data\n\n    function createToAddSpouse(d) {\n      const spouse = createNewPerson({\n        data: {gender: d.data.gender === \"M\" ? \"F\" : \"M\"},\n        rels: {spouses: [d.id], children: []}\n      });\n      spouse.to_add = true;\n      to_add_spouses.push(spouse);\n      return spouse\n    }\n  }\n\n}\n\nfunction createStore(initial_state) {\n  let onUpdate;\n  const state = initial_state;\n  state.main_id_history = []; \n\n  const store = {\n    state,\n    updateTree: (props) => {\n      state.tree = calcTree();\n      if (!state.main_id) updateMainId(state.tree.main_id);\n      if (onUpdate) onUpdate(props);\n    },\n    updateData: data => state.data = data,\n    updateMainId,\n    getMainId: () => state.main_id,\n    getData: () => state.data,\n    getTree: () => state.tree,\n    setOnUpdate: (f) => onUpdate = f,\n\n    getMainDatum,\n    getDatum,\n    getTreeMainDatum,\n    getTreeDatum,\n    getLastAvailableMainDatum,\n\n    methods: {},\n  };\n\n  return store\n\n  function calcTree() {\n    return CalculateTree({\n      data: state.data, main_id: state.main_id,\n      node_separation: state.node_separation, level_separation: state.level_separation\n    })\n  }\n\n  function getMainDatum() {\n    return state.data.find(d => d.id === state.main_id)\n  }\n\n  function getDatum(id) {\n    return state.data.find(d => d.id === id)\n  }\n\n  function getTreeMainDatum() {\n    if (!state.tree) return null;\n    return state.tree.data.find(d => d.data.id === state.main_id)\n  }\n\n  function getTreeDatum(id) {\n    if (!state.tree) return null;\n    return state.tree.data.find(d => d.id === id)\n  }\n\n  function updateMainId(id) {\n    if (id === state.main_id) return\n    state.main_id_history = state.main_id_history.filter(d => d !== id).slice(-10);\n    state.main_id_history.push(id);\n    state.main_id = id;\n  }\n\n  // if main_id is deleted, get the last available main_id\n  function getLastAvailableMainDatum() {\n    let main_id = state.main_id_history.slice(0).reverse().find(id => getDatum(id));\n    if (!main_id) main_id = state.data[0].id;\n    if (main_id !== state.main_id) updateMainId(main_id);\n    return getDatum(main_id)\n  }\n}\n\nfunction positionTree({t, svg, transition_time=2000}) {\n  const el_listener = svg.__zoomObj ? svg : svg.parentNode;  // if we need listener for svg and html, we will use parent node\n  const zoom = el_listener.__zoomObj;\n\n  d3.select(el_listener).transition().duration(transition_time || 0).delay(transition_time ? 100 : 0)  // delay 100 because of weird error of undefined something in d3 zoom\n    .call(zoom.transform, d3.zoomIdentity.scale(t.k).translate(t.x, t.y));\n}\n\nfunction treeFit({svg, svg_dim, tree_dim, with_transition, transition_time}) {\n  const t = calculateTreeFit(svg_dim, tree_dim);\n  positionTree({t, svg, with_transition, transition_time});\n}\n\nfunction calculateTreeFit(svg_dim, tree_dim) {\n  let k = Math.min(svg_dim.width / tree_dim.width, svg_dim.height / tree_dim.height),\n    x = tree_dim.x_off + (svg_dim.width - tree_dim.width*k)/k/2,\n    y = tree_dim.y_off + (svg_dim.height - tree_dim.height*k)/k/2;\n\n  if (k>1) {x*=k;y*=k;k=1;}\n  return {k,x,y}\n}\n\nfunction cardToMiddle({datum, svg, svg_dim, scale, transition_time}) {\n  const k = scale || 1, x = svg_dim.width/2-datum.x*k, y = svg_dim.height/2-datum.y,\n    t = {k, x: x/k, y: y/k};\n  positionTree({t, svg, with_transition: true, transition_time});\n}\n\nfunction createLinks({d, tree, is_vertical}) {\n  const links = [];\n\n  if (d.data.rels.spouses && d.data.rels.spouses.length > 0) handleSpouse({d});\n  handleAncestrySide({d});\n  handleProgenySide({d});\n\n  return links;\n\n  function handleAncestrySide({d}) {\n    if (!d.parents || d.parents.length !== 2) return\n    const p1 = d.parents[0], p2 = d.parents[1];\n\n    const p = {x: getMid(p1, p2, 'x'), y: getMid(p1, p2, 'y')};\n\n    links.push({\n      d: Link(d, p),\n      _d: () => {\n        const _d = {x: d.x, y: d.y},\n          _p = {x: d.x, y: d.y};\n        return Link(_d, _p)\n      },\n      curve: true, \n      id: linkId(d, d.parents[0], d.parents[1]), \n      depth: d.depth+1, \n      is_ancestry: true,\n      source: d,\n      target: [d.parents[0], d.parents[1]]\n    });\n  }\n\n\n  function handleProgenySide({d}) {\n    if (!d.children || d.children.length === 0) return\n\n    d.children.forEach((child, i) => {\n      const other_parent = otherParent(child, d, tree),\n        sx = other_parent.sx;\n\n      links.push({\n        d: Link(child, {x: sx, y: d.y}),\n        _d: () => Link({x: sx, y: d.y}, {x: _or(child, 'x'), y: _or(child, 'y')}),\n        curve: true,\n        id: linkId(child, d, other_parent),\n        depth: d.depth+1,\n        is_ancestry: false,\n        source: [d, other_parent],\n        target: child\n      });\n    });\n  }\n\n\n  function handleSpouse({d}) {\n    d.data.rels.spouses.forEach(sp_id => {\n      const spouse = getRel(d, tree, d0 => d0.data.id === sp_id);\n      if (!spouse || d.spouse) return\n      links.push({\n        d: [[d.x, d.y], [spouse.x, spouse.y]],\n        _d: () => [\n          d.is_ancestry ? [_or(d, 'x')-.0001, _or(d, 'y')] : [d.x, d.y], // add -.0001 to line to have some length if d.x === spouse.x\n          d.is_ancestry ? [_or(spouse, 'x'), _or(spouse, 'y')] : [d.x-.0001, d.y]\n        ],\n        curve: false, \n        id: linkId(d, spouse), \n        depth: d.depth, \n        spouse: true, \n        is_ancestry: spouse.is_ancestry, \n        source: d, \n        target: spouse\n      });\n    });\n  }\n\n  ///\n  function getMid(d1, d2, side, is_) {\n    if (is_) return _or(d1, side) - (_or(d1, side) - _or(d2, side))/2\n    else return d1[side] - (d1[side] - d2[side])/2\n  }\n\n  function _or(d, k) {\n   return d.hasOwnProperty('_'+k) ? d['_'+k] : d[k]\n  }\n\n  function Link(d, p) {\n    const hy = (d.y + (p.y - d.y) / 2);\n    return [\n      [d.x, d.y],\n      [d.x, hy],\n      [d.x, hy],\n      [p.x, hy],\n      [p.x, hy],\n      [p.x, p.y],\n    ]\n  }\n\n  function linkId(...args) {\n    return args.map(d => d.data.id).sort().join(\", \")  // make unique id\n  }\n\n  function otherParent(child, p1, data) {\n    const condition = d0 => (d0.data.id !== p1.data.id) && ((d0.data.id === child.data.rels.mother) || (d0.data.id === child.data.rels.father));\n    return getRel(p1, data, condition)\n  }\n\n  // if there is overlapping of personas in different branches of same family tree, return the closest one\n  function getRel(d, data, condition) {\n    const rels = data.filter(condition);\n    const dist_xy = (a, b) => Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n    if (rels.length > 1) return rels.sort((d0, d1) => dist_xy(d0, d) - dist_xy(d1, d))[0]\n    else return rels[0]\n  }\n}\n\nfunction pathToMain(cards, links, datum, main_datum) {\n  const is_ancestry = datum.is_ancestry;\n  const links_data = links.data();\n  let links_node_to_main = [];\n  let cards_node_to_main = [];\n\n  if (is_ancestry) {\n    const links_to_main = [];\n\n    let parent = datum;\n    let itteration1 = 0;\n    while (parent !== main_datum.data && itteration1 < 100) {\n      itteration1++;  // to prevent infinite loop\n      const spouse_link = links_data.find(d => d.spouse === true && (d.source === parent || d.target === parent));\n      if (!spouse_link) break\n      const child_link = links_data.find(d => Array.isArray(d.target) && d.target.includes(spouse_link.source) && d.target.includes(spouse_link.target));\n      if (!child_link) break\n      links_to_main.push(spouse_link);\n      links_to_main.push(child_link);\n      parent = child_link.source;\n    }\n    links.each(function(d) {\n      if (links_to_main.includes(d)) {\n        links_node_to_main.push({link: d, node: this});\n      }\n    });\n\n    const cards_to_main = getCardsToMain(datum, links_to_main);\n    cards.each(function(d) {\n      if (cards_to_main.includes(d)) {\n        cards_node_to_main.push({card: d, node: this});\n      }\n    });\n  } else if (datum.spouse && datum.spouse.data === main_datum.data) {\n    links.each(function(d) {\n      if (d.target === datum) links_node_to_main.push({link: d, node: this});\n    });\n    const cards_to_main = [main_datum, datum];\n    cards.each(function(d) {\n      if (cards_to_main.includes(d)) {\n        cards_node_to_main.push({card: d, node: this});\n      }\n    });\n  } else {\n    let links_to_main = [];\n\n    let child = datum;\n    let itteration1 = 0;\n    while (parent !== main_datum.data && itteration1 < 100) {\n      itteration1++;  // to prevent infinite loop\n      const child_link = links_data.find(d => d.target === child && Array.isArray(d.source));\n      if (child_link) {\n        const spouse_link = links_data.find(d => d.spouse === true && sameArray([d.source, d.target], child_link.source));\n        links_to_main.push(child_link);\n        links_to_main.push(spouse_link);\n        if (spouse_link) child = spouse_link.source;\n      } else {\n        const spouse_link = links_data.find(d => d.target === child && !Array.isArray(d.source));  // spouse link\n        if (!spouse_link) break\n        links_to_main.push(spouse_link);\n        child = spouse_link.source;\n      }\n    }\n\n    links.each(function(d) {\n      if (links_to_main.includes(d)) {\n        links_node_to_main.push({link: d, node: this});\n      }\n    });\n\n    const cards_to_main = getCardsToMain(main_datum, links_to_main);\n    cards.each(function(d) {\n      if (cards_to_main.includes(d)) {\n        cards_node_to_main.push({card: d, node: this});\n      }\n    });\n  }\n  return [cards_node_to_main, links_node_to_main]\n\n  function sameArray(arr1, arr2) {\n    return arr1.every(d1 => arr2.some(d2 => d1 === d2))\n  }\n\n  function getCardsToMain(first_parent, links_to_main) {\n    const all_cards = links_to_main.reduce((acc, d) => {\n      if (Array.isArray(d.target)) acc.push(...d.target);\n      else acc.push(d.target);\n      if (Array.isArray(d.source)) acc.push(...d.source);\n      else acc.push(d.source);\n      return acc\n    }, []);\n\n    const cards_to_main = [main_datum, datum];\n    getChildren(first_parent);\n    return cards_to_main\n\n    function getChildren(d) {\n      if (d.data.rels.children) {\n        d.data.rels.children.forEach(child_id => {\n          const child = all_cards.find(d0 => d0.data.id === child_id);\n          if (child) {\n            cards_to_main.push(child);\n            getChildren(child);\n          }\n        });\n      }\n    }\n  }\n}\n\nfunction createPath(d, is_) {\n  const line = d3.line().curve(d3.curveMonotoneY),\n    lineCurve = d3.line().curve(d3.curveBasis),\n    path_data = is_ ? d._d() : d.d;\n\n  if (!d.curve) return line(path_data)\n  else if (d.curve === true) return lineCurve(path_data)\n}\n\nfunction updateLinks(svg, tree, props={}) {\n  const links_data = tree.data.reduce((acc, d) => acc.concat(createLinks({d, tree:tree.data})), []),\n    link = d3.select(svg).select(\".links_view\").selectAll(\"path.link\").data(links_data, d => d.id),\n    link_exit = link.exit(),\n    link_enter = link.enter().append(\"path\").attr(\"class\", \"link\"),\n    link_update = link_enter.merge(link);\n\n  link_exit.each(linkExit);\n  link_enter.each(linkEnter);\n  link_update.each(linkUpdate);\n\n  function linkEnter(d) {\n    d3.select(this).attr(\"fill\", \"none\").attr(\"stroke\", \"#fff\").attr(\"stroke-width\", 1).style(\"opacity\", 0)\n      .attr(\"d\", createPath(d, true));\n  }\n\n  function linkUpdate(d) {\n    const path = d3.select(this);\n    const delay = props.initial ? calculateDelay(tree, d, props.transition_time) : 0;\n    path.transition('path').duration(props.transition_time).delay(delay).attr(\"d\", createPath(d)).style(\"opacity\", 1);\n  }\n\n  function linkExit(d) {\n    const path = d3.select(this);\n    path.transition('op').duration(800).style(\"opacity\", 0);\n    path.transition('path').duration(props.transition_time).attr(\"d\", createPath(d, true))\n      .on(\"end\", () => path.remove());\n  }\n\n}\n\nfunction updateCards(svg, tree, Card, props={}) {\n  const card = d3.select(svg).select(\".cards_view\").selectAll(\"g.card_cont\").data(tree.data, d => d.data.id),\n    card_exit = card.exit(),\n    card_enter = card.enter().append(\"g\").attr(\"class\", \"card_cont\"),\n    card_update = card_enter.merge(card);\n\n  card_exit.each(d => calculateEnterAndExitPositions(d, false, true));\n  card_enter.each(d => calculateEnterAndExitPositions(d, true, false));\n\n  card_exit.each(cardExit);\n  card.each(cardUpdateNoEnter);\n  card_enter.each(cardEnter);\n  card_update.each(cardUpdate);\n\n  function cardEnter(d) {\n    d3.select(this)\n      .attr(\"transform\", `translate(${d._x}, ${d._y})`)\n      .style(\"opacity\", 0);\n\n    Card.call(this, d);\n  }\n\n  function cardUpdateNoEnter(d) {}\n\n  function cardUpdate(d) {\n    Card.call(this, d);\n    const delay = props.initial ? calculateDelay(tree, d, props.transition_time) : 0;\n    d3.select(this).transition().duration(props.transition_time).delay(delay).attr(\"transform\", `translate(${d.x}, ${d.y})`).style(\"opacity\", 1);\n  }\n\n  function cardExit(d) {\n    const g = d3.select(this);\n    g.transition().duration(props.transition_time).style(\"opacity\", 0).attr(\"transform\", `translate(${d._x}, ${d._y})`)\n      .on(\"end\", () => g.remove());\n  }\n}\n\nfunction updateCardsHtml(div, tree, Card, props={}) {\n  const card = d3.select(div).select(\".cards_view\").selectAll(\"div.card_cont\").data(tree.data, d => d.data.id),\n    card_exit = card.exit(),\n    card_enter = card.enter().append(\"div\").attr(\"class\", \"card_cont\").style('pointer-events', 'none'),\n    card_update = card_enter.merge(card);\n\n  card_exit.each(d => calculateEnterAndExitPositions(d, false, true));\n  card_enter.each(d => calculateEnterAndExitPositions(d, true, false));\n\n  card_exit.each(cardExit);\n  card.each(cardUpdateNoEnter);\n  card_enter.each(cardEnter);\n  card_update.each(cardUpdate);\n\n  function cardEnter(d) {\n    d3.select(this)\n      .style('position', 'absolute')\n      .style('top', '0').style('left', '0')\n      .style(\"transform\", `translate(${d._x}px, ${d._y}px)`)\n      .style(\"opacity\", 0);\n\n    Card.call(this, d);\n  }\n\n  function cardUpdateNoEnter(d) {}\n\n  function cardUpdate(d) {\n    Card.call(this, d);\n    const delay = props.initial ? calculateDelay(tree, d, props.transition_time) : 0;\n    d3.select(this).transition().duration(props.transition_time).delay(delay).style(\"transform\", `translate(${d.x}px, ${d.y}px)`).style(\"opacity\", 1);\n  }\n\n  function cardExit(d) {\n    const g = d3.select(this);\n    g.transition().duration(props.transition_time).style(\"opacity\", 0).style(\"transform\", `translate(${d._x}px, ${d._y}px)`)\n      .on(\"end\", () => g.remove());\n  }\n}\n\nfunction assignUniqueIdToTreeData(div, tree_data) {\n  const card = d3.select(div).selectAll(\"div.card_cont_2fake\").data(tree_data, d => d.data.id);  // how this doesn't break if there is multiple cards with the same id?\n  const card_exit = card.exit();\n  const card_enter = card.enter().append(\"div\").attr(\"class\", \"card_cont_2fake\").style('display', 'none').attr(\"data-id\", () => Math.random());\n  const card_update = card_enter.merge(card);\n\n  card_exit.each(cardExit);\n  card_enter.each(cardEnter);\n  card_update.each(cardUpdate);\n\n  function cardEnter(d) {\n    d.unique_id = d3.select(this).attr(\"data-id\");\n  }\n\n  function cardUpdate(d) {\n    d.unique_id = d3.select(this).attr(\"data-id\");\n  }\n\n  function cardExit(d) {\n    d.unique_id = d3.select(this).attr(\"data-id\");\n    d3.select(this).remove();\n  }\n}\n\nfunction setupHtmlSvg(getHtmlSvg) {\n  d3.select(getHtmlSvg()).append(\"div\").attr(\"class\", \"cards_view_fake\").style('display', 'none');  // important for handling data\n}\n\nfunction getCardsViewFake(getHtmlSvg) {\n  return d3.select(getHtmlSvg()).select(\"div.cards_view_fake\").node()\n}\n\nfunction onZoomSetup(getSvgView, getHtmlView) {\n  return function onZoom(e) {\n    const t = e.transform;\n  \n    d3.select(getSvgView()).style('transform', `translate(${t.x}px, ${t.y}px) scale(${t.k}) `);\n    d3.select(getHtmlView()).style('transform', `translate(${t.x}px, ${t.y}px) scale(${t.k}) `);\n  }\n}\n\nfunction setupReactiveTreeData(getHtmlSvg) {\n  let tree_data = [];\n\n  return function getReactiveTreeData(new_tree_data) {\n    const tree_data_exit = getTreeDataExit(new_tree_data, tree_data);\n    tree_data = [...new_tree_data, ...tree_data_exit];\n    assignUniqueIdToTreeData(getCardsViewFake(getHtmlSvg), tree_data);\n    return tree_data\n  }\n}\n\nfunction createHtmlSvg(cont) {\n  const f3Canvas = d3.select(cont).select('#f3Canvas');\n  const cardHtml = f3Canvas.append('div').attr('id', 'htmlSvg')\n    .attr('style', 'position: absolute; width: 100%; height: 100%; z-index: 2; top: 0; left: 0');\n  cardHtml.append('div').attr('class', 'cards_view').style('transform-origin', '0 0');\n  setupHtmlSvg(() => cardHtml.node());\n\n  return cardHtml.node()\n}\n\nfunction getTreeDataExit(new_tree_data, old_tree_data) {\n  if (old_tree_data.length > 0) {\n    return old_tree_data.filter(d => !new_tree_data.find(t => t.data.id === d.data.id))\n  } else {\n    return []\n  }\n}\n\nfunction getUniqueId(d) {\n  return d.unique_id\n}\n\nvar htmlHandlers = /*#__PURE__*/Object.freeze({\n__proto__: null,\nassignUniqueIdToTreeData: assignUniqueIdToTreeData,\nsetupHtmlSvg: setupHtmlSvg,\ngetCardsViewFake: getCardsViewFake,\nonZoomSetup: onZoomSetup,\nsetupReactiveTreeData: setupReactiveTreeData,\ncreateHtmlSvg: createHtmlSvg,\ngetUniqueId: getUniqueId\n});\n\nfunction updateCardsComponent(div, tree, Card, props={}) {\n  const card = d3.select(getCardsViewFake(() => div)).selectAll(\"div.card_cont_fake\").data(tree.data, d => d.data.id),\n    card_exit = card.exit(),\n    card_enter = card.enter().append(\"div\").attr(\"class\", \"card_cont_fake\").style('display', 'none'),\n    card_update = card_enter.merge(card);\n\n  card_exit.each(d => calculateEnterAndExitPositions(d, false, true));\n  card_enter.each(d => calculateEnterAndExitPositions(d, true, false));\n\n  card_exit.each(cardExit);\n  card.each(cardUpdateNoEnter);\n  card_enter.each(cardEnter);\n  card_update.each(cardUpdate);\n\n  function cardEnter(d) {\n    const card_element = d3.select(Card(d));\n\n    card_element\n      .style('position', 'absolute')\n      .style('top', '0').style('left', '0').style(\"opacity\", 0)\n      .style(\"transform\", `translate(${d._x}px, ${d._y}px)`);\n  }\n\n  function cardUpdateNoEnter(d) {}\n\n  function cardUpdate(d) {\n    const card_element = d3.select(Card(d));\n    const delay = props.initial ? calculateDelay(tree, d, props.transition_time) : 0;\n    card_element.transition().duration(props.transition_time).delay(delay).style(\"transform\", `translate(${d.x}px, ${d.y}px)`).style(\"opacity\", 1);\n  }\n\n  function cardExit(d) {\n    const card_element = d3.select(Card(d));\n    const g = d3.select(this);\n    card_element.transition().duration(props.transition_time).style(\"opacity\", 0).style(\"transform\", `translate(${d._x}px, ${d._y}px)`)\n      .on(\"end\", () => g.remove()); // remove the card_cont_fake\n  }\n}\n\nfunction view (tree, svg, Card, props={}) {\n\n  props.initial = props.hasOwnProperty('initial') ? props.initial : !d3.select(svg.parentNode).select('.card_cont').node();\n  props.transition_time = props.hasOwnProperty('transition_time') ? props.transition_time : 2000;\n  if (props.cardComponent) updateCardsComponent(props.cardComponent, tree, Card, props);\n  else if (props.cardHtml) updateCardsHtml(props.cardHtml, tree, Card, props);\n  else updateCards(svg, tree, Card, props);\n  updateLinks(svg, tree, props);\n\n  const tree_position = props.tree_position || 'fit';\n  if (props.initial) treeFit({svg, svg_dim: svg.getBoundingClientRect(), tree_dim: tree.dim, transition_time: 0});\n  else if (tree_position === 'fit') treeFit({svg, svg_dim: svg.getBoundingClientRect(), tree_dim: tree.dim, transition_time: props.transition_time});\n  else if (tree_position === 'main_to_middle') cardToMiddle({datum: tree.data[0], svg, svg_dim: svg.getBoundingClientRect(), scale: props.scale, transition_time: props.transition_time});\n  else ;\n\n  return true\n}\n\nfunction calculateDelay(tree, d, transition_time) {\n  const delay_level = transition_time*.4,\n    ancestry_levels = Math.max(...tree.data.map(d=>d.is_ancestry ? d.depth : 0));\n  let delay = d.depth*delay_level;\n  if ((d.depth !== 0 || !!d.spouse) && !d.is_ancestry) {\n    delay+=(ancestry_levels)*delay_level;  // after ancestry\n    if (d.spouse) delay+=delay_level;  // spouse after bloodline\n    delay+=(d.depth)*delay_level;  // double the delay for each level because of additional spouse delay\n  }\n  return delay\n}\n\nfunction createSvg(cont, props={}) {\n  const svg_dim = cont.getBoundingClientRect();\n  const svg_html = (`\n    <svg class=\"main_svg\">\n      <rect width=\"${svg_dim.width}\" height=\"${svg_dim.height}\" fill=\"transparent\" />\n      <g class=\"view\">\n        <g class=\"links_view\"></g>\n        <g class=\"cards_view\"></g>\n      </g>\n      <g style=\"transform: translate(100%, 100%)\">\n        <g class=\"fit_screen_icon cursor-pointer\" style=\"transform: translate(-50px, -50px); display: none\">\n          <rect width=\"27\" height=\"27\" stroke-dasharray=\"${27/2}\" stroke-dashoffset=\"${27/4}\" \n            style=\"stroke:#fff;stroke-width:4px;fill:transparent;\"/>\n          <circle r=\"5\" cx=\"${27/2}\" cy=\"${27/2}\" style=\"fill:#fff\" />          \n        </g>\n      </g>\n    </svg>\n  `);\n\n  const f3Canvas = getOrCreateF3Canvas(cont);\n\n  const temp_div = d3.create('div').node();\n  temp_div.innerHTML = svg_html;\n  const svg = temp_div.querySelector('svg');\n  f3Canvas.appendChild(svg);\n\n  cont.appendChild(f3Canvas);\n\n  setupZoom(f3Canvas, props);\n\n  return svg\n\n  function getOrCreateF3Canvas(cont) {\n    let f3Canvas = cont.querySelector('#f3Canvas');\n    if (!f3Canvas) {\n      f3Canvas = d3.create('div').attr('id', 'f3Canvas').attr('style', 'position: relative; overflow: hidden; width: 100%; height: 100%;').node();\n    }\n    return f3Canvas\n  }\n}\n\nfunction setupZoom(el, props={}) {\n  if (el.__zoom) return\n  const view = el.querySelector('.view'),\n    zoom = d3.zoom().on(\"zoom\", (props.onZoom || zoomed));\n\n  d3.select(el).call(zoom);\n  el.__zoomObj = zoom;\n\n  if (props.zoom_polite) zoom.filter(zoomFilter);\n\n  function zoomed(e) {\n    d3.select(view).attr(\"transform\", e.transform);\n  }\n\n  function zoomFilter(e) {\n    if (e.type === \"wheel\" && !e.ctrlKey) return false\n    else if (e.touches && e.touches.length < 2) return false\n    else return true\n  }\n}\n\nfunction cardChangeMain(store, {d}) {\n  toggleAllRels(store.getTree().data, false);\n  store.updateMainId(d.data.id);\n  store.updateTree({tree_position: store.state.tree_fit_on_change});\n  return true\n}\n\nfunction cardEdit(store, {d, cardEditForm}) {\n  const datum = d.data,\n    postSubmit = (props) => {\n      if (datum.to_add) moveToAddToAdded(datum, store.getData());\n      if (props && props.delete) {\n        if (datum.main) store.updateMainId(null);\n        deletePerson(datum, store.getData());\n      }\n      store.updateTree();\n    };\n  cardEditForm({datum, postSubmit, store});\n}\n\nfunction cardShowHideRels(store, {d}) {\n  d.data.hide_rels = !d.data.hide_rels;\n  toggleRels(d, d.data.hide_rels);\n  store.updateTree({tree_position: store.state.tree_fit_on_change});\n}\n\nfunction userIcon() {\n  return (`\n    <g data-icon=\"user\">\n      ${bgCircle()}\n      <path d=\"M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z\" />\n    </g>\n  `)\n}\n\nfunction userEditIcon() {\n  return (`\n    <g data-icon=\"user-edit\">\n      ${bgCircle()}\n      <path d=\"M21.7,13.35L20.7,14.35L18.65,12.3L19.65,11.3C19.86,11.09 20.21,11.09 20.42,11.3L21.7,12.58C21.91,\n      12.79 21.91,13.14 21.7,13.35M12,18.94L18.06,12.88L20.11,14.93L14.06,21H12V18.94M12,14C7.58,14 4,15.79 4,\n      18V20H10V18.11L14,14.11C13.34,14.03 12.67,14 12,14M12,4A4,4 0 0,0 8,8A4,4 0 0,0 12,12A4,4 0 0,0 16,8A4,4 0 0,0 12,4Z\" />\n    </g>\n  `)\n}\n\nfunction userPlusIcon() {\n  return (`\n    <g data-icon=\"user-plus\">\n      ${bgCircle()}\n      <path d=\"M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z\" />\n    </g>\n  `)\n}\n\nfunction userPlusCloseIcon() {\n  return (`\n    <g data-icon=\"user-plus-close\">\n      ${bgCircle()}\n      <path d=\"M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z\" />\n      <line x1=\"3\" y1=\"3\" x2=\"24\" y2=\"24\" stroke=\"currentColor\" stroke-width=\"2\" />\n    </g>\n  `)\n}\n\nfunction plusIcon() {\n  return (`\n    <g data-icon=\"plus\">\n      ${bgCircle()}\n      <path d=\"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\" />\n    </g>\n  `)\n}\n\nfunction pencilIcon() {\n  return (`\n    <g data-icon=\"pencil\">\n      ${bgCircle()}\n      <path d=\"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z\" />\n    </g>\n  `)\n}\n\nfunction pencilOffIcon() {\n  return (`\n    <g data-icon=\"pencil-off\">\n      ${bgCircle()}\n      <path d=\"M18.66,2C18.4,2 18.16,2.09 17.97,2.28L16.13,4.13L19.88,7.88L21.72,6.03C22.11,5.64 22.11,5 21.72,4.63L19.38,2.28C19.18,2.09 18.91,2 18.66,2M3.28,4L2,5.28L8.5,11.75L4,16.25V20H7.75L12.25,15.5L18.72,22L20,20.72L13.5,14.25L9.75,10.5L3.28,4M15.06,5.19L11.03,9.22L14.78,12.97L18.81,8.94L15.06,5.19Z\" />\n    </g>\n  `)\n}\n\nfunction trashIcon() {\n  return (`\n    <g data-icon=\"trash\">\n      ${bgCircle()}\n      <path d=\"M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z\" />\n    </g>\n  `)\n}\n\nfunction historyBackIcon() {\n  return (`\n    <g data-icon=\"history-back\">\n      ${bgCircle()}\n      <path d=\"M20 13.5C20 17.09 17.09 20 13.5 20H6V18H13.5C16 18 18 16 18 13.5S16 9 13.5 9H7.83L10.91 12.09L9.5 13.5L4 8L9.5 2.5L10.92 3.91L7.83 7H13.5C17.09 7 20 9.91 20 13.5Z\" />\n    </g>\n  `)\n}\n\nfunction historyForwardIcon() {\n  return (`\n    <g data-icon=\"history-forward\">\n      ${bgCircle()}\n      <path d=\"M10.5 18H18V20H10.5C6.91 20 4 17.09 4 13.5S6.91 7 10.5 7H16.17L13.08 3.91L14.5 2.5L20 8L14.5 13.5L13.09 12.09L16.17 9H10.5C8 9 6 11 6 13.5S8 18 10.5 18Z\" />\n    </g>\n  `)\n}\n\nfunction personIcon() {\n  return (`\n    <g data-icon=\"person\">\n      <path d=\"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 \n        64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 \n        0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z\" />\n    </g>\n  `)\n}\n\nfunction miniTreeIcon() {\n  return (`\n    <g transform=\"translate(31,25)\" data-icon=\"mini-tree\">\n      <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n      <g>\n        <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n        <line y2=\"-17.5\" stroke=\"#fff\" />\n        <line x1=\"-20\" x2=\"20\" y1=\"-17.5\" y2=\"-17.5\" stroke=\"#fff\" />\n        <rect x=\"-31\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-male\" />\n        <rect x=\"6\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-female\" />\n      </g>\n    </g>\n  `)\n}\n\nfunction userSvgIcon() { return svgWrapper(userIcon()) }\nfunction userEditSvgIcon() { return svgWrapper(userEditIcon()) }\nfunction userPlusSvgIcon() { return svgWrapper(userPlusIcon()) }\nfunction userPlusCloseSvgIcon() { return svgWrapper(userPlusCloseIcon()) }\nfunction plusSvgIcon() { return svgWrapper(plusIcon()) }\nfunction pencilSvgIcon() { return svgWrapper(pencilIcon()) }\nfunction pencilOffSvgIcon() { return svgWrapper(pencilOffIcon()) }\nfunction trashSvgIcon() { return svgWrapper(trashIcon()) }\nfunction historyBackSvgIcon() { return svgWrapper(historyBackIcon()) }\nfunction historyForwardSvgIcon() { return svgWrapper(historyForwardIcon()) }\nfunction personSvgIcon() { return svgWrapper(personIcon(), '0 0 512 512') }\nfunction miniTreeSvgIcon() { return svgWrapper(miniTreeIcon(), '0 0 72 25') }\n\nfunction svgWrapper(icon, viewBox='0 0 24 24') {\n  const match = icon.match(/data-icon=\"([^\"]+)\"/);\n  const dataIcon = match ? `data-icon=\"${match[1]}\"` : '';\n  \n  return (`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"${viewBox}\" style=\"fill: currentColor\" ${dataIcon}>\n      ${icon}\n    </svg>\n  `)\n}\n\nfunction bgCircle() {\n  return (`\n    <circle r=\"12\" cx=\"12\" cy=\"12\" style=\"fill: rgba(0,0,0,0)\" />\n  `)\n}\n\nvar icons = /*#__PURE__*/Object.freeze({\n__proto__: null,\nuserIcon: userIcon,\nuserEditIcon: userEditIcon,\nuserPlusIcon: userPlusIcon,\nuserPlusCloseIcon: userPlusCloseIcon,\nplusIcon: plusIcon,\npencilIcon: pencilIcon,\npencilOffIcon: pencilOffIcon,\ntrashIcon: trashIcon,\nhistoryBackIcon: historyBackIcon,\nhistoryForwardIcon: historyForwardIcon,\npersonIcon: personIcon,\nminiTreeIcon: miniTreeIcon,\nuserSvgIcon: userSvgIcon,\nuserEditSvgIcon: userEditSvgIcon,\nuserPlusSvgIcon: userPlusSvgIcon,\nuserPlusCloseSvgIcon: userPlusCloseSvgIcon,\nplusSvgIcon: plusSvgIcon,\npencilSvgIcon: pencilSvgIcon,\npencilOffSvgIcon: pencilOffSvgIcon,\ntrashSvgIcon: trashSvgIcon,\nhistoryBackSvgIcon: historyBackSvgIcon,\nhistoryForwardSvgIcon: historyForwardSvgIcon,\npersonSvgIcon: personSvgIcon,\nminiTreeSvgIcon: miniTreeSvgIcon\n});\n\nfunction formInfoSetup(form_creator, closeCallback) {\n  const formContainer = document.createElement('div');\n  update();\n  return formContainer\n\n  function update() {\n    const formHtml = getHtml(form_creator);\n\n    formContainer.innerHTML = formHtml;\n  \n    setupEventListeners();\n\n    return formContainer\n  }\n\n  function setupEventListeners() {\n    const form = formContainer.querySelector('form');\n    form.addEventListener('submit', form_creator.onSubmit);\n\n    const cancel_btn = form.querySelector('.f3-cancel-btn');\n    cancel_btn.addEventListener('click', onCancel);\n\n    const edit_btn = form.querySelector('.f3-edit-btn');\n    if (edit_btn) edit_btn.addEventListener('click', onEdit);\n\n    const delete_btn = form.querySelector('.f3-delete-btn');\n    if (delete_btn && form_creator.onDelete) {\n      delete_btn.addEventListener('click', form_creator.onDelete);\n    }\n\n    const add_relative_btn = form.querySelector('.f3-add-relative-btn');\n    if (add_relative_btn && form_creator.addRelative) {\n      add_relative_btn.addEventListener('click', () => {\n        if (form_creator.addRelativeActive) form_creator.addRelativeCancel();\n        else form_creator.addRelative();\n        form_creator.addRelativeActive = !form_creator.addRelativeActive;\n        update();\n      });\n    }\n\n    const close_btn = form.querySelector('.f3-close-btn');\n    close_btn.addEventListener('click', closeCallback);\n\n    if (form_creator.other_parent_field) {\n      cancel_btn.style.display = 'none';\n    }\n\n    function onCancel() {\n      form_creator.editable = false;\n      if (form_creator.onCancel) form_creator.onCancel();\n      update();\n    }\n\n    function onEdit() {\n      form_creator.editable = !form_creator.editable;\n      update();\n    }\n  }\n}\n\n function getHtml(form_creator) {\n  return (` \n    <form id=\"familyForm\" class=\"f3-form ${form_creator.editable ? '' : 'non-editable'}\">\n      ${closeBtn()}\n      ${form_creator.title ? `<h3 class=\"f3-form-title\">${form_creator.title}</h3>` : ''}\n      <div style=\"text-align: right; display: ${form_creator.new_rel ? 'none' : 'block'}\">\n        ${form_creator.addRelative && !form_creator.no_edit ? addRelativeBtn() : ''}\n        ${form_creator.no_edit ? spaceDiv() : editBtn()}\n      </div>\n      ${genderRadio()}\n\n      ${fields()}\n\n      ${form_creator.other_parent_field ? otherParentField() : ''}\n\n      ${form_creator.onDelete ? deleteBtn() : ''}\n      \n      <div class=\"f3-form-buttons\">\n        <button type=\"button\" class=\"f3-cancel-btn\">Cancel</button>\n        <button type=\"submit\">Submit</button>\n      </div>\n    </form>\n  `)\n\n  function deleteBtn() {\n    return (`\n      <div>\n        <button type=\"button\" class=\"f3-delete-btn\" ${form_creator.can_delete ? '' : 'disabled'}>\n          Delete\n        </button>\n      </div>\n    `)\n  }\n\n  function addRelativeBtn() {\n    return (`\n      <span class=\"f3-add-relative-btn\">\n        ${form_creator.addRelativeActive ? userPlusCloseSvgIcon() : userPlusSvgIcon()}\n      </span>\n    `)\n  }\n\n  function editBtn() {\n    return (`\n      <span class=\"f3-edit-btn\">\n        ${form_creator.editable ? pencilOffSvgIcon() : pencilSvgIcon()}\n      </span>\n    `)\n  }\n\n  function genderRadio() {\n    if (!form_creator.editable) return ''\n    return (`\n      <div class=\"f3-radio-group\">\n        ${form_creator.gender_field.options.map(option => (`\n          <label>\n            <input type=\"radio\" name=\"${form_creator.gender_field.id}\" \n              value=\"${option.value}\" \n              ${option.value === form_creator.gender_field.initial_value ? 'checked' : ''}\n            >\n            ${option.label}\n          </label>\n        `)).join('')}\n      </div>\n    `)\n  }\n\n  function fields() {\n    if (!form_creator.editable) return infoField()\n    return form_creator.fields.map(field => (`\n      ${field.type === 'text' ? `\n        <div class=\"f3-form-field\">\n          <label>${field.label}</label>\n          <input type=\"${field.type}\" \n            name=\"${field.id}\" \n            value=\"${field.initial_value || ''}\"\n            placeholder=\"${field.label}\">\n        </div>\n      ` : field.type === 'textarea' ? `\n        <div class=\"f3-form-field\">\n          <label>${field.label}</label>\n          <textarea name=\"${field.id}\" \n            placeholder=\"${field.label}\">${field.initial_value || ''}</textarea>\n        </div>\n      ` : ''}\n    `)).join('')\n\n    function infoField() {\n      return form_creator.fields.map(field => (`\n        <div class=\"f3-info-field\">\n          <span class=\"f3-info-field-label\">${field.label}</span>\n          <span class=\"f3-info-field-value\">${field.initial_value || ''}</span>\n        </div>\n      `)).join('')\n    }\n  }\n\n  function otherParentField() {\n    return (`\n      <div class=\"f3-form-field\">\n        <label>${form_creator.other_parent_field.label}</label>\n        <select name=\"${form_creator.other_parent_field.id}\">\n          ${form_creator.other_parent_field.options.map(option => `\n            <option value=\"${option.value}\" \n              ${option.value === form_creator.other_parent_field.initial_value ? 'selected' : ''}>\n              ${option.label}\n            </option>\n          `).join('')}\n        </select>\n      </div>\n    `)\n  }\n\n  function closeBtn() {\n    return (`\n      <span class=\"f3-close-btn\">\n        \n      </span>\n    `)\n  }\n\n  function spaceDiv() {\n    return `<div style=\"height: 24px;\"></div>`\n  }\n}\n\nfunction createHistory(store, getStoreData, onUpdate) {\n  let history = [];\n  let history_index = -1;\n  \n  return {\n    changed,\n    back,\n    forward,\n    canForward,\n    canBack\n  }\n\n  function changed() {\n    if (history_index < history.length - 1) history = history.slice(0, history_index);\n    const clean_data = JSON.parse(cleanupDataJson(JSON.stringify(getStoreData())));\n    clean_data.main_id = store.getMainId();\n    history.push(clean_data);\n    history_index++;\n  }\n\n  function back() {\n    if (!canBack()) return\n    history_index--;\n    updateData(history[history_index]);\n  }\n\n  function forward() {\n    if (!canForward()) return\n    history_index++;\n    updateData(history[history_index]);\n  }\n\n  function canForward() {\n    return history_index < history.length - 1\n  }\n\n  function canBack() {\n    return history_index > 0\n  }\n\n  function updateData(data) {\n    store.updateMainId(data.main_id);\n    store.updateData(data);\n    onUpdate();\n  }\n}\n\nfunction createHistoryControls(cont, history, onUpdate=()=>{}) {\n  const history_controls = d3.select(cont).append(\"div\").attr(\"class\", \"f3-history-controls\");\n  const back_btn = history_controls.append(\"button\").attr(\"class\", \"f3-back-button\").on(\"click\", () => {\n    history.back();\n    updateButtons();\n    onUpdate();\n  });\n  const forward_btn = history_controls.append(\"button\").attr(\"class\", \"f3-forward-button\").on(\"click\", () => {\n    history.forward();\n    updateButtons();\n    onUpdate();\n  });\n\n  back_btn.html(historyBackSvgIcon());\n  forward_btn.html(historyForwardSvgIcon());\n\n  return {\n    back_btn: back_btn.node(),\n    forward_btn: forward_btn.node(),\n    updateButtons,\n    destroy\n  }\n\n  function updateButtons() {\n    back_btn.classed(\"disabled\", !history.canBack());\n    forward_btn.classed(\"disabled\", !history.canForward());\n    history_controls.style(\"display\", !history.canBack() && !history.canForward() ? \"none\" : null);\n  }\n\n  function destroy() {\n    history = null;\n    d3.select(cont).select('.f3-history-controls').remove();\n  }\n}\n\nvar handlers = /*#__PURE__*/Object.freeze({\n__proto__: null,\nmanualZoom: manualZoom,\nisAllRelativeDisplayed: isAllRelativeDisplayed,\ncardChangeMain: cardChangeMain,\ncardEdit: cardEdit,\ncardShowHideRels: cardShowHideRels,\nhandleRelsOfNewDatum: handleRelsOfNewDatum,\nhandleNewRel: handleNewRel,\ncreateNewPerson: createNewPerson,\ncreateNewPersonWithGenderFromRel: createNewPersonWithGenderFromRel,\naddNewPerson: addNewPerson,\ncreateTreeDataWithMainNode: createTreeDataWithMainNode,\naddNewPersonAndHandleRels: addNewPersonAndHandleRels,\ncheckIfRelativesConnectedWithoutPerson: checkIfRelativesConnectedWithoutPerson,\ncreateForm: createForm,\nmoveToAddToAdded: moveToAddToAdded,\nremoveToAdd: removeToAdd,\ndeletePerson: deletePerson,\ncleanupDataJson: cleanupDataJson,\nformInfoSetup: formInfoSetup,\ncreateHistory: createHistory,\ncreateHistoryControls: createHistoryControls,\ntreeFit: treeFit,\ncalculateTreeFit: calculateTreeFit,\ncardToMiddle: cardToMiddle\n});\n\nfunction CardBody({d,card_dim,card_display}) {\n  return {template: (`\n    <g class=\"card-body\">\n      <rect width=\"${card_dim.w}\" height=\"${card_dim.h}\" class=\"card-body-rect\" />\n      ${CardText({d,card_dim,card_display}).template}\n    </g>\n  `)\n  }\n}\n\nfunction CardText({d,card_dim,card_display}) {\n  return {template: (`\n    <g>\n      <g class=\"card-text\" clip-path=\"url(#card_text_clip)\">\n        <g transform=\"translate(${card_dim.text_x}, ${card_dim.text_y})\">\n          <text>\n            ${Array.isArray(card_display) ? card_display.map(cd => `<tspan x=\"${0}\" dy=\"${14}\">${cd(d.data)}</tspan>`).join('\\n') : card_display(d.data)}\n          </text>\n        </g>\n      </g>\n      <rect width=\"${card_dim.w-10}\" height=\"${card_dim.h}\" style=\"mask: url(#fade)\" class=\"text-overflow-mask\" /> \n    </g>\n  `)\n  }\n}\n\nfunction CardBodyAddNew({d,card_dim,card_add,label}) {\n  return {template: (`\n    <g class=\"card-body ${card_add ? 'card_add' : 'card-unknown'}\">\n      <rect class=\"card-body-rect\" width=\"${card_dim.w}\" height=\"${card_dim.h}\" fill=\"rgb(59, 85, 96)\" />\n      <text transform=\"translate(${card_dim.w/2}, ${card_dim.h/2})\" text-anchor=\"middle\" fill=\"#fff\">\n        <tspan font-size=\"18\" dy=\"${8}\">${label}</tspan>\n      </text>\n    </g>\n  `)\n  }\n}\n\nfunction CardBodyOutline({d,card_dim, is_new}) {\n  return {template: (`\n    <rect width=\"${card_dim.w}\" height=\"${card_dim.h}\" rx=\"4\" ry=\"4\" class=\"card-outline ${(d.data.main && !is_new) ? 'card-main-outline' : ''} ${is_new ? 'card-new-outline' : ''}\" />\n  `)\n  }\n}\n\nfunction PencilIcon({d,card_dim,x,y}) {\n  return ({template: (`\n    <g transform=\"translate(${x || card_dim.w-20},${y || card_dim.h-20})scale(.6)\" style=\"cursor: pointer\" class=\"card_edit pencil_icon\">\n      <circle fill=\"rgba(0,0,0,0)\" r=\"17\" cx=\"8.5\" cy=\"8.5\" />\n      <path fill=\"currentColor\" transform=\"translate(-1.5, -1.5)\"\n         d=\"M19.082,2.123L17.749,0.79c-1.052-1.052-2.766-1.054-3.819,0L1.925,12.794c-0.06,0.06-0.104,0.135-0.127,0.216\n          l-1.778,6.224c-0.05,0.175-0.001,0.363,0.127,0.491c0.095,0.095,0.223,0.146,0.354,0.146c0.046,0,0.092-0.006,0.137-0.02\n          l6.224-1.778c0.082-0.023,0.156-0.066,0.216-0.127L19.082,5.942C20.134,4.89,20.134,3.176,19.082,2.123z M3.076,13.057l9.428-9.428\n          l3.738,3.739l-9.428,9.428L3.076,13.057z M2.566,13.961l3.345,3.344l-4.683,1.339L2.566,13.961z M18.375,5.235L16.95,6.66\n          l-3.738-3.739l1.425-1.425c0.664-0.663,1.741-0.664,2.405,0l1.333,1.333C19.038,3.493,19.038,4.572,18.375,5.235z\"/>\n    </g>\n  `)})\n}\n\nfunction MiniTree({d,card_dim}) {\n  return ({template: (`\n    <g class=\"card_family_tree\" style=\"cursor: pointer\">\n      <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n      <g transform=\"translate(${card_dim.w*.8},6)scale(.9)\">\n        <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n        <line y2=\"-17.5\" stroke=\"#fff\" />\n        <line x1=\"-20\" x2=\"20\" y1=\"-17.5\" y2=\"-17.5\" stroke=\"#fff\" />\n        <rect x=\"-31\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-male\" />\n        <rect x=\"6\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-female\" />\n      </g>\n    </g>\n  `)})\n}\n\nfunction PlusIcon({d,card_dim,x,y}) {\n  return ({template: (`\n    <g class=\"card_add_relative\">\n      <g transform=\"translate(${x || card_dim.w/2},${y || card_dim.h})scale(.13)\">\n        <circle r=\"80\" cx=\"40\" cy=\"40\" fill=\"rgba(0,0,0,0)\" />\n        <g transform=\"translate(-10, -8)\">\n          <line\n            x1=\"10\" x2=\"90\" y1=\"50\" y2=\"50\"\n            stroke=\"currentColor\" stroke-width=\"15\" stroke-linecap=\"round\"\n          />\n          <line\n            x1=\"50\" x2=\"50\" y1=\"10\" y2=\"90\"\n            stroke=\"currentColor\" stroke-width=\"15\" stroke-linecap=\"round\"\n          />\n        </g>\n      </g>\n    </g>\n  `)})\n}\n\nfunction LinkBreakIcon({x,y,rt,closed}) {\n  return ({template: (`\n    <g style=\"\n          transform: translate(-12.2px, -.5px);\n          cursor: pointer;\n        \" \n        fill=\"currentColor\" class=\"card_break_link${closed ? ' closed' : ''}\"\n      >\n      <g style=\"transform: translate(${x}px,${y}px)scale(.02)rotate(${rt+'deg'})\">\n        <rect width=\"1000\" height=\"700\" y=\"150\" style=\"opacity: 0\" />\n        <g class=\"link_upper\">\n          <g>\n            <path d=\"M616.3,426.4c19,4.5,38.1-7.4,42.6-26.4c4.4-19-7.4-38-26.5-42.5L522.5,332c-18,11.1-53.9,33.4-53.9,33.4l80.4,18.6c-7.8,4.9-19.5,12.1-31.3,19.4L616.3,426.4L616.3,426.4z\"/>\n            <path d=\"M727.4,244.2c-50.2-11.6-100.3,3.3-135.7,35.4c28.6,22.6,64.5,30.2,116.4,51.3l141,32.6c23.9,5.6,56.6,47.2,51.1,71l-4.1,17c-5.6,23.7-47.3,56.4-71.2,51l-143.4-33.2c-66.8-8.6-104.1-16.6-132.9-7.5c17.4,44.9,55.9,80.8,106.5,92.4L800.9,588c81.3,18.8,162.3-31.5,181.2-112.4l4-17c18.8-81.1-31.7-161.8-112.9-180.6L727.4,244.2z\"/>\n          </g>\n        </g>\n        <g class=\"link_lower\">\n          <path d=\"M421.2,384.9l-128,127.6c-13.9,13.8-13.9,36.2,0,50s36.3,13.8,50.2,0.1l136.2-135.8v-36.7l-58.4,58.1V384.9L421.2,384.9z\"/>\n          <path d=\"M204.6,742.8c-17.4,17.3-63.3,17.2-80.6,0.1l-12.3-12.3c-17.3-17.3,0.6-81.2,17.9-98.5l100.2-99.9c12.5-14.9,45.8-40.8,66.1-103.7c-47.7-9.4-98.9,4.2-135.8,40.9L54.2,575c-58.9,58.8-58.9,154,0,212.8L66.6,800c58.9,58.8,154.5,58.8,213.4,0l105.8-105.6c38.4-38.3,51.3-91.9,39.7-141c-44,22.7-89,62.3-116,84.8L204.6,742.8z\"/>\n        </g>\n        <g class=\"link_particles\">\n          <path d=\"M351.9,248.4l-26.5,63.4l80.6,30.1L351.9,248.4z\"/>\n          <path d=\"M529.3,208l-43,26.6l35.4,52.3L529.3,208z\"/>\n          <path d=\"M426.6,158.8l-44-2.9l61.7,134.6L426.6,158.8z\"/>\n        </g>\n      </g>\n    </g>\n  `)})\n}\n\nfunction LinkBreakIconWrapper({d,card_dim}) {\n  let g = \"\",\n    r = d.data.rels, _r = d.data._rels || {},\n    closed = d.data.hide_rels,\n    areParents = r => r.father || r.mother,\n    areChildren = r => r.children && r.children.length > 0;\n  if ((d.is_ancestry || d.data.main) && (areParents(r) || areParents(_r))) {g+=LinkBreakIcon({x:card_dim.w/2,y:0, rt: -45, closed}).template;}\n  if (!d.is_ancestry && d.added) {\n    const sp = d.spouse, sp_r = sp.data.rels, _sp_r = sp.data._rels || {};\n    if ((areChildren(r) || areChildren(_r)) && (areChildren(sp_r) || areChildren(_sp_r))) {\n      g+=LinkBreakIcon({x:d.sx - d.x + card_dim.w/2 +24.4,y: (d.x !== d.sx ? card_dim.h/2 : card_dim.h)+1, rt: 135, closed}).template;\n    }\n  }\n  return {template: g}\n}\n\nfunction CardImage({d, image, card_dim, maleIcon, femaleIcon}) {\n  return ({template: (`\n    <g style=\"transform: translate(${card_dim.img_x}px,${card_dim.img_y}px);\" class=\"card_image\" clip-path=\"url(#card_image_clip)\">\n      ${image \n        ? `<image href=\"${image}\" height=\"${card_dim.img_h}\" width=\"${card_dim.img_w}\" preserveAspectRatio=\"xMidYMin slice\" />`\n        : (d.data.data.gender === \"F\" && !!femaleIcon) ? femaleIcon({card_dim}) \n        : (d.data.data.gender === \"M\" && !!maleIcon) ? maleIcon({card_dim}) \n        : GenderlessIcon()\n      }      \n    </g>\n  `)})\n\n  function GenderlessIcon() {\n    return (`\n      <g class=\"genderless-icon\">\n        <rect height=\"${card_dim.img_h}\" width=\"${card_dim.img_w}\" fill=\"rgb(59, 85, 96)\" />\n        <g transform=\"scale(${card_dim.img_w*0.001616})\">\n         <path transform=\"translate(50,40)\" fill=\"lightgrey\" d=\"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 \n            64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 \n            0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z\" />\n        </g>\n      </g>\n    `)\n  }\n}\n\nfunction appendTemplate(template, parent, is_first) {\n  const g = document.createElementNS(\"http://www.w3.org/2000/svg\", 'g');\n  g.innerHTML = template;\n\n  if (is_first) parent.insertBefore(g, parent.firstChild);\n  else parent.appendChild(g);\n}\n\nconst CardElements = {\n  miniTree,\n  lineBreak,\n  cardBody,\n  cardImage,\n  cardEdit: cardEditIcon,\n  cardAdd: cardAddIcon,\n};\n\nfunction miniTree(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  if (d.all_rels_displayed) return\n  const g = d3.create('svg:g').html(MiniTree({d,card_dim}).template);\n  g.on(\"click\", function (e) {\n    e.stopPropagation();\n    if (props.onMiniTreeClick) props.onMiniTreeClick.call(this, e, d);\n    else cardChangeMain(props.store, {d});\n  });\n  return g.node()\n}\n\nfunction lineBreak(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  const g = d3.create('svg:g').html(LinkBreakIconWrapper({d,card_dim}).template);\n  g.on(\"click\", (e) => {e.stopPropagation();cardShowHideRels(props.store, {d});});\n  return g.node()\n}\n\nfunction cardBody(d, props) {\n  const unknown_lbl = props.cardEditForm ? 'ADD' : 'UNKNOWN';\n  const card_dim = props.card_dim;\n\n  let g;\n  if (!d.data.to_add || !props.cardEditForm) {\n    g = d3.create('svg:g').html(CardBody({d, card_dim, card_display: props.card_display}).template);\n    g.on(\"click\", function (e) {\n      e.stopPropagation();\n      if (props.onCardClick) props.onCardClick.call(this, e, d);\n      else cardChangeMain(props.store, {d});\n    });\n  } else {\n    g = d3.create('svg:g').html(CardBodyAddNew({d, card_dim, card_add: props.cardEditForm, label: unknown_lbl}).template);\n    g.on(\"click\", (e) => {e.stopPropagation();cardEdit(props.store, {d, cardEditForm: props.cardEditForm});});\n  }\n  return g.node()\n}\n\nfunction cardImage(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  const g = d3.create('svg:g').html(CardImage({d, image: d.data.data.avatar || null, card_dim, maleIcon: null, femaleIcon: null}).template);\n  return g.node()\n}\n\nfunction cardEditIcon(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  const g = d3.create('svg:g').html(PencilIcon({card_dim, x: card_dim.w-46, y: card_dim.h-20}).template);\n  g.on(\"click\", (e) => {e.stopPropagation();cardEdit(props.store, {d, cardEditForm: props.cardEditForm});});\n\n  return g.node()\n}\n\nfunction cardAddIcon(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  const g = d3.create('svg:g').html(PlusIcon({card_dim, x: card_dim.w-26, y: card_dim.h-20}).template);\n  g.on(\"click\", (e) => {e.stopPropagation();props.addRelative({d});});\n\n  return g.node()\n}\n\n\nfunction appendElement(el_maybe, parent, is_first) {\n  if (!el_maybe) return\n  if (is_first) parent.insertBefore(el_maybe, parent.firstChild);\n  else parent.appendChild(el_maybe);\n}\n\nfunction setupCardSvgDefs(svg, card_dim) {\n  if (svg.querySelector(\"defs#f3CardDef\")) return\n  svg.insertAdjacentHTML('afterbegin', (`\n      <defs id=\"f3CardDef\">\n        <linearGradient id=\"fadeGrad\">\n          <stop offset=\"0.9\" stop-color=\"white\" stop-opacity=\"0\"/>\n          <stop offset=\".91\" stop-color=\"white\" stop-opacity=\".5\"/>\n          <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"1\"/>\n        </linearGradient>\n        <mask id=\"fade\" maskContentUnits=\"objectBoundingBox\"><rect width=\"1\" height=\"1\" fill=\"url(#fadeGrad)\"/></mask>\n        <clipPath id=\"card_clip\"><path d=\"${curvedRectPath({w:card_dim.w, h:card_dim.h}, 5)}\"></clipPath>\n        <clipPath id=\"card_text_clip\"><rect width=\"${card_dim.w-10}\" height=\"${card_dim.h}\"></rect></clipPath>\n        <clipPath id=\"card_image_clip\"><path d=\"M0,0 Q 0,0 0,0 H${card_dim.img_w} V${card_dim.img_h} H0 Q 0,${card_dim.img_h} 0,${card_dim.img_h} z\"></clipPath>\n        <clipPath id=\"card_image_clip_curved\"><path d=\"${curvedRectPath({w: card_dim.img_w, h:card_dim.img_h}, 5, ['rx', 'ry'])}\"></clipPath>\n      </defs>\n    `));\n\n  function curvedRectPath(dim, curve, no_curve_corners) {\n    const {w,h} = dim,\n      c = curve,\n      ncc = no_curve_corners || [],\n      ncc_check = (corner) => ncc.includes(corner),\n      lx = ncc_check('lx') ? `M0,0` : `M0,${c} Q 0,0 5,0`,\n      rx = ncc_check('rx') ? `H${w}` : `H${w-c} Q ${w},0 ${w},5`,\n      ry = ncc_check('ry') ? `V${h}` : `V${h-c} Q ${w},${h} ${w-c},${h}`,\n      ly = ncc_check('ly') ? `H0` : `H${c} Q 0,${h} 0,${h-c}`;\n\n    return (`${lx} ${rx} ${ry} ${ly} z`)\n  }\n}\n\nfunction updateCardSvgDefs(svg, card_dim) {\n  if (svg.querySelector(\"defs#f3CardDef\")) {\n    svg.querySelector(\"defs#f3CardDef\").remove();\n  }\n  setupCardSvgDefs(svg, card_dim);\n}\n\nfunction Card(props) {\n  props = setupProps(props);\n  setupCardSvgDefs(props.svg, props.card_dim);\n\n  return function (d) {\n    const gender_class = d.data.data.gender === 'M' ? 'card-male' : d.data.data.gender === 'F' ? 'card-female' : 'card-genderless';\n    const card_dim = props.card_dim;\n\n    const card = d3.create('svg:g').attr('class', `card ${gender_class}`).attr('transform', `translate(${[-card_dim.w / 2, -card_dim.h / 2]})`);\n    card.append('g').attr('class', 'card-inner').attr('clip-path', 'url(#card_clip)');\n\n    this.innerHTML = '';\n    this.appendChild(card.node());\n\n    appendTemplate(CardBodyOutline({d,card_dim,is_new:d.data.to_add}).template, card.node(), true);\n    appendElement(CardElements.cardBody(d, props), this.querySelector('.card-inner'));\n\n    if (props.img) appendElement(CardElements.cardImage(d, props), this.querySelector('.card'));\n    if (props.mini_tree) appendElement(CardElements.miniTree(d, props), this.querySelector('.card'), true);\n    if (props.link_break) appendElement(CardElements.lineBreak(d, props), this.querySelector('.card'));\n\n    if (props.cardEditForm) {\n      appendElement(CardElements.cardEdit(d, props), this.querySelector('.card-inner'));\n      appendElement(CardElements.cardAdd(d, props), this.querySelector('.card-inner'));\n    }\n\n    if (props.onCardUpdates) props.onCardUpdates.map(fn => fn.call(this, d));\n    if (props.onCardUpdate) props.onCardUpdate.call(this, d);\n  }\n\n  function setupProps(props) {\n    const default_props = {\n      img: true,\n      mini_tree: true,\n      link_break: false,\n      card_dim: {w:220,h:70,text_x:75,text_y:15,img_w:60,img_h:60,img_x:5,img_y:5}\n    };\n    if (!props) props = {};\n    for (const k in default_props) {\n      if (typeof props[k] === 'undefined') props[k] = default_props[k];\n    }\n    return props\n  }\n}\n\nfunction CardHtml(props) {\n  const cardInner = props.style === 'default' ? cardInnerDefault \n  : props.style === 'imageCircleRect' ? cardInnerImageCircleRect\n  : props.style === 'imageCircle' ? cardInnerImageCircle \n  : props.style === 'imageRect' ? cardInnerImageRect\n  : props.style === 'rect' ? cardInnerRect\n  : cardInnerDefault;\n\n  return function (d) {\n    this.innerHTML = (`\n    <div class=\"card ${getClassList(d).join(' ')}\" data-id=\"${d.data.id}\" style=\"transform: translate(-50%, -50%); pointer-events: auto;\">\n      ${props.mini_tree ? getMiniTree(d) : ''}\n      ${cardInner(d)}\n    </div>\n    `);\n    this.querySelector('.card').addEventListener('click', e => props.onCardClick(e, d));\n    if (props.onCardUpdate) props.onCardUpdate.call(this, d);\n\n    if (props.onCardMouseenter) d3.select(this).select('.card').on('mouseenter', e => props.onCardMouseenter(e, d));\n    if (props.onCardMouseleave) d3.select(this).select('.card').on('mouseleave', e => props.onCardMouseleave(e, d));\n  }\n\n  function getCardInnerImageCircle(d) {\n    return (`\n    <div class=\"card-inner card-image-circle\" ${getCardStyle()}>\n      ${d.data.data.avatar ? `<img src=\"${d.data.data[\"avatar\"]}\" ${getCardImageStyle()}>` : noImageIcon(d)}\n      <div class=\"card-label\">${textDisplay(d)}</div>\n    </div>\n    `)\n  }\n\n  function getCardInnerImageRect(d) {\n    return (`\n    <div class=\"card-inner card-image-rect\" ${getCardStyle()}>\n      ${d.data.data.avatar ? `<img src=\"${d.data.data[\"avatar\"]}\" ${getCardImageStyle()}>` : noImageIcon(d)}\n      <div class=\"card-label\">${textDisplay(d)}</div>\n    </div>\n    `)\n  }\n\n  function getCardInnerRect(d) {\n    return (`\n    <div class=\"card-inner card-rect\" ${getCardStyle()}>\n      ${textDisplay(d)}\n    </div>\n    `)\n  }\n\n  function textDisplay(d) {\n    if (d.data._new_rel_data) return newRelDataDisplay(d)\n    if (d.data.to_add) return `<div>ADD</div>`\n    return (`\n      ${props.card_display.map(display => `<div>${display(d.data)}</div>`).join('')}\n    `)\n  }\n\n  function newRelDataDisplay(d) {\n    const attr_list = [];\n    attr_list.push(`data-rel-type=\"${d.data._new_rel_data.rel_type}\"`);\n    if (['son', 'daughter'].includes(d.data._new_rel_data.rel_type)) attr_list.push(`data-other-parent-id=\"${d.data._new_rel_data.other_parent_id}\"`);\n    return `<div ${attr_list.join(' ')}>${d.data._new_rel_data.label}</div>`\n  }\n\n  function getMiniTree(d) {\n    if (!props.mini_tree) return ''\n    if (d.data.to_add) return ''\n    if (d.data._new_rel_data) return ''\n    if (d.all_rels_displayed) return ''\n    return `<div class=\"mini-tree\">${miniTreeSvgIcon()}</div>`\n  }\n\n  function cardInnerImageCircleRect(d) {\n    return d.data.data.avatar ? cardInnerImageCircle(d) : cardInnerRect(d)\n  }\n\n  function cardInnerDefault(d) {\n    return getCardInnerImageRect(d)\n  }\n\n  function cardInnerImageCircle(d) {\n    return getCardInnerImageCircle(d)\n  }\n\n  function cardInnerImageRect(d) {\n    return getCardInnerImageRect(d)\n  }\n\n  function cardInnerRect(d) {\n    return getCardInnerRect(d)\n  }\n\n  function getClassList(d) {\n    const class_list = [];\n    if (d.data.data.gender === 'M') class_list.push('card-male');\n    else if (d.data.data.gender === 'F') class_list.push('card-female');\n    else class_list.push('card-genderless');\n\n    if (d.data.main) class_list.push('card-main');\n\n    if (d.data._new_rel_data) class_list.push('card-new-rel');\n\n    if (d.data.to_add) class_list.push('card-to-add');\n\n    return class_list\n  }\n\n  function getCardStyle() {\n    let style = 'style=\"';\n    if (props.card_dim.w || props.card_dim.h) {\n      style += `width: ${props.card_dim.w}px; min-height: ${props.card_dim.h}px;`;\n      if (props.card_dim.height_auto) style += 'height: auto;';\n      else style += `height: ${props.card_dim.h}px;`;\n    } else {\n      return ''\n    }\n    style += '\"';\n    return style\n  }\n\n  function getCardImageStyle() {\n    let style = 'style=\"position: relative;';\n    if (props.card_dim.img_w || props.card_dim.img_h || props.card_dim.img_x || props.card_dim.img_y) {\n      style += `width: ${props.card_dim.img_w}px; height: ${props.card_dim.img_h}px;`;\n      style += `left: ${props.card_dim.img_x}px; top: ${props.card_dim.img_y}px;`;\n    } else {\n      return ''\n    }\n    style += '\"';\n    return style\n  }\n\n  function noImageIcon(d) {\n    if (d.data._new_rel_data) return `<div class=\"person-icon\" ${getCardImageStyle()}>${plusSvgIcon()}</div>`\n    return `<div class=\"person-icon\" ${getCardImageStyle()}>${personSvgIcon()}</div>`\n  }\n}\n\nvar elements = /*#__PURE__*/Object.freeze({\n__proto__: null,\nappendElement: appendElement,\nCard: Card,\nCardHtml: CardHtml\n});\n\nvar addRelative = (...args) => { return new AddRelative(...args) };\n\nfunction AddRelative(store, cancelCallback, onSubmitCallback) {\n  this.store = store;\n\n  this.cancelCallback = cancelCallback;\n  this.onSubmitCallback = onSubmitCallback;\n\n  this.datum = null;\n\n  this.onChange = null;\n  this.onCancel = null;\n\n  this.is_active = false;\n  this.store_data = null;\n\n  this.addRelLabels = this.addRelLabelsDefault();\n\n  return this\n}\n\nAddRelative.prototype.activate = function(datum) {\n  if (this.is_active) this.onCancel();\n  this.is_active = true;\n\n  const store = this.store;\n\n  this.store_data = store.getData();\n  this.datum = datum;\n  datum = JSON.parse(JSON.stringify(this.datum));\n\n  const datum_rels = getDatumRelsData(datum, this.store_data, this.addRelLabels);\n  store.updateData(datum_rels);\n  store.updateTree({});\n\n  this.onChange = onChange.bind(this);\n  this.onCancel = onCancel.bind(this);\n\n  function onChange(updated_datum) {\n    if (updated_datum?._new_rel_data) {\n      const new_rel_datum = updated_datum;\n      handleNewRel({datum: this.datum, new_rel_datum, data_stash: this.store_data});\n      this.onSubmitCallback(this.datum, new_rel_datum);\n    } else if (updated_datum.id === this.datum.id) {\n      this.datum.data = updated_datum.data;  // if in meanwhile the user changed the data for main datum, we need to keep it\n    } else {\n      console.error('Something went wrong');\n    }\n  }\n\n  function onCancel() {\n    if (!this.is_active) return\n    this.is_active = false;\n\n    store.updateData(this.store_data);\n    this.cancelCallback(this.datum);\n\n    this.store_data = null;\n    this.datum = null;\n    this.onChange = null;\n    this.onCancel = null;\n  }\n\n};\n\nAddRelative.prototype.setAddRelLabels = function(add_rel_labels) {\n  if (typeof add_rel_labels !== 'object') {\n    console.error('add_rel_labels must be an object');\n    return\n  }\n  for (let key in add_rel_labels) {\n    this.addRelLabels[key] = add_rel_labels[key];\n  }\n  return this\n};\n\nAddRelative.prototype.addRelLabelsDefault = function() {\n  return {\n    father: 'Add Father',\n    mother: 'Add Mother',\n    spouse: 'Add Spouse',\n    son: 'Add Son',\n    daughter: 'Add Daughter'\n  }\n};\n\nAddRelative.prototype.getStoreData = function() {\n  return this.store_data\n};\n\nfunction getDatumRelsData(datum, store_data, addRelLabels) {\n  const datum_rels = getDatumRels(datum, store_data);\n\n  if (!datum.rels.father) {\n    const father = createNewPerson({data: {gender: \"M\"}, rels: {children: [datum.id]}});\n    father._new_rel_data = {rel_type: \"father\", label: addRelLabels.father};\n    datum.rels.father = father.id;\n    datum_rels.push(father);\n  }\n  if (!datum.rels.mother) {\n    const mother = createNewPerson({data: {gender: \"F\"}, rels: {children: [datum.id]}});\n    mother._new_rel_data = {rel_type: \"mother\", label: addRelLabels.mother};\n    datum.rels.mother = mother.id;\n    datum_rels.push(mother);\n  }\n  const mother = datum_rels.find(d => d.id === datum.rels.mother);\n  const father = datum_rels.find(d => d.id === datum.rels.father);\n  mother.rels.spouses = [father.id];\n  father.rels.spouses = [mother.id];\n\n  mother.rels.children = [datum.id];\n  father.rels.children = [datum.id];\n\n  if (!datum.rels.spouses) datum.rels.spouses = [];\n  const new_spouse = createNewPerson({data: {gender: \"F\"}, rels: {spouses: [datum.id]}});\n  new_spouse._new_rel_data = {rel_type: \"spouse\", label: addRelLabels.spouse};\n  datum.rels.spouses.push(new_spouse.id);\n  datum_rels.push(new_spouse);\n\n  if (!datum.rels.children) datum.rels.children = [];\n  datum.rels.spouses.forEach(spouse_id => {\n    const spouse = datum_rels.find(d => d.id === spouse_id);\n    if (!spouse.rels.children) spouse.rels.children = [];\n    spouse.rels.children = spouse.rels.children.filter(child_id => datum.rels.children.includes(child_id));\n    \n    const new_son = createNewPerson({data: {gender: \"M\"}, rels: {father: datum.id, mother: spouse.id}});\n    new_son._new_rel_data = {rel_type: \"son\", label: addRelLabels.son, other_parent_id: spouse.id};\n    spouse.rels.children.push(new_son.id);\n    datum.rels.children.push(new_son.id);\n    datum_rels.push(new_son);\n\n    const new_daughter = createNewPerson({data: {gender: \"F\"}, rels: {mother: spouse.id, father: datum.id}});\n    new_daughter._new_rel_data = {rel_type: \"daughter\", label: addRelLabels.daughter, other_parent_id: spouse.id};\n    spouse.rels.children.push(new_daughter.id);\n    datum.rels.children.push(new_daughter.id);\n    datum_rels.push(new_daughter);\n  });\n\n  return datum_rels\n}\n\nfunction findRel(store_data, id) {\n  return JSON.parse(JSON.stringify(store_data.find(d => d.id === id)))\n}\n\nfunction getDatumRels(datum, data) {\n  const datum_rels = [datum];\n  Object.keys(datum.rels).forEach(rel_type => {\n    const rel = datum.rels[rel_type];\n    if (Array.isArray(rel)) {\n      rel.forEach(rel_id => {\n        findAndPushRel(rel_type, rel_id);\n      });\n    } else {\n      findAndPushRel(rel_type, rel);\n    }\n  });\n  return datum_rels\n\n  function findAndPushRel(rel_type, rel_id) {\n    const rel_datum = findRel(data, rel_id);\n    if (rel_type === 'father' || rel_type === 'mother') {\n      delete rel_datum.rels.father;\n      delete rel_datum.rels.mother;\n    }\n\n    if (rel_type === 'children') {\n      rel_datum.rels.children = [];\n      rel_datum.rels.spouses = [];\n    }\n\n    datum_rels.push(rel_datum);\n  }\n}\n\nfunction editTree(...args) { return new EditTree(...args) }\n\nfunction EditTree(cont, store) {\n  this.cont = cont;\n  this.store = store;\n\n  this.fields = [\n    {type: 'text', label: 'first name', id: 'first name'},\n    {type: 'text', label: 'last name', id: 'last name'},\n    {type: 'text', label: 'birthday', id: 'birthday'},\n    {type: 'text', label: 'avatar', id: 'avatar'}\n  ];\n\n  this.form_cont = null;\n\n  this.is_fixed = true;\n\n  this.history = null;\n  this.no_edit = false;\n\n  this.onChange = null;\n\n  this.editFirst = false;\n\n  this.init();\n\n  return this\n}\n\nEditTree.prototype.init = function() {\n  this.form_cont = d3.select(this.cont).append('div').classed('f3-form-cont', true).node();\n  this.addRelativeInstance = this.setupAddRelative();\n  this.createHistory();\n};\n\nEditTree.prototype.open = function(datum) {\n  if (datum.data.data) datum = datum.data;\n  if (this.addRelativeInstance.is_active && !datum._new_rel_data) {\n    this.addRelativeInstance.onCancel();\n    datum = this.store.getDatum(datum.id);\n  }\n\n  this.cardEditForm(datum);\n};\n\nEditTree.prototype.openWithoutRelCancel = function(datum) {\n  if (datum.data.data) datum = datum.data;\n\n  this.cardEditForm(datum);\n};\n\nEditTree.prototype.cardEditForm = function(datum) {\n  const props = {};\n  const is_new_rel = datum?._new_rel_data;\n  if (is_new_rel) {\n    props.onCancel = () => this.addRelativeInstance.onCancel();\n  } else {\n    props.addRelative = this.addRelativeInstance;\n    props.deletePerson = () => {\n      const data = this.store.getData();\n      deletePerson(datum, data);\n      this.store.updateData(data);\n      this.openFormWithId(this.store.getLastAvailableMainDatum().id);\n\n      this.store.updateTree({});\n    };\n  }\n\n  const form_creator = f3.handlers.createForm({\n    store: this.store, \n    datum, \n    postSubmit: postSubmit.bind(this),\n    fields: this.fields, \n    card_display: this.card_display, \n    addRelative: null,\n    onCancel: () => {},\n    editFirst: this.editFirst,\n    ...props\n  });\n\n  form_creator.no_edit = this.no_edit;\n  const form_cont = f3.handlers.formInfoSetup(form_creator, this.closeForm.bind(this));\n\n  this.form_cont.innerHTML = '';\n  this.form_cont.appendChild(form_cont);\n\n  this.openForm();\n\n  function postSubmit(props) {\n    if (this.addRelativeInstance.is_active) this.addRelativeInstance.onChange(datum);\n    else if (!props?.delete) this.openFormWithId(datum.id);\n\n    if (!this.is_fixed) this.closeForm();\n    \n    this.store.updateTree({});\n\n    this.updateHistory();\n  }\n};\n\nEditTree.prototype.openForm = function() {\n  d3.select(this.form_cont).classed('opened', true);\n};\n\nEditTree.prototype.closeForm = function() {\n  d3.select(this.form_cont).classed('opened', false).html('');\n  this.store.updateTree({});\n};\n\nEditTree.prototype.fixed = function() {\n  this.is_fixed = true;\n  d3.select(this.form_cont).style('position', 'relative');\n\n  return this\n};\n\nEditTree.prototype.absolute = function() {\n  this.is_fixed = false;\n  d3.select(this.form_cont).style('position', 'absolute');\n\n  return this\n};\n\nEditTree.prototype.setCardClickOpen = function(card) {\n  card.setOnCardClick((e, d) => {\n    if (this.addRelativeInstance.is_active) {\n      this.open(d);\n      return\n    }\n    this.open(d);\n    this.store.updateMainId(d.data.id);\n    this.store.updateTree({});\n  });\n\n  return this\n};\n\nEditTree.prototype.openFormWithId = function(d_id) {\n  if (d_id) {\n    const d = this.store.getDatum(d_id);\n    this.openWithoutRelCancel({data: d});\n  } else {\n    const d = this.store.getMainDatum();\n    this.openWithoutRelCancel({data: d});\n  }\n};\n\nEditTree.prototype.createHistory = function() {\n  this.history = f3.handlers.createHistory(this.store, this.getStoreData.bind(this), historyUpdateTree.bind(this));\n  this.history.controls = f3.handlers.createHistoryControls(this.cont, this.history);\n  this.history.changed();\n  this.history.controls.updateButtons();\n\n  return this\n\n  function historyUpdateTree() {\n    if (this.addRelativeInstance.is_active) this.addRelativeInstance.onCancel();\n    this.store.updateTree({initial: false});\n    this.history.controls.updateButtons();\n    this.openFormWithId(this.store.getMainDatum()?.id);\n  }\n};\n\nEditTree.prototype.setNoEdit = function() {\n  this.no_edit = true;\n\n  return this\n};\n\nEditTree.prototype.setEdit = function() {\n  this.no_edit = false;\n\n  return this\n};\n\nEditTree.prototype.setFields = function(fields) {\n  const new_fields = [];\n  if (!Array.isArray(fields)) {\n    console.error('fields must be an array');\n    return this\n  }\n  for (const field of fields) {\n    if (typeof field === 'string') {\n      new_fields.push({type: 'text', label: field, id: field});\n    } else if (typeof field === 'object') {\n      if (!field.id) {\n        console.error('fields must be an array of objects with id property');\n      } else {\n        new_fields.push(field);\n      }\n    } else {\n      console.error('fields must be an array of strings or objects');\n    }\n  }\n  this.fields = new_fields;\n\n  return this\n};\n\nEditTree.prototype.setOnChange = function(fn) {\n  this.onChange = fn;\n\n  return this\n};\n\nEditTree.prototype.addRelative = function(datum) {\n  if (!datum) datum = this.store.getMainDatum();\n  this.addRelativeInstance.activate(datum);\n\n  return this\n\n};\n\nEditTree.prototype.setupAddRelative = function() {\n  return addRelative(this.store, cancelCallback.bind(this), onSubmitCallback.bind(this))\n\n  function onSubmitCallback(datum, new_rel_datum) {\n    this.store.updateMainId(datum.id);\n    this.openFormWithId(datum.id);\n  }\n\n  function cancelCallback(datum) {\n    this.store.updateMainId(datum.id);\n    this.store.updateTree({});\n    this.openFormWithId(datum.id);\n  }\n};\n\nEditTree.prototype.setEditFirst = function(editFirst) {\n  this.editFirst = editFirst;\n\n  return this\n};\n\nEditTree.prototype.isAddingRelative = function() {\n  return this.addRelativeInstance.is_active\n};\n\nEditTree.prototype.setAddRelLabels = function(add_rel_labels) {\n  this.addRelativeInstance.setAddRelLabels(add_rel_labels);\n  return this\n};\n\nEditTree.prototype.getStoreData = function() {\n  if (this.addRelativeInstance.is_active) return this.addRelativeInstance.getStoreData()\n  else return this.store.getData()\n};\n\nEditTree.prototype.getDataJson = function(fn) {\n  const data = this.getStoreData();\n  return f3.handlers.cleanupDataJson(JSON.stringify(data))\n};\n\nEditTree.prototype.updateHistory = function() {\n  if (this.history) {\n    this.history.changed();\n    this.history.controls.updateButtons();\n  }\n\n  if (this.onChange) this.onChange();\n};\n\n\n\nEditTree.prototype.destroy = function() {\n  this.history.controls.destroy();\n  this.history = null;\n  d3.select(this.cont).select('.f3-form-cont').remove();\n  if (this.addRelativeInstance.onCancel) this.addRelativeInstance.onCancel();\n  this.store.updateTree({});\n\n  return this\n};\n\nfunction createChart(...args) { return new CreateChart(...args) }\n\nfunction CreateChart(cont, data) {\n  this.cont = null;\n  this.store = null;\n  this.svg = null;\n  this.getCard = null;\n  this.node_separation = 250;\n  this.level_separation = 150;\n  this.transition_time = 2000;\n\n  this.is_card_html = false;\n\n  this.beforeUpdate = null;\n  this.afterUpdate = null;\n\n  this.init(cont, data);\n\n  return this\n}\n\nCreateChart.prototype.init = function(cont, data) {\n  this.cont = cont = setCont(cont);\n  const getSvgView = () => cont.querySelector('svg .view');\n  const getHtmlSvg = () => cont.querySelector('#htmlSvg');\n  const getHtmlView = () => cont.querySelector('#htmlSvg .cards_view');\n\n  this.svg = f3.createSvg(cont, {onZoom: f3.htmlHandlers.onZoomSetup(getSvgView, getHtmlView)});\n  f3.htmlHandlers.createHtmlSvg(cont);\n\n  this.store = f3.createStore({\n    data,\n    node_separation: this.node_separation,\n    level_separation: this.level_separation\n  });\n\n  this.setCard(f3.CardSvg); // set default card\n\n  this.store.setOnUpdate(props => {\n    if (this.beforeUpdate) this.beforeUpdate(props);\n    props = Object.assign({}, props || {}, {transition_time: this.transition_time});\n    if (this.is_card_html) props = Object.assign({}, props || {}, {cardHtml: getHtmlSvg()});\n    f3.view(this.store.getTree(), this.svg, this.getCard(), props || {});\n    if (this.afterUpdate) this.afterUpdate(props);\n  });\n};\n\nCreateChart.prototype.updateTree = function({initial=false} = {}) {\n  this.store.updateTree({initial});\n\n  return this\n};\n\nCreateChart.prototype.updateData = function(data) {\n  this.store.updateData(data);\n\n  return this\n};\n\nCreateChart.prototype.setCardYSpacing = function(card_y_spacing) {\n  if (typeof card_y_spacing !== 'number') {\n    console.error('card_y_spacing must be a number');\n    return this\n  }\n  this.store.state.level_separation = card_y_spacing;\n\n  return this\n};\n\nCreateChart.prototype.setCardXSpacing = function(card_x_spacing) {\n  if (typeof card_x_spacing !== 'number') {\n    console.error('card_x_spacing must be a number');\n    return this\n  }\n  this.store.state.node_separation = card_x_spacing;\n\n  return this\n};\n\nCreateChart.prototype.setCard = function(Card) {\n  this.is_card_html = Card.is_html;\n\n  if (this.is_card_html) {\n    this.svg.querySelector('.cards_view').innerHTML = '';\n    this.cont.querySelector('#htmlSvg').style.display = 'block';\n  } else {\n    this.cont.querySelector('#htmlSvg .cards_view').innerHTML = '';\n    this.cont.querySelector('#htmlSvg').style.display = 'none';\n  }\n\n  const card = Card(this.cont, this.store);\n  this.getCard = () => card.getCard();\n\n  return card\n};\n\nCreateChart.prototype.setTransitionTime = function(transition_time) {\n  this.transition_time = transition_time;\n\n  return this\n};\n\nCreateChart.prototype.editTree = function() {\n  return editTree(this.cont, this.store)\n};\n\nCreateChart.prototype.updateMain = function(d) {\n  this.store.updateMainId(d.data.id);\n  this.store.updateTree({});\n\n  return this\n};\n\nCreateChart.prototype.updateMainId = function(id) {\n  this.store.updateMainId(id);\n\n  return this\n};\n\nCreateChart.prototype.getMainDatum = function() {\n  return this.store.getMainDatum()\n};\n\nCreateChart.prototype.getDataJson = function(fn) {\n  const data = this.store.getData();\n  return f3.handlers.cleanupDataJson(JSON.stringify(data))\n};\n\nCreateChart.prototype.updateData = function(data) {\n  this.store.updateData(data);\n};\n\nCreateChart.prototype.setBeforeUpdate = function(fn) {\n  this.beforeUpdate = fn;\n  return this\n};\n\nCreateChart.prototype.setAfterUpdate = function(fn) {\n  this.afterUpdate = fn;\n  return this\n};\n\nfunction setCont(cont) {\n  if (typeof cont === \"string\") cont = document.querySelector(cont);\n  return cont\n}\n\nfunction processCardDisplay(card_display) {\n  const card_display_arr = [];\n  if (Array.isArray(card_display)) {\n    card_display.forEach(d => {\n      if (typeof d === 'function') {\n        card_display_arr.push(d);\n      } else if (typeof d === 'string') {\n        card_display_arr.push(d1 => d1.data[d]);\n      } else if (Array.isArray(d)) {\n        card_display_arr.push(d1 => d.map(d2 => d1.data[d2]).join(' '));\n      }\n    });\n  } else if (typeof card_display === 'function') {\n    card_display_arr.push(card_display);\n  } else if (typeof card_display === 'string') {\n    card_display_arr.push(d1 => d1.data[card_display]);\n  }\n  return card_display_arr\n}\n\nCardSvgWrapper.is_html = false;\nfunction CardSvgWrapper(...args) { return new CardSvg(...args) }\n\nfunction CardSvg(cont, store) {\n  this.cont = cont;\n  this.store = store;\n  this.svg = null;\n  this.getCard = null;\n  this.card_dim = {w:220,h:70,text_x:75,text_y:15,img_w:60,img_h:60,img_x:5,img_y:5};\n  this.card_display = [d => `${d.data[\"first name\"]} ${d.data[\"last name\"]}`];\n  this.mini_tree = true;\n  this.link_break = false;\n  this.onCardClick = this.onCardClickDefault;\n  this.onCardUpdate = null;\n  this.onCardUpdates = null;\n\n  this.init();\n\n  return this\n}\n\nCardSvg.prototype.init = function() {\n  this.svg = this.cont.querySelector('svg.main_svg');\n\n  this.getCard = () => f3.elements.Card({\n    store: this.store,\n    svg: this.svg,\n    card_dim: this.card_dim,\n    card_display: this.card_display,\n    mini_tree: this.mini_tree,\n    link_break: this.link_break,\n    onCardClick: this.onCardClick,\n    onCardUpdate: this.onCardUpdate,\n    onCardUpdates: this.onCardUpdates\n  });\n};\n\nCardSvg.prototype.setCardDisplay = function(card_display) {\n  this.card_display = processCardDisplay(card_display);\n\n  return this\n};\n\nCardSvg.prototype.setCardDim = function(card_dim) {\n  if (typeof card_dim !== 'object') {\n    console.error('card_dim must be an object');\n    return this\n  }\n  for (let key in card_dim) {\n    const val = card_dim[key];\n    if (typeof val !== 'number') {\n      console.error(`card_dim.${key} must be a number`);\n      return this\n    }\n    if (key === 'width') key = 'w';\n    if (key === 'height') key = 'h';\n    this.card_dim[key] = val;\n  }\n\n  updateCardSvgDefs(this.svg, this.card_dim);\n\n  return this\n};\n\nCardSvg.prototype.setMiniTree = function(mini_tree) {\n  this.mini_tree = mini_tree;\n\n  return this\n};\n\nCardSvg.prototype.setLinkBreak = function(link_break) {\n  this.link_break = link_break;\n\n  return this\n};\n\nCardSvg.prototype.setCardTextSvg = function(cardTextSvg) {\n  function onCardUpdate(d) {\n    const card_node = d3.select(this);\n    const card_text = card_node.select('.card-text text');\n    const card_text_g = card_text.node().parentNode;\n    card_text_g.innerHTML = cardTextSvg(d.data);\n  }\n  onCardUpdate.id = 'setCardTextSvg';\n  if (!this.onCardUpdates) this.onCardUpdates = [];\n  this.onCardUpdates = this.onCardUpdates.filter(fn => fn.id !== 'setCardTextSvg');\n  this.onCardUpdates.push(onCardUpdate);\n\n  return this\n};\n\nCardSvg.prototype.onCardClickDefault = function(e, d) {\n  this.store.updateMainId(d.data.id);\n  this.store.updateTree({});\n};\n\nCardSvg.prototype.setOnCardClick = function(onCardClick) {\n  this.onCardClick = onCardClick;\n\n  return this\n};\n\nCardHtmlWrapper.is_html = true;\nfunction CardHtmlWrapper(...args) { return new CardHtml$1(...args) }\n\nCardHtml$1.prototype.is_html = true;\nfunction CardHtml$1(cont, store) {\n  this.cont = cont;\n  this.store = store;\n  this.getCard = null;\n  this.card_display = [d => `${d.data[\"first name\"]} ${d.data[\"last name\"]}`];\n  this.onCardClick = this.onCardClickDefault;\n  this.style = 'default';\n  this.mini_tree = false;\n  this.onCardUpdate = null;\n  this.card_dim = {};\n\n  this.init();\n\n  return this\n}\n\nCardHtml$1.prototype.init = function() {\n  this.svg = this.cont.querySelector('svg.main_svg');\n\n  this.getCard = () => f3.elements.CardHtml({\n    store: this.store,\n    card_display: this.card_display,\n    onCardClick: this.onCardClick,\n    style: this.style,\n    mini_tree: this.mini_tree,\n    onCardUpdate: this.onCardUpdate,\n    card_dim: this.card_dim,\n    onCardMouseenter: this.onCardMouseenter ? this.onCardMouseenter.bind(this) : null,\n    onCardMouseleave: this.onCardMouseleave ? this.onCardMouseleave.bind(this) : null\n  });\n};\n\nCardHtml$1.prototype.setCardDisplay = function(card_display) {\n  this.card_display = processCardDisplay(card_display);\n\n  return this\n};\n\nCardHtml$1.prototype.setOnCardClick = function(onCardClick) {\n  this.onCardClick = onCardClick;\n  return this\n};\n\nCardHtml$1.prototype.onCardClickDefault = function(e, d) {\n  this.store.updateMainId(d.data.id);\n  this.store.updateTree({});\n};\n\nCardHtml$1.prototype.setStyle = function(style) {\n  this.style = style;\n  return this\n};\n\nCardHtml$1.prototype.setMiniTree = function(mini_tree) {\n  this.mini_tree = mini_tree;\n\n  return this\n};\n\nCardHtml$1.prototype.setOnCardUpdate = function(onCardUpdate) {\n  this.onCardUpdate = onCardUpdate;\n  return this\n};\n\nCardHtml$1.prototype.setCardDim = function(card_dim) {\n  if (typeof card_dim !== 'object') {\n    console.error('card_dim must be an object');\n    return this\n  }\n  for (let key in card_dim) {\n    const val = card_dim[key];\n    if (typeof val !== 'number' && typeof val !== 'boolean') {\n      console.error(`card_dim.${key} must be a number or boolean`);\n      return this\n    }\n    if (key === 'width') key = 'w';\n    if (key === 'height') key = 'h';\n    if (key === 'img_width') key = 'img_w';\n    if (key === 'img_height') key = 'img_h';\n    if (key === 'img_x') key = 'img_x';\n    if (key === 'img_y') key = 'img_y';\n    this.card_dim[key] = val;\n  }\n\n  return this\n};\n\nCardHtml$1.prototype.resetCardDim = function() {\n  this.card_dim = {};\n  return this\n};\n\nCardHtml$1.prototype.setOnHoverPathToMain = function() {\n  this.onCardMouseenter = this.onEnterPathToMain.bind(this);\n  this.onCardMouseleave = this.onLeavePathToMain.bind(this);\n  return this\n};\n\nCardHtml$1.prototype.unsetOnHoverPathToMain = function() {\n  this.onCardMouseenter = null;\n  this.onCardMouseleave = null;\n  return this\n};\n\nCardHtml$1.prototype.onEnterPathToMain = function(e, datum) {\n  this.to_transition = datum.data.id;\n  const main_datum = this.store.getTreeMainDatum();\n  const cards = d3.select(this.cont).select('div.cards_view').selectAll('.card_cont');\n  const links = d3.select(this.cont).select('svg.main_svg .links_view').selectAll('.link');\n  const [cards_node_to_main, links_node_to_main] = pathToMain(cards, links, datum, main_datum);\n  cards_node_to_main.forEach(d => {\n    const delay = Math.abs(datum.depth - d.card.depth) * 200;\n    d3.select(d.node.querySelector('div.card-inner'))\n      .transition().duration(0).delay(delay)\n      .on('end', () => this.to_transition === datum.data.id && d3.select(d.node.querySelector('div.card-inner')).classed('f3-path-to-main', true));\n  });\n  links_node_to_main.forEach(d => {\n    const delay = Math.abs(datum.depth - d.link.depth) * 200;\n    d3.select(d.node)\n      .transition().duration(0).delay(delay)\n      .on('end', () => this.to_transition === datum.data.id && d3.select(d.node).classed('f3-path-to-main', true));\n  });\n\n  return this\n};\n\nCardHtml$1.prototype.onLeavePathToMain = function(e, d) {\n  this.to_transition = false;\n  d3.select(this.cont).select('div.cards_view').selectAll('div.card-inner').classed('f3-path-to-main', false);\n  d3.select(this.cont).select('svg.main_svg .links_view').selectAll('.link').classed('f3-path-to-main', false);\n\n  return this\n};\n\nvar f3 = {\n  CalculateTree,\n  createStore,\n  view,\n  createSvg,\n  handlers,\n  elements,\n  htmlHandlers,\n  icons,\n  createChart,\n\n  CardSvg: CardSvgWrapper,\n  CardHtml: CardHtmlWrapper,\n};\n\nreturn f3;\n\n})));\n","export { default } from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&lang=css\"; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&lang=css\""],"sourceRoot":""}