{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue","webpack:///./src/components/FamilyChart.vue","webpack:///./src/components/FamilyChart.vue?890d","webpack:///./src/App.vue?dfb6","webpack:///./src/main.js","webpack:///./src/components/family-chart/dist/family-chart.js","webpack:///./src/App.vue?3f7e"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","id","class","style","mounted","cont","document","querySelector","store","createStore","node_separation","level_separation","svg","createSvg","Card","elements","card_dim","w","h","text_x","text_y","img_w","img_h","img_x","img_y","card_display","mini_tree","link_break","setOnUpdate","props","view","getTree","updateTree","initial","render","components","FamilyChart","createApp","App","mount","global","factory","require","define","this","_d3","_interopNamespace","e","keys","forEach","k","getOwnPropertyDescriptor","freeze","_d3__namespace","d3","sortChildrenWithSpouses","datum","rels","children","sort","a","b","a_d","find","b_d","a_p2","otherParent","b_p2","a_i","spouses","indexOf","b_i","gender","p1","d0","mother","father","calculateEnterAndExitPositions","entering","exiting","depth","spouse","_x","x","_y","y","is_ancestry","parent","psx","toggleRels","tree_datum","hide_rels","rels_","showHideAncestry","rel_type","showHideChildren","sp","ch_id","includes","main","toggleAllRels","tree_data","checkIfRelativesConnectedWithoutPerson","data_stash","r_ids","filter","r_id","rels_not_to_main","line","findPersonLineToMain","without_persons","isM","checkIfAnyRelIsMain","history","runAllRels","f","d_id","check","checkRels","person","createForm","fields","postSubmit","addRelative","deletePerson","onCancel","editFirst","form_creator","onSubmit","submitFormChanges","_new_rel_data","onDelete","deletePersonWithPostSubmit","activate","addRelativeCancel","addRelativeActive","is_active","editable","title","label","new_rel","can_delete","getData","gender_field","type","initial_value","options","field","preventDefault","form_data","FormData","target","v","to_add","delete","moveToAddToAdded","removeToAdd","executeDelete","success","error","Array","isArray","findIndex","did","createTreeDataWithMainNode","cleanupDataJson","data_json","data_no_to_add","JSON","parse","stringify","handleRelsOfNewDatum","rel_datum","addChild","other_parent","addChildToSpouseAndParentToChild","spouse_id","addOtherParent","new_spouse","createNewPersonWithGenderFromRel","addSpouse","addNewPerson","addParent","is_father","parent_to_add_id","addNewParent","handleSpouse","removeIfToAdd","handleNewRel","new_rel_datum","createNewPerson","child_id","child","generateUUID","getGenderFromRelative","assign","version","addNewPersonAndHandleRels","Date","getTime","d2","performance","now","replace","Math","random","floor","toString","manualZoom","amount","transition_time","zoom","__zoomObj","select","transition","duration","delay","scaleBy","isAllRelativeDisplayed","all_rels","every","rel_id","some","CalculateTree","main_id","dim","width","height","is_vertical","createRelsToAdd","tree_children","calculateTreePositions","tree_parents","levelOutEachSide","tree","mergeSides","setupChildrenAndParents","setupSpouses","nodePositioning","all_rels_displayed","calculateTreeDim","rt","hierarchyGetter","hierarchyGetterChildren","hierarchyGetterParents","d3_tree","nodeSize","separation","root","hierarchy","descendants","offset","sameParent","someSpouses","offsetOnPartners","sameBothParents","hasSpouses","map","parents","mid_diff","d_x","side","sp_id","added","sx","p2","midd","d1","w_extent","extent","h_extent","x_off","y_off","to_add_spouses","createToAddSpouse","initial_state","onUpdate","state","main_id_history","calcTree","updateMainId","updateData","getMainId","getMainDatum","getDatum","getTreeMainDatum","getTreeDatum","getLastAvailableMainDatum","methods","reverse","positionTree","el_listener","parentNode","transform","zoomIdentity","scale","translate","treeFit","svg_dim","tree_dim","with_transition","calculateTreeFit","min","cardToMiddle","createLinks","links","handleAncestrySide","handleProgenySide","getMid","Link","_d","_p","curve","linkId","source","_or","getRel","is_","hy","args","join","condition","dist_xy","sqrt","pow","pathToMain","cards","main_datum","links_data","links_node_to_main","cards_node_to_main","links_to_main","itteration1","spouse_link","child_link","each","link","node","cards_to_main","getCardsToMain","card","sameArray","arr1","arr2","first_parent","all_cards","reduce","acc","getChildren","createPath","curveMonotoneY","lineCurve","curveBasis","path_data","updateLinks","concat","selectAll","link_exit","exit","link_enter","enter","append","attr","link_update","merge","linkEnter","linkUpdate","path","calculateDelay","linkExit","on","remove","updateCards","card_exit","card_enter","card_update","cardEnter","cardUpdateNoEnter","cardUpdate","cardExit","g","updateCardsHtml","div","assignUniqueIdToTreeData","unique_id","setupHtmlSvg","getHtmlSvg","getCardsViewFake","onZoomSetup","getSvgView","getHtmlView","setupReactiveTreeData","new_tree_data","tree_data_exit","getTreeDataExit","createHtmlSvg","f3Canvas","cardHtml","old_tree_data","getUniqueId","htmlHandlers","__proto__","updateCardsComponent","card_element","cardComponent","tree_position","getBoundingClientRect","delay_level","ancestry_levels","max","svg_html","getOrCreateF3Canvas","temp_div","innerHTML","appendChild","setupZoom","el","__zoom","onZoom","zoomed","zoom_polite","zoomFilter","ctrlKey","touches","cardChangeMain","tree_fit_on_change","cardEdit","cardEditForm","cardShowHideRels","userIcon","bgCircle","userEditIcon","userPlusIcon","userPlusCloseIcon","plusIcon","pencilIcon","pencilOffIcon","trashIcon","historyBackIcon","historyForwardIcon","personIcon","miniTreeIcon","userSvgIcon","svgWrapper","userEditSvgIcon","userPlusSvgIcon","userPlusCloseSvgIcon","plusSvgIcon","pencilSvgIcon","pencilOffSvgIcon","trashSvgIcon","historyBackSvgIcon","historyForwardSvgIcon","personSvgIcon","miniTreeSvgIcon","icon","viewBox","match","dataIcon","icons","formInfoSetup","closeCallback","formContainer","createElement","update","formHtml","getHtml","setupEventListeners","form","addEventListener","cancel_btn","edit_btn","onEdit","delete_btn","add_relative_btn","close_btn","other_parent_field","display","closeBtn","no_edit","addRelativeBtn","spaceDiv","editBtn","genderRadio","otherParentField","deleteBtn","option","infoField","createHistory","getStoreData","history_index","changed","back","forward","canForward","canBack","clean_data","createHistoryControls","history_controls","back_btn","updateButtons","forward_btn","html","destroy","classed","handlers","CardBody","template","CardText","cd","CardBodyAddNew","card_add","CardBodyOutline","is_new","PencilIcon","MiniTree","PlusIcon","LinkBreakIcon","closed","LinkBreakIconWrapper","_r","_rels","areParents","areChildren","sp_r","_sp_r","CardImage","image","maleIcon","femaleIcon","GenderlessIcon","appendTemplate","is_first","createElementNS","insertBefore","firstChild","CardElements","miniTree","lineBreak","cardBody","cardImage","cardEditIcon","cardAdd","cardAddIcon","stopPropagation","onMiniTreeClick","unknown_lbl","onCardClick","avatar","appendElement","el_maybe","setupCardSvgDefs","curvedRectPath","no_curve_corners","ncc","ncc_check","corner","lx","rx","ry","ly","insertAdjacentHTML","updateCardSvgDefs","setupProps","gender_class","img","onCardUpdates","fn","onCardUpdate","default_props","CardHtml","cardInner","cardInnerDefault","cardInnerImageCircleRect","cardInnerImageCircle","cardInnerImageRect","cardInnerRect","getClassList","getMiniTree","onCardMouseenter","onCardMouseleave","getCardInnerImageCircle","getCardStyle","getCardImageStyle","noImageIcon","textDisplay","getCardInnerImageRect","getCardInnerRect","newRelDataDisplay","attr_list","other_parent_id","class_list","height_auto","AddRelative","cancelCallback","onSubmitCallback","onChange","store_data","addRelLabels","addRelLabelsDefault","getDatumRelsData","datum_rels","getDatumRels","new_son","son","new_daughter","daughter","findRel","rel","findAndPushRel","editTree","EditTree","form_cont","is_fixed","init","createChart","CreateChart","getCard","is_card_html","beforeUpdate","afterUpdate","setCont","processCardDisplay","card_display_arr","CardSvgWrapper","CardSvg","onCardClickDefault","CardHtmlWrapper","CardHtml$1","updated_datum","console","setAddRelLabels","add_rel_labels","addRelativeInstance","setupAddRelative","open","openWithoutRelCancel","is_new_rel","openFormWithId","f3","closeForm","updateHistory","openForm","fixed","absolute","setCardClickOpen","setOnCardClick","historyUpdateTree","controls","setNoEdit","setEdit","setFields","new_fields","setOnChange","setEditFirst","isAddingRelative","getDataJson","setCard","setCardYSpacing","card_y_spacing","setCardXSpacing","card_x_spacing","is_html","setTransitionTime","updateMain","setBeforeUpdate","setAfterUpdate","setCardDisplay","setCardDim","val","setMiniTree","setLinkBreak","setCardTextSvg","cardTextSvg","card_node","card_text","card_text_g","setStyle","setOnCardUpdate","resetCardDim","setOnHoverPathToMain","onEnterPathToMain","onLeavePathToMain","unsetOnHoverPathToMain","to_transition","abs"],"mappings":"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","file":"js/app.40ab9739.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/docs/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","<template>\n  <FamilyChart />\n</template>\n\n<script>\nimport FamilyChart from \"./components/FamilyChart.vue\";\nexport default {\n  name: \"App\",\n  components: {\n    FamilyChart,\n  },\n};\n</script>\n\n<style>\nhtml {\n  font-family: \"sans-serif\";\n}\n</style>\n","\n<template>\n  <div id=\"app\">\n    <div id=\"FamilyChart\" class=\"f3\" style=\"width:100%;height:900px;margin:auto;background-color:rgb(33,33,33);color:#fff;\"></div>\n  </div>\n</template>\n\n<script>\nimport ft from './data.json';\nimport f3 from \"./family-chart/dist/family-chart.js\";\nimport './family-chart.css';  // create file 'family-chart.css' in same directory, copy/paste css from examples/create-tree\n\nexport default {\n  mounted() {\n  // fetch('https://raw.githubusercontent.com/giatoc/family-tree/refs/heads/master/src/components/data.json')\n  // .then(res => res.json())\n  // .then(data => create(data))\n  // .catch(err => console.error(err))\n\n    create(data())\n\n    function create(data) {\n      const cont = document.querySelector(\"div#FamilyChart\")  // make sure to create div with id FamilyChart\n      const store = f3.createStore({\n        data,\n        node_separation: 250,\n        level_separation: 150\n      })\n      const svg = f3.createSvg(cont)\n      const Card = f3.elements.Card({\n        store,\n        svg,\n        card_dim: {w:220,h:70,text_x:75,text_y:15,img_w:60,img_h:60,img_x:5,img_y:5},\n        card_display: [d => `${d.data['first name'] || ''} ${d.data['last name'] || ''}`, d => `${d.data['birthday'] || ''}`],\n        mini_tree: true,\n        link_break: false\n      })\n\n      store.setOnUpdate(props => f3.view(store.getTree(), svg, Card, props || {}))\n      store.updateTree({initial: true})\n    }\n\n    function data() {\n      return ft\n    }\n  }\n};\n</script>\n<style></style>","import { render } from \"./FamilyChart.vue?vue&type=template&id=0e403f39&bindings={}\"\nimport script from \"./FamilyChart.vue?vue&type=script&lang=js\"\nexport * from \"./FamilyChart.vue?vue&type=script&lang=js\"\nscript.render = render\n\nexport default script","import { render } from \"./App.vue?vue&type=template&id=37fb207f&bindings={}\"\nimport script from \"./App.vue?vue&type=script&lang=js\"\nexport * from \"./App.vue?vue&type=script&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&lang=css\"\nscript.render = render\n\nexport default script","import { createApp } from 'vue'\nimport App from './App.vue'\n\ncreateApp(App).mount('#app')\n","// https://donatso.github.io/family-chart/ v0.1.1 Copyright 2024 donatso\n(function (global, factory) {\ntypeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('d3')) :\ntypeof define === 'function' && define.amd ? define(['d3'], factory) :\n(global = typeof globalThis !== 'undefined' ? globalThis : global || self, global.f3 = factory(global.f3));\n}(this, (function (_d3) { 'use strict';\n\nfunction _interopNamespace(e) {\nif (e && e.__esModule) return e;\nvar n = Object.create(null);\nif (e) {\nObject.keys(e).forEach(function (k) {\nif (k !== 'default') {\nvar d = Object.getOwnPropertyDescriptor(e, k);\nObject.defineProperty(n, k, d.get ? d : {\nenumerable: true,\nget: function () {\nreturn e[k];\n}\n});\n}\n});\n}\nn['default'] = e;\nreturn Object.freeze(n);\n}\n\nvar _d3__namespace = /*#__PURE__*/_interopNamespace(_d3);\n\nvar d3 = typeof window === \"object\" && !!window.d3 ? window.d3 : _d3__namespace;\n\nfunction sortChildrenWithSpouses(data) {\n  data.forEach(datum => {\n    if (!datum.rels.children) return\n    datum.rels.children.sort((a, b) => {\n      const a_d = data.find(d => d.id === a),\n        b_d = data.find(d => d.id === b),\n        a_p2 = otherParent(a_d, datum, data) || {},\n        b_p2 = otherParent(b_d, datum, data) || {},\n        a_i = datum.rels.spouses.indexOf(a_p2.id),\n        b_i = datum.rels.spouses.indexOf(b_p2.id);\n\n      if (datum.data.gender === \"M\") return a_i - b_i\n      else return b_i - a_i\n    });\n  });\n}\n\nfunction otherParent(d, p1, data) {\n  return data.find(d0 => (d0.id !== p1.id) && ((d0.id === d.rels.mother) || (d0.id === d.rels.father)))\n}\n\nfunction calculateEnterAndExitPositions(d, entering, exiting) {\n  d.exiting = exiting;\n  if (entering) {\n    if (d.depth === 0 && !d.spouse) {d._x = d.x; d._y = d.y;}\n    else if (d.spouse) {d._x = d.spouse.x; d._y = d.spouse.y;}\n    else if (d.is_ancestry) {d._x = d.parent.x; d._y = d.parent.y;}\n    else {d._x = d.psx; d._y = d.parent.y;}\n  } else if (exiting) {\n    const x = d.x > 0 ? 1 : -1,\n      y = d.y > 0 ? 1 : -1;\n    {d._x = d.x+400*x; d._y = d.y+400*y;}\n  }\n}\n\nfunction toggleRels(tree_datum, hide_rels) {\n  const\n    rels = hide_rels ? 'rels' : '_rels',\n    rels_ = hide_rels ? '_rels' : 'rels';\n  \n  if (tree_datum.is_ancestry || tree_datum.data.main) {showHideAncestry('father'); showHideAncestry('mother');}\n  else {showHideChildren();}\n\n  function showHideAncestry(rel_type) {\n    if (!tree_datum.data[rels] || !tree_datum.data[rels][rel_type]) return\n    if (!tree_datum.data[rels_]) tree_datum.data[rels_] = {};\n    tree_datum.data[rels_][rel_type] = tree_datum.data[rels][rel_type];\n    delete tree_datum.data[rels][rel_type];\n  }\n\n  function showHideChildren() {\n    if (!tree_datum.data[rels] || !tree_datum.data[rels].children) return\n    const\n      children = tree_datum.data[rels].children.slice(0),\n      spouses = tree_datum.spouse ? [tree_datum.spouse] : tree_datum.spouses || [];\n\n    [tree_datum, ...spouses].forEach(sp => children.forEach(ch_id => {\n      if (sp.data[rels].children.includes(ch_id)) {\n        if (!sp.data[rels_]) sp.data[rels_] = {};\n        if (!sp.data[rels_].children) sp.data[rels_].children = [];\n        sp.data[rels_].children.push(ch_id);\n        sp.data[rels].children.splice(sp.data[rels].children.indexOf(ch_id), 1);\n      }\n    }));\n  }\n}\n\nfunction toggleAllRels(tree_data, hide_rels) {\n  tree_data.forEach(d => {d.data.hide_rels = hide_rels; toggleRels(d, hide_rels);});\n}\n\nfunction checkIfRelativesConnectedWithoutPerson(datum, data_stash) {\n  const r = datum.rels,\n    r_ids = [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])].filter(r_id => !!r_id),\n    rels_not_to_main = [];\n\n  for (let i = 0; i < r_ids.length; i++) {\n    const line = findPersonLineToMain(data_stash.find(d => d.id === r_ids[i]), [datum]);\n    if (!line) {rels_not_to_main.push(r_ids[i]); break;}\n  }\n  return rels_not_to_main.length === 0;\n\n  function findPersonLineToMain(datum, without_persons) {\n    let line;\n    if (isM(datum)) line = [datum];\n    checkIfAnyRelIsMain(datum, [datum]);\n    return line\n\n    function checkIfAnyRelIsMain(d0, history) {\n      if (line) return\n      history = [...history, d0];\n      runAllRels(check);\n      if (!line) runAllRels(checkRels);\n\n      function runAllRels(f) {\n        const r = d0.rels;\n        [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])]\n          .filter(d_id => (d_id && ![...without_persons, ...history].find(d => d.id === d_id)))\n          .forEach(d_id => f(d_id));\n      }\n\n      function check(d_id) {\n        if (isM(d_id)) line = history;\n      }\n\n      function checkRels(d_id) {\n        const person = data_stash.find(d => d.id === d_id);\n        checkIfAnyRelIsMain(person, history);\n      }\n    }\n  }\n  function isM(d0) {return typeof d0 === 'object' ? d0.id === data_stash[0].id : d0 === data_stash[0].id}  // todo: make main more exact\n}\n\nfunction createForm({datum, store, fields, postSubmit, addRelative, deletePerson, onCancel, editFirst}) {\n  const form_creator = {\n    fields: [],\n    onSubmit: submitFormChanges,\n  };\n  if (!datum._new_rel_data) {\n    form_creator.onDelete = deletePersonWithPostSubmit;\n    form_creator.addRelative = () => addRelative.activate(datum),\n    form_creator.addRelativeCancel = () => addRelative.onCancel();\n    form_creator.addRelativeActive = addRelative.is_active;\n\n    form_creator.editable = false;\n  }\n  if (datum._new_rel_data) {\n    form_creator.title = datum._new_rel_data.label;\n    form_creator.new_rel = true;\n    form_creator.editable = true;\n    form_creator.onCancel = onCancel;\n  }\n  if (form_creator.onDelete) form_creator.can_delete = checkIfRelativesConnectedWithoutPerson(datum, store.getData());\n\n  if (editFirst) form_creator.editable = true;\n\n  form_creator.gender_field = {\n    id: 'gender', \n    type: 'switch',\n    label: 'Gender',\n    initial_value: datum.data.gender,\n    options: [{value: 'M', label: 'Male'}, {value: 'F', label: 'Female'}]\n  };\n\n  fields.forEach(d => {\n    const field = {\n      id: d.id,\n      type: d.type,\n      label: d.label,\n      initial_value: datum.data[d.id],\n    };\n    form_creator.fields.push(field);\n  });\n\n  return form_creator\n\n  function submitFormChanges(e) {\n    e.preventDefault();\n    const form_data = new FormData(e.target);\n    form_data.forEach((v, k) => datum.data[k] = v);\n    if (datum.to_add) delete datum.to_add;\n    postSubmit();\n  }\n\n  function deletePersonWithPostSubmit() {\n    deletePerson();\n    postSubmit({delete: true});\n  }\n}\n\nfunction moveToAddToAdded(datum, data_stash) {\n  delete datum.to_add;\n  return datum\n}\n\nfunction removeToAdd(datum, data_stash) {\n  deletePerson(datum, data_stash);\n  return false\n}\n\nfunction deletePerson(datum, data_stash) {\n  if (!checkIfRelativesConnectedWithoutPerson(datum, data_stash)) return {success: false, error: 'checkIfRelativesConnectedWithoutPerson'}\n  executeDelete();\n  return {success: true};\n\n  function executeDelete() {\n    data_stash.forEach(d => {\n      for (let k in d.rels) {\n        if (!d.rels.hasOwnProperty(k)) continue\n        if (d.rels[k] === datum.id) {\n          delete d.rels[k];\n        } else if (Array.isArray(d.rels[k]) && d.rels[k].includes(datum.id)) {\n          d.rels[k].splice(d.rels[k].findIndex(did => did === datum.id), 1);\n        }\n      }\n    });\n    data_stash.splice(data_stash.findIndex(d => d.id === datum.id), 1);\n    data_stash.forEach(d => {if (d.to_add) deletePerson(d, data_stash);});  // full update of tree\n    if (data_stash.length === 0) data_stash.push(createTreeDataWithMainNode({}).data[0]);\n  }\n}\n\nfunction cleanupDataJson(data_json) {\n  let data_no_to_add = JSON.parse(data_json);\n  data_no_to_add.forEach(d => d.to_add ? removeToAdd(d, data_no_to_add) : d);\n  data_no_to_add.forEach(d => delete d.main);\n  data_no_to_add.forEach(d => delete d.hide_rels);\n  return JSON.stringify(data_no_to_add, null, 2)\n}\n\nfunction handleRelsOfNewDatum({datum, data_stash, rel_type, rel_datum}) {\n  if (rel_type === \"daughter\" || rel_type === \"son\") addChild(datum);\n  else if (rel_type === \"father\" || rel_type === \"mother\") addParent(datum);\n  else if (rel_type === \"spouse\") addSpouse(datum);\n\n  function addChild(datum) {\n    if (datum.data.other_parent) {\n      addChildToSpouseAndParentToChild(datum.data.other_parent);\n      delete datum.data.other_parent;\n    }\n    datum.rels[rel_datum.data.gender === 'M' ? 'father' : 'mother'] = rel_datum.id;\n    if (!rel_datum.rels.children) rel_datum.rels.children = [];\n    rel_datum.rels.children.push(datum.id);\n    return datum\n\n    function addChildToSpouseAndParentToChild(spouse_id) {\n      if (spouse_id === \"_new\") spouse_id = addOtherParent().id;\n\n      const spouse = data_stash.find(d => d.id === spouse_id);\n      datum.rels[spouse.data.gender === 'M' ? 'father' : 'mother'] = spouse.id;\n      if (!spouse.rels.hasOwnProperty('children')) spouse.rels.children = [];\n      spouse.rels.children.push(datum.id);\n\n      function addOtherParent() {\n        const new_spouse = createNewPersonWithGenderFromRel({rel_type: \"spouse\", rel_datum});\n        addSpouse(new_spouse);\n        addNewPerson({data_stash, datum: new_spouse});\n        return new_spouse\n      }\n    }\n  }\n\n  function addParent(datum) {\n    const is_father = datum.data.gender === \"M\",\n      parent_to_add_id = rel_datum.rels[is_father ? 'father' : 'mother'];\n    if (parent_to_add_id) removeToAdd(data_stash.find(d => d.id === parent_to_add_id), data_stash);\n    addNewParent();\n\n    function addNewParent() {\n      rel_datum.rels[is_father ? 'father' : 'mother'] = datum.id;\n      handleSpouse();\n      datum.rels.children = [rel_datum.id];\n      return datum\n\n      function handleSpouse() {\n        const spouse_id = rel_datum.rels[!is_father ? 'father' : 'mother'];\n        if (!spouse_id) return\n        const spouse = data_stash.find(d => d.id === spouse_id);\n        datum.rels.spouses = [spouse_id];\n        if (!spouse.rels.spouses) spouse.rels.spouses = [];\n        spouse.rels.spouses.push(datum.id);\n        return spouse\n      }\n    }\n  }\n\n  function addSpouse(datum) {\n    removeIfToAdd();\n    if (!rel_datum.rels.spouses) rel_datum.rels.spouses = [];\n    rel_datum.rels.spouses.push(datum.id);\n    datum.rels.spouses = [rel_datum.id];\n\n    function removeIfToAdd() {\n      if (!rel_datum.rels.spouses) return\n      rel_datum.rels.spouses.forEach(spouse_id => {\n        const spouse = data_stash.find(d => d.id === spouse_id);\n        if (spouse.to_add) removeToAdd(spouse, data_stash);\n      });\n    }\n  }\n}\n\nfunction handleNewRel({datum, new_rel_datum, data_stash}) {\n  const rel_type = new_rel_datum._new_rel_data.rel_type;\n\n  if (rel_type === \"son\" || rel_type === \"daughter\") {\n    let mother = data_stash.find(d => d.id === new_rel_datum.rels.mother);\n    let father = data_stash.find(d => d.id === new_rel_datum.rels.father);\n    if (!mother) {\n      mother = createNewPerson({data: {gender: \"F\"}, rels: {children: [], spouses: [datum.id]}});\n      mother.to_add = true;\n      mother.id = new_rel_datum.rels.mother;\n      if (!datum.rels.spouses) datum.rels.spouses = [];\n      datum.rels.spouses.push(mother.id);\n      data_stash.push(mother);\n    }\n\n    if (!father) {\n      father = createNewPerson({data: {gender: \"F\"}, rels: {children: [], spouses: [datum.id]}});\n      father.to_add = true;\n      father.id = new_rel_datum.rels.father;\n      if (!datum.rels.spouses) datum.rels.spouses = [];\n      datum.rels.spouses.push(father.id);\n      data_stash.push(father);\n    }\n\n    if (!father.rels.children) father.rels.children = [];\n    father.rels.children.push(new_rel_datum.id);\n    if (!mother.rels.children) mother.rels.children = [];\n    mother.rels.children.push(new_rel_datum.id);\n    \n    new_rel_datum.rels = {\n      mother: mother.id,\n      father: father.id\n    };\n  }\n\n  if (rel_type === \"spouse\") {\n    if (!datum.rels.spouses) datum.rels.spouses = [];\n    if (!datum.rels.spouses.includes(new_rel_datum.id)) datum.rels.spouses.push(new_rel_datum.id);\n\n    // if rel is added in same same add relative tree then we need to clean up duplicate parent\n    new_rel_datum.rels.children = new_rel_datum.rels.children.filter(child_id => {\n      const child = data_stash.find(d => d.id === child_id);\n      if (!child) return false\n      if (child.rels.mother !== datum.id) {\n        if (data_stash.find(d => d.id === child.rels.mother)) data_stash.splice(data_stash.findIndex(d => d.id === child.rels.mother), 1);\n        child.rels.mother = new_rel_datum.id;\n      }\n      if (child.rels.father !== datum.id) {\n        if (data_stash.find(d => d.id === child.rels.father)) data_stash.splice(data_stash.findIndex(d => d.id === child.rels.father), 1);\n        child.rels.father = new_rel_datum.id;\n      }\n      return true\n    });\n\n    new_rel_datum.rels = {\n      spouses: [datum.id],\n      children: new_rel_datum.rels.children\n    };\n  }\n\n  if (rel_type === \"father\") {\n    datum.rels.father = new_rel_datum.id;\n    new_rel_datum.rels = {\n      children: [datum.id],\n    };\n    if (datum.rels.mother) {\n      new_rel_datum.rels.spouses = [datum.rels.mother];\n      const mother = data_stash.find(d => d.id === datum.rels.mother);\n      if (!mother.rels.spouses) mother.rels.spouses = [];\n      mother.rels.spouses.push(new_rel_datum.id);\n    }\n  }\n\n  if (rel_type === \"mother\") {\n    datum.rels.mother = new_rel_datum.id;\n    new_rel_datum.rels = {\n      children: [datum.id],\n    };\n    if (datum.rels.father) {\n      new_rel_datum.rels.spouses = [datum.rels.father];\n      const father = data_stash.find(d => d.id === datum.rels.father);\n      if (!father.rels.spouses) father.rels.spouses = [];\n      father.rels.spouses.push(new_rel_datum.id);\n    }\n  }\n\n  delete new_rel_datum._new_rel_data;\n  data_stash.push(new_rel_datum);\n}\n\nfunction createNewPerson({data, rels}) {\n  return {id: generateUUID(), data: data || {}, rels: rels || {}}\n}\n\nfunction createNewPersonWithGenderFromRel({data, rel_type, rel_datum}) {\n  const gender = getGenderFromRelative(rel_datum, rel_type);\n  data = Object.assign(data || {}, {gender});\n  return createNewPerson({data})\n\n  function getGenderFromRelative(rel_datum, rel_type) {\n    return ([\"daughter\", \"mother\"].includes(rel_type) || rel_type === \"spouse\" && rel_datum.data.gender === \"M\") ? \"F\" : \"M\"\n  }\n}\n\nfunction addNewPerson({data_stash, datum}) {\n  data_stash.push(datum);\n}\n\nfunction createTreeDataWithMainNode({data, version}) {\n  return {data: [createNewPerson({data})], version}\n}\n\nfunction addNewPersonAndHandleRels({datum, data_stash, rel_type, rel_datum}) {\n  addNewPerson({data_stash, datum});\n  handleRelsOfNewDatum({datum, data_stash, rel_type, rel_datum});\n}\n\nfunction generateUUID() {\n  var d = new Date().getTime();\n  var d2 = (performance && performance.now && (performance.now()*1000)) || 0;//Time in microseconds since page-load or 0 if unsupported\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n    var r = Math.random() * 16;\n    if(d > 0){//Use timestamp until depleted\n      r = (d + r)%16 | 0;\n      d = Math.floor(d/16);\n    } else {//Use microseconds since page-load if supported\n      r = (d2 + r)%16 | 0;\n      d2 = Math.floor(d2/16);\n    }\n    return (c === 'x' ? r : (r & 0x3 | 0x8)).toString(16);\n  });\n}\n\nfunction manualZoom({amount, svg, transition_time=500}) {\n  const zoom = svg.__zoomObj;\n  d3.select(svg).transition().duration(transition_time || 0).delay(transition_time ? 100 : 0)  // delay 100 because of weird error of undefined something in d3 zoom\n    .call(zoom.scaleBy, amount);\n}\n\nfunction isAllRelativeDisplayed(d, data) {\n  const r = d.data.rels,\n    all_rels = [r.father, r.mother, ...(r.spouses || []), ...(r.children || [])].filter(v => v);\n  return all_rels.every(rel_id => data.some(d => d.data.id === rel_id))\n}\n\nfunction CalculateTree({data, main_id=null, node_separation=250, level_separation=150}) {\n  if (!data || !data.length) return {data: [], data_stash: [], dim: {width: 0, height: 0}, main_id: null}\n  const is_vertical = true;\n  const data_stash = createRelsToAdd(data);\n  sortChildrenWithSpouses(data_stash);\n  const main = (main_id !== null && data_stash.find(d => d.id === main_id)) || data_stash[0];\n  const tree_children = calculateTreePositions(main, 'children', false);\n  const tree_parents = calculateTreePositions(main, 'parents', true);\n\n  data_stash.forEach(d => d.main = d === main);\n  levelOutEachSide(tree_parents, tree_children);\n  const tree = mergeSides(tree_parents, tree_children);\n  setupChildrenAndParents({tree});\n  setupSpouses({tree, node_separation});\n  nodePositioning({tree, is_vertical});\n  tree.forEach(d => d.all_rels_displayed = isAllRelativeDisplayed(d, tree));\n\n  const dim = calculateTreeDim(tree, node_separation, level_separation, is_vertical);\n\n  return {data: tree, data_stash, dim, main_id: main.id}\n\n  function calculateTreePositions(datum, rt, is_ancestry) {\n    const hierarchyGetter = rt === \"children\" ? hierarchyGetterChildren : hierarchyGetterParents,\n      d3_tree = d3.tree().nodeSize([node_separation, level_separation]).separation(separation),\n      root = d3.hierarchy(datum, hierarchyGetter);\n    d3_tree(root);\n    return root.descendants()\n\n    function separation(a, b) {\n      let offset = 1;\n      if (!is_ancestry) {\n        if (!sameParent(a, b)) offset+=.25;\n        if (someSpouses(a,b)) offset+=offsetOnPartners(a,b);\n        if (sameParent(a, b) && !sameBothParents(a,b)) offset+=.125;\n      }\n      return offset\n    }\n    function sameParent(a, b) {return a.parent == b.parent}\n    function sameBothParents(a, b) {return (a.data.rels.father === b.data.rels.father) && (a.data.rels.mother === b.data.rels.mother)}\n    function hasSpouses(d) {return d.data.rels.spouses && d.data.rels.spouses.length > 0}\n    function someSpouses(a, b) {return hasSpouses(a) || hasSpouses(b)}\n\n    function hierarchyGetterChildren(d) {\n      return [...(d.rels.children || [])].map(id => data_stash.find(d => d.id === id))\n    }\n\n    function hierarchyGetterParents(d) {\n      return [d.rels.father, d.rels.mother]\n        .filter(d => d).map(id => data_stash.find(d => d.id === id))\n    }\n\n    function offsetOnPartners(a,b) {\n      return ((a.data.rels.spouses || []).length + (b.data.rels.spouses || []).length)*.5\n    }\n  }\n\n  function levelOutEachSide(parents, children) {\n    const mid_diff = (parents[0].x - children[0].x) / 2;\n    parents.forEach(d => d.x-=mid_diff);\n    children.forEach(d => d.x+=mid_diff);\n  }\n\n  function mergeSides(parents, children) {\n    parents.forEach(d => {d.is_ancestry = true;});\n    parents.forEach(d => d.depth === 1 ? d.parent = children[0] : null);\n\n    return [...children, ...parents.slice(1)];\n  }\n  function nodePositioning({tree, is_vertical}) {\n    tree.forEach(d => {\n      d.y *= (d.is_ancestry ? -1 : 1);\n      if (!is_vertical) {\n        const d_x = d.x; d.x = d.y; d.y = d_x;\n      }\n    });\n  }\n\n  function setupSpouses({tree, node_separation}) {\n    for (let i = tree.length; i--;) {\n      const d = tree[i];\n      if (!d.is_ancestry && d.data.rels.spouses && d.data.rels.spouses.length > 0){\n        const side = d.data.data.gender === \"M\" ? -1 : 1;  // female on right\n        d.x += d.data.rels.spouses.length/2*node_separation*side;\n        d.data.rels.spouses.forEach((sp_id, i) => {\n          const spouse = {data: data_stash.find(d0 => d0.id === sp_id), added: true};\n\n          spouse.x = d.x-(node_separation*(i+1))*side;\n          spouse.y = d.y;\n          spouse.sx = i > 0 ? spouse.x : spouse.x + (node_separation/2)*side;\n          spouse.depth = d.depth;\n          spouse.spouse = d;\n          if (!d.spouses) d.spouses = [];\n          d.spouses.push(spouse);\n          tree.push(spouse);\n\n          tree.forEach(d0 => (\n            (d0.data.rels.father === d.data.id && d0.data.rels.mother === spouse.data.id) ||\n            (d0.data.rels.mother === d.data.id && d0.data.rels.father === spouse.data.id)\n            ) ? d0.psx = spouse.sx : null\n          );\n        });\n      }\n      if (d.parents && d.parents.length === 2) {\n        const p1 = d.parents[0],\n          p2 = d.parents[1],\n          midd = p1.x - (p1.x - p2.x)/2,\n          x = (d,sp) => midd + (node_separation/2)*(d.x < sp.x ? 1 : -1);\n\n        p2.x = x(p1, p2); p1.x = x(p2, p1);\n      }\n    }\n  }\n\n  function setupChildrenAndParents({tree}) {\n    tree.forEach(d0 => {\n      delete d0.children;\n      tree.forEach(d1 => {\n        if (d1.parent === d0) {\n          if (d1.is_ancestry) {\n            if (!d0.parents) d0.parents = [];\n            d0.parents.push(d1);\n          } else {\n            if (!d0.children) d0.children = [];\n            d0.children.push(d1);\n          }\n        }\n      });\n    });\n  }\n\n  function calculateTreeDim(tree, node_separation, level_separation, is_vertical) {\n    if (!is_vertical) [node_separation, level_separation] = [level_separation, node_separation];\n    const w_extent = d3.extent(tree, d => d.x),\n      h_extent = d3.extent(tree, d => d.y);\n    return {\n      width: w_extent[1] - w_extent[0]+node_separation, height: h_extent[1] - h_extent[0]+level_separation, x_off: -w_extent[0]+node_separation/2, y_off: -h_extent[0]+level_separation/2\n    }\n  }\n\n  function createRelsToAdd(data) {\n    const to_add_spouses = [];\n    for (let i = 0; i < data.length; i++) {\n      const d = data[i];\n      if (d.rels.children && d.rels.children.length > 0) {\n        if (!d.rels.spouses) d.rels.spouses = [];\n        const is_father = d.data.gender === \"M\";\n        let spouse;\n\n        d.rels.children.forEach(d0 => {\n          const child = data.find(d1 => d1.id === d0);\n          if (child.rels[is_father ? 'father' : 'mother'] !== d.id) return\n          if (child.rels[!is_father ? 'father' : 'mother']) return\n          if (!spouse) {\n            spouse = createToAddSpouse(d);\n            d.rels.spouses.push(spouse.id);\n          }\n          spouse.rels.children.push(child.id);\n          child.rels[!is_father ? 'father' : 'mother'] = spouse.id;\n        });\n      }\n    }\n    to_add_spouses.forEach(d => data.push(d));\n    return data\n\n    function createToAddSpouse(d) {\n      const spouse = createNewPerson({\n        data: {gender: d.data.gender === \"M\" ? \"F\" : \"M\"},\n        rels: {spouses: [d.id], children: []}\n      });\n      spouse.to_add = true;\n      to_add_spouses.push(spouse);\n      return spouse\n    }\n  }\n\n}\n\nfunction createStore(initial_state) {\n  let onUpdate;\n  const state = initial_state;\n  state.main_id_history = []; \n\n  const store = {\n    state,\n    updateTree: (props) => {\n      state.tree = calcTree();\n      if (!state.main_id) updateMainId(state.tree.main_id);\n      if (onUpdate) onUpdate(props);\n    },\n    updateData: data => state.data = data,\n    updateMainId,\n    getMainId: () => state.main_id,\n    getData: () => state.data,\n    getTree: () => state.tree,\n    setOnUpdate: (f) => onUpdate = f,\n\n    getMainDatum,\n    getDatum,\n    getTreeMainDatum,\n    getTreeDatum,\n    getLastAvailableMainDatum,\n\n    methods: {},\n  };\n\n  return store\n\n  function calcTree() {\n    return CalculateTree({\n      data: state.data, main_id: state.main_id,\n      node_separation: state.node_separation, level_separation: state.level_separation\n    })\n  }\n\n  function getMainDatum() {\n    return state.data.find(d => d.id === state.main_id)\n  }\n\n  function getDatum(id) {\n    return state.data.find(d => d.id === id)\n  }\n\n  function getTreeMainDatum() {\n    if (!state.tree) return null;\n    return state.tree.data.find(d => d.data.id === state.main_id)\n  }\n\n  function getTreeDatum(id) {\n    if (!state.tree) return null;\n    return state.tree.data.find(d => d.id === id)\n  }\n\n  function updateMainId(id) {\n    if (id === state.main_id) return\n    state.main_id_history = state.main_id_history.filter(d => d !== id).slice(-10);\n    state.main_id_history.push(id);\n    state.main_id = id;\n  }\n\n  // if main_id is deleted, get the last available main_id\n  function getLastAvailableMainDatum() {\n    let main_id = state.main_id_history.slice(0).reverse().find(id => getDatum(id));\n    if (!main_id) main_id = state.data[0].id;\n    if (main_id !== state.main_id) updateMainId(main_id);\n    return getDatum(main_id)\n  }\n}\n\nfunction positionTree({t, svg, transition_time=2000}) {\n  const el_listener = svg.__zoomObj ? svg : svg.parentNode;  // if we need listener for svg and html, we will use parent node\n  const zoom = el_listener.__zoomObj;\n\n  d3.select(el_listener).transition().duration(transition_time || 0).delay(transition_time ? 100 : 0)  // delay 100 because of weird error of undefined something in d3 zoom\n    .call(zoom.transform, d3.zoomIdentity.scale(t.k).translate(t.x, t.y));\n}\n\nfunction treeFit({svg, svg_dim, tree_dim, with_transition, transition_time}) {\n  const t = calculateTreeFit(svg_dim, tree_dim);\n  positionTree({t, svg, with_transition, transition_time});\n}\n\nfunction calculateTreeFit(svg_dim, tree_dim) {\n  let k = Math.min(svg_dim.width / tree_dim.width, svg_dim.height / tree_dim.height),\n    x = tree_dim.x_off + (svg_dim.width - tree_dim.width*k)/k/2,\n    y = tree_dim.y_off + (svg_dim.height - tree_dim.height*k)/k/2;\n\n  if (k>1) {x*=k;y*=k;k=1;}\n  return {k,x,y}\n}\n\nfunction cardToMiddle({datum, svg, svg_dim, scale, transition_time}) {\n  const k = scale || 1, x = svg_dim.width/2-datum.x*k, y = svg_dim.height/2-datum.y,\n    t = {k, x: x/k, y: y/k};\n  positionTree({t, svg, with_transition: true, transition_time});\n}\n\nfunction createLinks({d, tree, is_vertical}) {\n  const links = [];\n\n  if (d.data.rels.spouses && d.data.rels.spouses.length > 0) handleSpouse({d});\n  handleAncestrySide({d});\n  handleProgenySide({d});\n\n  return links;\n\n  function handleAncestrySide({d}) {\n    if (!d.parents || d.parents.length !== 2) return\n    const p1 = d.parents[0], p2 = d.parents[1];\n\n    const p = {x: getMid(p1, p2, 'x'), y: getMid(p1, p2, 'y')};\n\n    links.push({\n      d: Link(d, p),\n      _d: () => {\n        const _d = {x: d.x, y: d.y},\n          _p = {x: d.x, y: d.y};\n        return Link(_d, _p)\n      },\n      curve: true, \n      id: linkId(d, d.parents[0], d.parents[1]), \n      depth: d.depth+1, \n      is_ancestry: true,\n      source: d,\n      target: [d.parents[0], d.parents[1]]\n    });\n  }\n\n\n  function handleProgenySide({d}) {\n    if (!d.children || d.children.length === 0) return\n\n    d.children.forEach((child, i) => {\n      const other_parent = otherParent(child, d, tree),\n        sx = other_parent.sx;\n\n      links.push({\n        d: Link(child, {x: sx, y: d.y}),\n        _d: () => Link({x: sx, y: d.y}, {x: _or(child, 'x'), y: _or(child, 'y')}),\n        curve: true,\n        id: linkId(child, d, other_parent),\n        depth: d.depth+1,\n        is_ancestry: false,\n        source: [d, other_parent],\n        target: child\n      });\n    });\n  }\n\n\n  function handleSpouse({d}) {\n    d.data.rels.spouses.forEach(sp_id => {\n      const spouse = getRel(d, tree, d0 => d0.data.id === sp_id);\n      if (!spouse || d.spouse) return\n      links.push({\n        d: [[d.x, d.y], [spouse.x, spouse.y]],\n        _d: () => [\n          d.is_ancestry ? [_or(d, 'x')-.0001, _or(d, 'y')] : [d.x, d.y], // add -.0001 to line to have some length if d.x === spouse.x\n          d.is_ancestry ? [_or(spouse, 'x'), _or(spouse, 'y')] : [d.x-.0001, d.y]\n        ],\n        curve: false, \n        id: linkId(d, spouse), \n        depth: d.depth, \n        spouse: true, \n        is_ancestry: spouse.is_ancestry, \n        source: d, \n        target: spouse\n      });\n    });\n  }\n\n  ///\n  function getMid(d1, d2, side, is_) {\n    if (is_) return _or(d1, side) - (_or(d1, side) - _or(d2, side))/2\n    else return d1[side] - (d1[side] - d2[side])/2\n  }\n\n  function _or(d, k) {\n   return d.hasOwnProperty('_'+k) ? d['_'+k] : d[k]\n  }\n\n  function Link(d, p) {\n    const hy = (d.y + (p.y - d.y) / 2);\n    return [\n      [d.x, d.y],\n      [d.x, hy],\n      [d.x, hy],\n      [p.x, hy],\n      [p.x, hy],\n      [p.x, p.y],\n    ]\n  }\n\n  function linkId(...args) {\n    return args.map(d => d.data.id).sort().join(\", \")  // make unique id\n  }\n\n  function otherParent(child, p1, data) {\n    const condition = d0 => (d0.data.id !== p1.data.id) && ((d0.data.id === child.data.rels.mother) || (d0.data.id === child.data.rels.father));\n    return getRel(p1, data, condition)\n  }\n\n  // if there is overlapping of personas in different branches of same family tree, return the closest one\n  function getRel(d, data, condition) {\n    const rels = data.filter(condition);\n    const dist_xy = (a, b) => Math.sqrt(Math.pow(a.x - b.x, 2) + Math.pow(a.y - b.y, 2));\n    if (rels.length > 1) return rels.sort((d0, d1) => dist_xy(d0, d) - dist_xy(d1, d))[0]\n    else return rels[0]\n  }\n}\n\nfunction pathToMain(cards, links, datum, main_datum) {\n  const is_ancestry = datum.is_ancestry;\n  const links_data = links.data();\n  let links_node_to_main = [];\n  let cards_node_to_main = [];\n\n  if (is_ancestry) {\n    const links_to_main = [];\n\n    let parent = datum;\n    let itteration1 = 0;\n    while (parent !== main_datum.data && itteration1 < 100) {\n      itteration1++;  // to prevent infinite loop\n      const spouse_link = links_data.find(d => d.spouse === true && (d.source === parent || d.target === parent));\n      if (!spouse_link) break\n      const child_link = links_data.find(d => Array.isArray(d.target) && d.target.includes(spouse_link.source) && d.target.includes(spouse_link.target));\n      if (!child_link) break\n      links_to_main.push(spouse_link);\n      links_to_main.push(child_link);\n      parent = child_link.source;\n    }\n    links.each(function(d) {\n      if (links_to_main.includes(d)) {\n        links_node_to_main.push({link: d, node: this});\n      }\n    });\n\n    const cards_to_main = getCardsToMain(datum, links_to_main);\n    cards.each(function(d) {\n      if (cards_to_main.includes(d)) {\n        cards_node_to_main.push({card: d, node: this});\n      }\n    });\n  } else if (datum.spouse && datum.spouse.data === main_datum.data) {\n    links.each(function(d) {\n      if (d.target === datum) links_node_to_main.push({link: d, node: this});\n    });\n    const cards_to_main = [main_datum, datum];\n    cards.each(function(d) {\n      if (cards_to_main.includes(d)) {\n        cards_node_to_main.push({card: d, node: this});\n      }\n    });\n  } else {\n    let links_to_main = [];\n\n    let child = datum;\n    let itteration1 = 0;\n    while (parent !== main_datum.data && itteration1 < 100) {\n      itteration1++;  // to prevent infinite loop\n      const child_link = links_data.find(d => d.target === child && Array.isArray(d.source));\n      if (child_link) {\n        const spouse_link = links_data.find(d => d.spouse === true && sameArray([d.source, d.target], child_link.source));\n        links_to_main.push(child_link);\n        links_to_main.push(spouse_link);\n        if (spouse_link) child = spouse_link.source;\n      } else {\n        const spouse_link = links_data.find(d => d.target === child && !Array.isArray(d.source));  // spouse link\n        if (!spouse_link) break\n        links_to_main.push(spouse_link);\n        child = spouse_link.source;\n      }\n    }\n\n    links.each(function(d) {\n      if (links_to_main.includes(d)) {\n        links_node_to_main.push({link: d, node: this});\n      }\n    });\n\n    const cards_to_main = getCardsToMain(main_datum, links_to_main);\n    cards.each(function(d) {\n      if (cards_to_main.includes(d)) {\n        cards_node_to_main.push({card: d, node: this});\n      }\n    });\n  }\n  return [cards_node_to_main, links_node_to_main]\n\n  function sameArray(arr1, arr2) {\n    return arr1.every(d1 => arr2.some(d2 => d1 === d2))\n  }\n\n  function getCardsToMain(first_parent, links_to_main) {\n    const all_cards = links_to_main.reduce((acc, d) => {\n      if (Array.isArray(d.target)) acc.push(...d.target);\n      else acc.push(d.target);\n      if (Array.isArray(d.source)) acc.push(...d.source);\n      else acc.push(d.source);\n      return acc\n    }, []);\n\n    const cards_to_main = [main_datum, datum];\n    getChildren(first_parent);\n    return cards_to_main\n\n    function getChildren(d) {\n      if (d.data.rels.children) {\n        d.data.rels.children.forEach(child_id => {\n          const child = all_cards.find(d0 => d0.data.id === child_id);\n          if (child) {\n            cards_to_main.push(child);\n            getChildren(child);\n          }\n        });\n      }\n    }\n  }\n}\n\nfunction createPath(d, is_) {\n  const line = d3.line().curve(d3.curveMonotoneY),\n    lineCurve = d3.line().curve(d3.curveBasis),\n    path_data = is_ ? d._d() : d.d;\n\n  if (!d.curve) return line(path_data)\n  else if (d.curve === true) return lineCurve(path_data)\n}\n\nfunction updateLinks(svg, tree, props={}) {\n  const links_data = tree.data.reduce((acc, d) => acc.concat(createLinks({d, tree:tree.data})), []),\n    link = d3.select(svg).select(\".links_view\").selectAll(\"path.link\").data(links_data, d => d.id),\n    link_exit = link.exit(),\n    link_enter = link.enter().append(\"path\").attr(\"class\", \"link\"),\n    link_update = link_enter.merge(link);\n\n  link_exit.each(linkExit);\n  link_enter.each(linkEnter);\n  link_update.each(linkUpdate);\n\n  function linkEnter(d) {\n    d3.select(this).attr(\"fill\", \"none\").attr(\"stroke\", \"#fff\").attr(\"stroke-width\", 1).style(\"opacity\", 0)\n      .attr(\"d\", createPath(d, true));\n  }\n\n  function linkUpdate(d) {\n    const path = d3.select(this);\n    const delay = props.initial ? calculateDelay(tree, d, props.transition_time) : 0;\n    path.transition('path').duration(props.transition_time).delay(delay).attr(\"d\", createPath(d)).style(\"opacity\", 1);\n  }\n\n  function linkExit(d) {\n    const path = d3.select(this);\n    path.transition('op').duration(800).style(\"opacity\", 0);\n    path.transition('path').duration(props.transition_time).attr(\"d\", createPath(d, true))\n      .on(\"end\", () => path.remove());\n  }\n\n}\n\nfunction updateCards(svg, tree, Card, props={}) {\n  const card = d3.select(svg).select(\".cards_view\").selectAll(\"g.card_cont\").data(tree.data, d => d.data.id),\n    card_exit = card.exit(),\n    card_enter = card.enter().append(\"g\").attr(\"class\", \"card_cont\"),\n    card_update = card_enter.merge(card);\n\n  card_exit.each(d => calculateEnterAndExitPositions(d, false, true));\n  card_enter.each(d => calculateEnterAndExitPositions(d, true, false));\n\n  card_exit.each(cardExit);\n  card.each(cardUpdateNoEnter);\n  card_enter.each(cardEnter);\n  card_update.each(cardUpdate);\n\n  function cardEnter(d) {\n    d3.select(this)\n      .attr(\"transform\", `translate(${d._x}, ${d._y})`)\n      .style(\"opacity\", 0);\n\n    Card.call(this, d);\n  }\n\n  function cardUpdateNoEnter(d) {}\n\n  function cardUpdate(d) {\n    Card.call(this, d);\n    const delay = props.initial ? calculateDelay(tree, d, props.transition_time) : 0;\n    d3.select(this).transition().duration(props.transition_time).delay(delay).attr(\"transform\", `translate(${d.x}, ${d.y})`).style(\"opacity\", 1);\n  }\n\n  function cardExit(d) {\n    const g = d3.select(this);\n    g.transition().duration(props.transition_time).style(\"opacity\", 0).attr(\"transform\", `translate(${d._x}, ${d._y})`)\n      .on(\"end\", () => g.remove());\n  }\n}\n\nfunction updateCardsHtml(div, tree, Card, props={}) {\n  const card = d3.select(div).select(\".cards_view\").selectAll(\"div.card_cont\").data(tree.data, d => d.data.id),\n    card_exit = card.exit(),\n    card_enter = card.enter().append(\"div\").attr(\"class\", \"card_cont\").style('pointer-events', 'none'),\n    card_update = card_enter.merge(card);\n\n  card_exit.each(d => calculateEnterAndExitPositions(d, false, true));\n  card_enter.each(d => calculateEnterAndExitPositions(d, true, false));\n\n  card_exit.each(cardExit);\n  card.each(cardUpdateNoEnter);\n  card_enter.each(cardEnter);\n  card_update.each(cardUpdate);\n\n  function cardEnter(d) {\n    d3.select(this)\n      .style('position', 'absolute')\n      .style('top', '0').style('left', '0')\n      .style(\"transform\", `translate(${d._x}px, ${d._y}px)`)\n      .style(\"opacity\", 0);\n\n    Card.call(this, d);\n  }\n\n  function cardUpdateNoEnter(d) {}\n\n  function cardUpdate(d) {\n    Card.call(this, d);\n    const delay = props.initial ? calculateDelay(tree, d, props.transition_time) : 0;\n    d3.select(this).transition().duration(props.transition_time).delay(delay).style(\"transform\", `translate(${d.x}px, ${d.y}px)`).style(\"opacity\", 1);\n  }\n\n  function cardExit(d) {\n    const g = d3.select(this);\n    g.transition().duration(props.transition_time).style(\"opacity\", 0).style(\"transform\", `translate(${d._x}px, ${d._y}px)`)\n      .on(\"end\", () => g.remove());\n  }\n}\n\nfunction assignUniqueIdToTreeData(div, tree_data) {\n  const card = d3.select(div).selectAll(\"div.card_cont_2fake\").data(tree_data, d => d.data.id);  // how this doesn't break if there is multiple cards with the same id?\n  const card_exit = card.exit();\n  const card_enter = card.enter().append(\"div\").attr(\"class\", \"card_cont_2fake\").style('display', 'none').attr(\"data-id\", () => Math.random());\n  const card_update = card_enter.merge(card);\n\n  card_exit.each(cardExit);\n  card_enter.each(cardEnter);\n  card_update.each(cardUpdate);\n\n  function cardEnter(d) {\n    d.unique_id = d3.select(this).attr(\"data-id\");\n  }\n\n  function cardUpdate(d) {\n    d.unique_id = d3.select(this).attr(\"data-id\");\n  }\n\n  function cardExit(d) {\n    d.unique_id = d3.select(this).attr(\"data-id\");\n    d3.select(this).remove();\n  }\n}\n\nfunction setupHtmlSvg(getHtmlSvg) {\n  d3.select(getHtmlSvg()).append(\"div\").attr(\"class\", \"cards_view_fake\").style('display', 'none');  // important for handling data\n}\n\nfunction getCardsViewFake(getHtmlSvg) {\n  return d3.select(getHtmlSvg()).select(\"div.cards_view_fake\").node()\n}\n\nfunction onZoomSetup(getSvgView, getHtmlView) {\n  return function onZoom(e) {\n    const t = e.transform;\n  \n    d3.select(getSvgView()).style('transform', `translate(${t.x}px, ${t.y}px) scale(${t.k}) `);\n    d3.select(getHtmlView()).style('transform', `translate(${t.x}px, ${t.y}px) scale(${t.k}) `);\n  }\n}\n\nfunction setupReactiveTreeData(getHtmlSvg) {\n  let tree_data = [];\n\n  return function getReactiveTreeData(new_tree_data) {\n    const tree_data_exit = getTreeDataExit(new_tree_data, tree_data);\n    tree_data = [...new_tree_data, ...tree_data_exit];\n    assignUniqueIdToTreeData(getCardsViewFake(getHtmlSvg), tree_data);\n    return tree_data\n  }\n}\n\nfunction createHtmlSvg(cont) {\n  const f3Canvas = d3.select(cont).select('#f3Canvas');\n  const cardHtml = f3Canvas.append('div').attr('id', 'htmlSvg')\n    .attr('style', 'position: absolute; width: 100%; height: 100%; z-index: 2; top: 0; left: 0');\n  cardHtml.append('div').attr('class', 'cards_view').style('transform-origin', '0 0');\n  setupHtmlSvg(() => cardHtml.node());\n\n  return cardHtml.node()\n}\n\nfunction getTreeDataExit(new_tree_data, old_tree_data) {\n  if (old_tree_data.length > 0) {\n    return old_tree_data.filter(d => !new_tree_data.find(t => t.data.id === d.data.id))\n  } else {\n    return []\n  }\n}\n\nfunction getUniqueId(d) {\n  return d.unique_id\n}\n\nvar htmlHandlers = /*#__PURE__*/Object.freeze({\n__proto__: null,\nassignUniqueIdToTreeData: assignUniqueIdToTreeData,\nsetupHtmlSvg: setupHtmlSvg,\ngetCardsViewFake: getCardsViewFake,\nonZoomSetup: onZoomSetup,\nsetupReactiveTreeData: setupReactiveTreeData,\ncreateHtmlSvg: createHtmlSvg,\ngetUniqueId: getUniqueId\n});\n\nfunction updateCardsComponent(div, tree, Card, props={}) {\n  const card = d3.select(getCardsViewFake(() => div)).selectAll(\"div.card_cont_fake\").data(tree.data, d => d.data.id),\n    card_exit = card.exit(),\n    card_enter = card.enter().append(\"div\").attr(\"class\", \"card_cont_fake\").style('display', 'none'),\n    card_update = card_enter.merge(card);\n\n  card_exit.each(d => calculateEnterAndExitPositions(d, false, true));\n  card_enter.each(d => calculateEnterAndExitPositions(d, true, false));\n\n  card_exit.each(cardExit);\n  card.each(cardUpdateNoEnter);\n  card_enter.each(cardEnter);\n  card_update.each(cardUpdate);\n\n  function cardEnter(d) {\n    const card_element = d3.select(Card(d));\n\n    card_element\n      .style('position', 'absolute')\n      .style('top', '0').style('left', '0').style(\"opacity\", 0)\n      .style(\"transform\", `translate(${d._x}px, ${d._y}px)`);\n  }\n\n  function cardUpdateNoEnter(d) {}\n\n  function cardUpdate(d) {\n    const card_element = d3.select(Card(d));\n    const delay = props.initial ? calculateDelay(tree, d, props.transition_time) : 0;\n    card_element.transition().duration(props.transition_time).delay(delay).style(\"transform\", `translate(${d.x}px, ${d.y}px)`).style(\"opacity\", 1);\n  }\n\n  function cardExit(d) {\n    const card_element = d3.select(Card(d));\n    const g = d3.select(this);\n    card_element.transition().duration(props.transition_time).style(\"opacity\", 0).style(\"transform\", `translate(${d._x}px, ${d._y}px)`)\n      .on(\"end\", () => g.remove()); // remove the card_cont_fake\n  }\n}\n\nfunction view (tree, svg, Card, props={}) {\n\n  props.initial = props.hasOwnProperty('initial') ? props.initial : !d3.select(svg.parentNode).select('.card_cont').node();\n  props.transition_time = props.hasOwnProperty('transition_time') ? props.transition_time : 2000;\n  if (props.cardComponent) updateCardsComponent(props.cardComponent, tree, Card, props);\n  else if (props.cardHtml) updateCardsHtml(props.cardHtml, tree, Card, props);\n  else updateCards(svg, tree, Card, props);\n  updateLinks(svg, tree, props);\n\n  const tree_position = props.tree_position || 'fit';\n  if (props.initial) treeFit({svg, svg_dim: svg.getBoundingClientRect(), tree_dim: tree.dim, transition_time: 0});\n  else if (tree_position === 'fit') treeFit({svg, svg_dim: svg.getBoundingClientRect(), tree_dim: tree.dim, transition_time: props.transition_time});\n  else if (tree_position === 'main_to_middle') cardToMiddle({datum: tree.data[0], svg, svg_dim: svg.getBoundingClientRect(), scale: props.scale, transition_time: props.transition_time});\n  else ;\n\n  return true\n}\n\nfunction calculateDelay(tree, d, transition_time) {\n  const delay_level = transition_time*.4,\n    ancestry_levels = Math.max(...tree.data.map(d=>d.is_ancestry ? d.depth : 0));\n  let delay = d.depth*delay_level;\n  if ((d.depth !== 0 || !!d.spouse) && !d.is_ancestry) {\n    delay+=(ancestry_levels)*delay_level;  // after ancestry\n    if (d.spouse) delay+=delay_level;  // spouse after bloodline\n    delay+=(d.depth)*delay_level;  // double the delay for each level because of additional spouse delay\n  }\n  return delay\n}\n\nfunction createSvg(cont, props={}) {\n  const svg_dim = cont.getBoundingClientRect();\n  const svg_html = (`\n    <svg class=\"main_svg\">\n      <rect width=\"${svg_dim.width}\" height=\"${svg_dim.height}\" fill=\"transparent\" />\n      <g class=\"view\">\n        <g class=\"links_view\"></g>\n        <g class=\"cards_view\"></g>\n      </g>\n      <g style=\"transform: translate(100%, 100%)\">\n        <g class=\"fit_screen_icon cursor-pointer\" style=\"transform: translate(-50px, -50px); display: none\">\n          <rect width=\"27\" height=\"27\" stroke-dasharray=\"${27/2}\" stroke-dashoffset=\"${27/4}\" \n            style=\"stroke:#fff;stroke-width:4px;fill:transparent;\"/>\n          <circle r=\"5\" cx=\"${27/2}\" cy=\"${27/2}\" style=\"fill:#fff\" />          \n        </g>\n      </g>\n    </svg>\n  `);\n\n  const f3Canvas = getOrCreateF3Canvas(cont);\n\n  const temp_div = d3.create('div').node();\n  temp_div.innerHTML = svg_html;\n  const svg = temp_div.querySelector('svg');\n  f3Canvas.appendChild(svg);\n\n  cont.appendChild(f3Canvas);\n\n  setupZoom(f3Canvas, props);\n\n  return svg\n\n  function getOrCreateF3Canvas(cont) {\n    let f3Canvas = cont.querySelector('#f3Canvas');\n    if (!f3Canvas) {\n      f3Canvas = d3.create('div').attr('id', 'f3Canvas').attr('style', 'position: relative; overflow: hidden; width: 100%; height: 100%;').node();\n    }\n    return f3Canvas\n  }\n}\n\nfunction setupZoom(el, props={}) {\n  if (el.__zoom) return\n  const view = el.querySelector('.view'),\n    zoom = d3.zoom().on(\"zoom\", (props.onZoom || zoomed));\n\n  d3.select(el).call(zoom);\n  el.__zoomObj = zoom;\n\n  if (props.zoom_polite) zoom.filter(zoomFilter);\n\n  function zoomed(e) {\n    d3.select(view).attr(\"transform\", e.transform);\n  }\n\n  function zoomFilter(e) {\n    if (e.type === \"wheel\" && !e.ctrlKey) return false\n    else if (e.touches && e.touches.length < 2) return false\n    else return true\n  }\n}\n\nfunction cardChangeMain(store, {d}) {\n  toggleAllRels(store.getTree().data, false);\n  store.updateMainId(d.data.id);\n  store.updateTree({tree_position: store.state.tree_fit_on_change});\n  return true\n}\n\nfunction cardEdit(store, {d, cardEditForm}) {\n  const datum = d.data,\n    postSubmit = (props) => {\n      if (datum.to_add) moveToAddToAdded(datum, store.getData());\n      if (props && props.delete) {\n        if (datum.main) store.updateMainId(null);\n        deletePerson(datum, store.getData());\n      }\n      store.updateTree();\n    };\n  cardEditForm({datum, postSubmit, store});\n}\n\nfunction cardShowHideRels(store, {d}) {\n  d.data.hide_rels = !d.data.hide_rels;\n  toggleRels(d, d.data.hide_rels);\n  store.updateTree({tree_position: store.state.tree_fit_on_change});\n}\n\nfunction userIcon() {\n  return (`\n    <g data-icon=\"user\">\n      ${bgCircle()}\n      <path d=\"M12,4A4,4 0 0,1 16,8A4,4 0 0,1 12,12A4,4 0 0,1 8,8A4,4 0 0,1 12,4M12,14C16.42,14 20,15.79 20,18V20H4V18C4,15.79 7.58,14 12,14Z\" />\n    </g>\n  `)\n}\n\nfunction userEditIcon() {\n  return (`\n    <g data-icon=\"user-edit\">\n      ${bgCircle()}\n      <path d=\"M21.7,13.35L20.7,14.35L18.65,12.3L19.65,11.3C19.86,11.09 20.21,11.09 20.42,11.3L21.7,12.58C21.91,\n      12.79 21.91,13.14 21.7,13.35M12,18.94L18.06,12.88L20.11,14.93L14.06,21H12V18.94M12,14C7.58,14 4,15.79 4,\n      18V20H10V18.11L14,14.11C13.34,14.03 12.67,14 12,14M12,4A4,4 0 0,0 8,8A4,4 0 0,0 12,12A4,4 0 0,0 16,8A4,4 0 0,0 12,4Z\" />\n    </g>\n  `)\n}\n\nfunction userPlusIcon() {\n  return (`\n    <g data-icon=\"user-plus\">\n      ${bgCircle()}\n      <path d=\"M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z\" />\n    </g>\n  `)\n}\n\nfunction userPlusCloseIcon() {\n  return (`\n    <g data-icon=\"user-plus-close\">\n      ${bgCircle()}\n      <path d=\"M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M6,10V7H4V10H1V12H4V15H6V12H9V10M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12Z\" />\n      <line x1=\"3\" y1=\"3\" x2=\"24\" y2=\"24\" stroke=\"currentColor\" stroke-width=\"2\" />\n    </g>\n  `)\n}\n\nfunction plusIcon() {\n  return (`\n    <g data-icon=\"plus\">\n      ${bgCircle()}\n      <path d=\"M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z\" />\n    </g>\n  `)\n}\n\nfunction pencilIcon() {\n  return (`\n    <g data-icon=\"pencil\">\n      ${bgCircle()}\n      <path d=\"M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z\" />\n    </g>\n  `)\n}\n\nfunction pencilOffIcon() {\n  return (`\n    <g data-icon=\"pencil-off\">\n      ${bgCircle()}\n      <path d=\"M18.66,2C18.4,2 18.16,2.09 17.97,2.28L16.13,4.13L19.88,7.88L21.72,6.03C22.11,5.64 22.11,5 21.72,4.63L19.38,2.28C19.18,2.09 18.91,2 18.66,2M3.28,4L2,5.28L8.5,11.75L4,16.25V20H7.75L12.25,15.5L18.72,22L20,20.72L13.5,14.25L9.75,10.5L3.28,4M15.06,5.19L11.03,9.22L14.78,12.97L18.81,8.94L15.06,5.19Z\" />\n    </g>\n  `)\n}\n\nfunction trashIcon() {\n  return (`\n    <g data-icon=\"trash\">\n      ${bgCircle()}\n      <path d=\"M6,19A2,2 0 0,0 8,21H16A2,2 0 0,0 18,19V7H6V19M8,9H16V19H8V9M15.5,4L14.5,3H9.5L8.5,4H5V6H19V4H15.5Z\" />\n    </g>\n  `)\n}\n\nfunction historyBackIcon() {\n  return (`\n    <g data-icon=\"history-back\">\n      ${bgCircle()}\n      <path d=\"M20 13.5C20 17.09 17.09 20 13.5 20H6V18H13.5C16 18 18 16 18 13.5S16 9 13.5 9H7.83L10.91 12.09L9.5 13.5L4 8L9.5 2.5L10.92 3.91L7.83 7H13.5C17.09 7 20 9.91 20 13.5Z\" />\n    </g>\n  `)\n}\n\nfunction historyForwardIcon() {\n  return (`\n    <g data-icon=\"history-forward\">\n      ${bgCircle()}\n      <path d=\"M10.5 18H18V20H10.5C6.91 20 4 17.09 4 13.5S6.91 7 10.5 7H16.17L13.08 3.91L14.5 2.5L20 8L14.5 13.5L13.09 12.09L16.17 9H10.5C8 9 6 11 6 13.5S8 18 10.5 18Z\" />\n    </g>\n  `)\n}\n\nfunction personIcon() {\n  return (`\n    <g data-icon=\"person\">\n      <path d=\"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 \n        64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 \n        0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z\" />\n    </g>\n  `)\n}\n\nfunction miniTreeIcon() {\n  return (`\n    <g transform=\"translate(31,25)\" data-icon=\"mini-tree\">\n      <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n      <g>\n        <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n        <line y2=\"-17.5\" stroke=\"#fff\" />\n        <line x1=\"-20\" x2=\"20\" y1=\"-17.5\" y2=\"-17.5\" stroke=\"#fff\" />\n        <rect x=\"-31\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-male\" />\n        <rect x=\"6\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-female\" />\n      </g>\n    </g>\n  `)\n}\n\nfunction userSvgIcon() { return svgWrapper(userIcon()) }\nfunction userEditSvgIcon() { return svgWrapper(userEditIcon()) }\nfunction userPlusSvgIcon() { return svgWrapper(userPlusIcon()) }\nfunction userPlusCloseSvgIcon() { return svgWrapper(userPlusCloseIcon()) }\nfunction plusSvgIcon() { return svgWrapper(plusIcon()) }\nfunction pencilSvgIcon() { return svgWrapper(pencilIcon()) }\nfunction pencilOffSvgIcon() { return svgWrapper(pencilOffIcon()) }\nfunction trashSvgIcon() { return svgWrapper(trashIcon()) }\nfunction historyBackSvgIcon() { return svgWrapper(historyBackIcon()) }\nfunction historyForwardSvgIcon() { return svgWrapper(historyForwardIcon()) }\nfunction personSvgIcon() { return svgWrapper(personIcon(), '0 0 512 512') }\nfunction miniTreeSvgIcon() { return svgWrapper(miniTreeIcon(), '0 0 72 25') }\n\nfunction svgWrapper(icon, viewBox='0 0 24 24') {\n  const match = icon.match(/data-icon=\"([^\"]+)\"/);\n  const dataIcon = match ? `data-icon=\"${match[1]}\"` : '';\n  \n  return (`\n    <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"${viewBox}\" style=\"fill: currentColor\" ${dataIcon}>\n      ${icon}\n    </svg>\n  `)\n}\n\nfunction bgCircle() {\n  return (`\n    <circle r=\"12\" cx=\"12\" cy=\"12\" style=\"fill: rgba(0,0,0,0)\" />\n  `)\n}\n\nvar icons = /*#__PURE__*/Object.freeze({\n__proto__: null,\nuserIcon: userIcon,\nuserEditIcon: userEditIcon,\nuserPlusIcon: userPlusIcon,\nuserPlusCloseIcon: userPlusCloseIcon,\nplusIcon: plusIcon,\npencilIcon: pencilIcon,\npencilOffIcon: pencilOffIcon,\ntrashIcon: trashIcon,\nhistoryBackIcon: historyBackIcon,\nhistoryForwardIcon: historyForwardIcon,\npersonIcon: personIcon,\nminiTreeIcon: miniTreeIcon,\nuserSvgIcon: userSvgIcon,\nuserEditSvgIcon: userEditSvgIcon,\nuserPlusSvgIcon: userPlusSvgIcon,\nuserPlusCloseSvgIcon: userPlusCloseSvgIcon,\nplusSvgIcon: plusSvgIcon,\npencilSvgIcon: pencilSvgIcon,\npencilOffSvgIcon: pencilOffSvgIcon,\ntrashSvgIcon: trashSvgIcon,\nhistoryBackSvgIcon: historyBackSvgIcon,\nhistoryForwardSvgIcon: historyForwardSvgIcon,\npersonSvgIcon: personSvgIcon,\nminiTreeSvgIcon: miniTreeSvgIcon\n});\n\nfunction formInfoSetup(form_creator, closeCallback) {\n  const formContainer = document.createElement('div');\n  update();\n  return formContainer\n\n  function update() {\n    const formHtml = getHtml(form_creator);\n\n    formContainer.innerHTML = formHtml;\n  \n    setupEventListeners();\n\n    return formContainer\n  }\n\n  function setupEventListeners() {\n    const form = formContainer.querySelector('form');\n    form.addEventListener('submit', form_creator.onSubmit);\n\n    const cancel_btn = form.querySelector('.f3-cancel-btn');\n    cancel_btn.addEventListener('click', onCancel);\n\n    const edit_btn = form.querySelector('.f3-edit-btn');\n    if (edit_btn) edit_btn.addEventListener('click', onEdit);\n\n    const delete_btn = form.querySelector('.f3-delete-btn');\n    if (delete_btn && form_creator.onDelete) {\n      delete_btn.addEventListener('click', form_creator.onDelete);\n    }\n\n    const add_relative_btn = form.querySelector('.f3-add-relative-btn');\n    if (add_relative_btn && form_creator.addRelative) {\n      add_relative_btn.addEventListener('click', () => {\n        if (form_creator.addRelativeActive) form_creator.addRelativeCancel();\n        else form_creator.addRelative();\n        form_creator.addRelativeActive = !form_creator.addRelativeActive;\n        update();\n      });\n    }\n\n    const close_btn = form.querySelector('.f3-close-btn');\n    close_btn.addEventListener('click', closeCallback);\n\n    if (form_creator.other_parent_field) {\n      cancel_btn.style.display = 'none';\n    }\n\n    function onCancel() {\n      form_creator.editable = false;\n      if (form_creator.onCancel) form_creator.onCancel();\n      update();\n    }\n\n    function onEdit() {\n      form_creator.editable = !form_creator.editable;\n      update();\n    }\n  }\n}\n\n function getHtml(form_creator) {\n  return (` \n    <form id=\"familyForm\" class=\"f3-form ${form_creator.editable ? '' : 'non-editable'}\">\n      ${closeBtn()}\n      ${form_creator.title ? `<h3 class=\"f3-form-title\">${form_creator.title}</h3>` : ''}\n      <div style=\"text-align: right; display: ${form_creator.new_rel ? 'none' : 'block'}\">\n        ${form_creator.addRelative && !form_creator.no_edit ? addRelativeBtn() : ''}\n        ${form_creator.no_edit ? spaceDiv() : editBtn()}\n      </div>\n      ${genderRadio()}\n\n      ${fields()}\n\n      ${form_creator.other_parent_field ? otherParentField() : ''}\n\n      ${form_creator.onDelete ? deleteBtn() : ''}\n      \n      <div class=\"f3-form-buttons\">\n        <button type=\"button\" class=\"f3-cancel-btn\">Cancel</button>\n        <button type=\"submit\">Submit</button>\n      </div>\n    </form>\n  `)\n\n  function deleteBtn() {\n    return (`\n      <div>\n        <button type=\"button\" class=\"f3-delete-btn\" ${form_creator.can_delete ? '' : 'disabled'}>\n          Delete\n        </button>\n      </div>\n    `)\n  }\n\n  function addRelativeBtn() {\n    return (`\n      <span class=\"f3-add-relative-btn\">\n        ${form_creator.addRelativeActive ? userPlusCloseSvgIcon() : userPlusSvgIcon()}\n      </span>\n    `)\n  }\n\n  function editBtn() {\n    return (`\n      <span class=\"f3-edit-btn\">\n        ${form_creator.editable ? pencilOffSvgIcon() : pencilSvgIcon()}\n      </span>\n    `)\n  }\n\n  function genderRadio() {\n    if (!form_creator.editable) return ''\n    return (`\n      <div class=\"f3-radio-group\">\n        ${form_creator.gender_field.options.map(option => (`\n          <label>\n            <input type=\"radio\" name=\"${form_creator.gender_field.id}\" \n              value=\"${option.value}\" \n              ${option.value === form_creator.gender_field.initial_value ? 'checked' : ''}\n            >\n            ${option.label}\n          </label>\n        `)).join('')}\n      </div>\n    `)\n  }\n\n  function fields() {\n    if (!form_creator.editable) return infoField()\n    return form_creator.fields.map(field => (`\n      ${field.type === 'text' ? `\n        <div class=\"f3-form-field\">\n          <label>${field.label}</label>\n          <input type=\"${field.type}\" \n            name=\"${field.id}\" \n            value=\"${field.initial_value || ''}\"\n            placeholder=\"${field.label}\">\n        </div>\n      ` : field.type === 'textarea' ? `\n        <div class=\"f3-form-field\">\n          <label>${field.label}</label>\n          <textarea name=\"${field.id}\" \n            placeholder=\"${field.label}\">${field.initial_value || ''}</textarea>\n        </div>\n      ` : ''}\n    `)).join('')\n\n    function infoField() {\n      return form_creator.fields.map(field => (`\n        <div class=\"f3-info-field\">\n          <span class=\"f3-info-field-label\">${field.label}</span>\n          <span class=\"f3-info-field-value\">${field.initial_value || ''}</span>\n        </div>\n      `)).join('')\n    }\n  }\n\n  function otherParentField() {\n    return (`\n      <div class=\"f3-form-field\">\n        <label>${form_creator.other_parent_field.label}</label>\n        <select name=\"${form_creator.other_parent_field.id}\">\n          ${form_creator.other_parent_field.options.map(option => `\n            <option value=\"${option.value}\" \n              ${option.value === form_creator.other_parent_field.initial_value ? 'selected' : ''}>\n              ${option.label}\n            </option>\n          `).join('')}\n        </select>\n      </div>\n    `)\n  }\n\n  function closeBtn() {\n    return (`\n      <span class=\"f3-close-btn\">\n        ×\n      </span>\n    `)\n  }\n\n  function spaceDiv() {\n    return `<div style=\"height: 24px;\"></div>`\n  }\n}\n\nfunction createHistory(store, getStoreData, onUpdate) {\n  let history = [];\n  let history_index = -1;\n  \n  return {\n    changed,\n    back,\n    forward,\n    canForward,\n    canBack\n  }\n\n  function changed() {\n    if (history_index < history.length - 1) history = history.slice(0, history_index);\n    const clean_data = JSON.parse(cleanupDataJson(JSON.stringify(getStoreData())));\n    clean_data.main_id = store.getMainId();\n    history.push(clean_data);\n    history_index++;\n  }\n\n  function back() {\n    if (!canBack()) return\n    history_index--;\n    updateData(history[history_index]);\n  }\n\n  function forward() {\n    if (!canForward()) return\n    history_index++;\n    updateData(history[history_index]);\n  }\n\n  function canForward() {\n    return history_index < history.length - 1\n  }\n\n  function canBack() {\n    return history_index > 0\n  }\n\n  function updateData(data) {\n    store.updateMainId(data.main_id);\n    store.updateData(data);\n    onUpdate();\n  }\n}\n\nfunction createHistoryControls(cont, history, onUpdate=()=>{}) {\n  const history_controls = d3.select(cont).append(\"div\").attr(\"class\", \"f3-history-controls\");\n  const back_btn = history_controls.append(\"button\").attr(\"class\", \"f3-back-button\").on(\"click\", () => {\n    history.back();\n    updateButtons();\n    onUpdate();\n  });\n  const forward_btn = history_controls.append(\"button\").attr(\"class\", \"f3-forward-button\").on(\"click\", () => {\n    history.forward();\n    updateButtons();\n    onUpdate();\n  });\n\n  back_btn.html(historyBackSvgIcon());\n  forward_btn.html(historyForwardSvgIcon());\n\n  return {\n    back_btn: back_btn.node(),\n    forward_btn: forward_btn.node(),\n    updateButtons,\n    destroy\n  }\n\n  function updateButtons() {\n    back_btn.classed(\"disabled\", !history.canBack());\n    forward_btn.classed(\"disabled\", !history.canForward());\n    history_controls.style(\"display\", !history.canBack() && !history.canForward() ? \"none\" : null);\n  }\n\n  function destroy() {\n    history = null;\n    d3.select(cont).select('.f3-history-controls').remove();\n  }\n}\n\nvar handlers = /*#__PURE__*/Object.freeze({\n__proto__: null,\nmanualZoom: manualZoom,\nisAllRelativeDisplayed: isAllRelativeDisplayed,\ncardChangeMain: cardChangeMain,\ncardEdit: cardEdit,\ncardShowHideRels: cardShowHideRels,\nhandleRelsOfNewDatum: handleRelsOfNewDatum,\nhandleNewRel: handleNewRel,\ncreateNewPerson: createNewPerson,\ncreateNewPersonWithGenderFromRel: createNewPersonWithGenderFromRel,\naddNewPerson: addNewPerson,\ncreateTreeDataWithMainNode: createTreeDataWithMainNode,\naddNewPersonAndHandleRels: addNewPersonAndHandleRels,\ncheckIfRelativesConnectedWithoutPerson: checkIfRelativesConnectedWithoutPerson,\ncreateForm: createForm,\nmoveToAddToAdded: moveToAddToAdded,\nremoveToAdd: removeToAdd,\ndeletePerson: deletePerson,\ncleanupDataJson: cleanupDataJson,\nformInfoSetup: formInfoSetup,\ncreateHistory: createHistory,\ncreateHistoryControls: createHistoryControls,\ntreeFit: treeFit,\ncalculateTreeFit: calculateTreeFit,\ncardToMiddle: cardToMiddle\n});\n\nfunction CardBody({d,card_dim,card_display}) {\n  return {template: (`\n    <g class=\"card-body\">\n      <rect width=\"${card_dim.w}\" height=\"${card_dim.h}\" class=\"card-body-rect\" />\n      ${CardText({d,card_dim,card_display}).template}\n    </g>\n  `)\n  }\n}\n\nfunction CardText({d,card_dim,card_display}) {\n  return {template: (`\n    <g>\n      <g class=\"card-text\" clip-path=\"url(#card_text_clip)\">\n        <g transform=\"translate(${card_dim.text_x}, ${card_dim.text_y})\">\n          <text>\n            ${Array.isArray(card_display) ? card_display.map(cd => `<tspan x=\"${0}\" dy=\"${14}\">${cd(d.data)}</tspan>`).join('\\n') : card_display(d.data)}\n          </text>\n        </g>\n      </g>\n      <rect width=\"${card_dim.w-10}\" height=\"${card_dim.h}\" style=\"mask: url(#fade)\" class=\"text-overflow-mask\" /> \n    </g>\n  `)\n  }\n}\n\nfunction CardBodyAddNew({d,card_dim,card_add,label}) {\n  return {template: (`\n    <g class=\"card-body ${card_add ? 'card_add' : 'card-unknown'}\">\n      <rect class=\"card-body-rect\" width=\"${card_dim.w}\" height=\"${card_dim.h}\" fill=\"rgb(59, 85, 96)\" />\n      <text transform=\"translate(${card_dim.w/2}, ${card_dim.h/2})\" text-anchor=\"middle\" fill=\"#fff\">\n        <tspan font-size=\"18\" dy=\"${8}\">${label}</tspan>\n      </text>\n    </g>\n  `)\n  }\n}\n\nfunction CardBodyOutline({d,card_dim, is_new}) {\n  return {template: (`\n    <rect width=\"${card_dim.w}\" height=\"${card_dim.h}\" rx=\"4\" ry=\"4\" class=\"card-outline ${(d.data.main && !is_new) ? 'card-main-outline' : ''} ${is_new ? 'card-new-outline' : ''}\" />\n  `)\n  }\n}\n\nfunction PencilIcon({d,card_dim,x,y}) {\n  return ({template: (`\n    <g transform=\"translate(${x || card_dim.w-20},${y || card_dim.h-20})scale(.6)\" style=\"cursor: pointer\" class=\"card_edit pencil_icon\">\n      <circle fill=\"rgba(0,0,0,0)\" r=\"17\" cx=\"8.5\" cy=\"8.5\" />\n      <path fill=\"currentColor\" transform=\"translate(-1.5, -1.5)\"\n         d=\"M19.082,2.123L17.749,0.79c-1.052-1.052-2.766-1.054-3.819,0L1.925,12.794c-0.06,0.06-0.104,0.135-0.127,0.216\n          l-1.778,6.224c-0.05,0.175-0.001,0.363,0.127,0.491c0.095,0.095,0.223,0.146,0.354,0.146c0.046,0,0.092-0.006,0.137-0.02\n          l6.224-1.778c0.082-0.023,0.156-0.066,0.216-0.127L19.082,5.942C20.134,4.89,20.134,3.176,19.082,2.123z M3.076,13.057l9.428-9.428\n          l3.738,3.739l-9.428,9.428L3.076,13.057z M2.566,13.961l3.345,3.344l-4.683,1.339L2.566,13.961z M18.375,5.235L16.95,6.66\n          l-3.738-3.739l1.425-1.425c0.664-0.663,1.741-0.664,2.405,0l1.333,1.333C19.038,3.493,19.038,4.572,18.375,5.235z\"/>\n    </g>\n  `)})\n}\n\nfunction MiniTree({d,card_dim}) {\n  return ({template: (`\n    <g class=\"card_family_tree\" style=\"cursor: pointer\">\n      <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n      <g transform=\"translate(${card_dim.w*.8},6)scale(.9)\">\n        <rect x=\"-31\" y=\"-25\" width=\"72\" height=\"15\" fill=\"rgba(0,0,0,0)\"></rect>\n        <line y2=\"-17.5\" stroke=\"#fff\" />\n        <line x1=\"-20\" x2=\"20\" y1=\"-17.5\" y2=\"-17.5\" stroke=\"#fff\" />\n        <rect x=\"-31\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-male\" />\n        <rect x=\"6\" y=\"-25\" width=\"25\" height=\"15\" rx=\"5\" ry=\"5\" class=\"card-female\" />\n      </g>\n    </g>\n  `)})\n}\n\nfunction PlusIcon({d,card_dim,x,y}) {\n  return ({template: (`\n    <g class=\"card_add_relative\">\n      <g transform=\"translate(${x || card_dim.w/2},${y || card_dim.h})scale(.13)\">\n        <circle r=\"80\" cx=\"40\" cy=\"40\" fill=\"rgba(0,0,0,0)\" />\n        <g transform=\"translate(-10, -8)\">\n          <line\n            x1=\"10\" x2=\"90\" y1=\"50\" y2=\"50\"\n            stroke=\"currentColor\" stroke-width=\"15\" stroke-linecap=\"round\"\n          />\n          <line\n            x1=\"50\" x2=\"50\" y1=\"10\" y2=\"90\"\n            stroke=\"currentColor\" stroke-width=\"15\" stroke-linecap=\"round\"\n          />\n        </g>\n      </g>\n    </g>\n  `)})\n}\n\nfunction LinkBreakIcon({x,y,rt,closed}) {\n  return ({template: (`\n    <g style=\"\n          transform: translate(-12.2px, -.5px);\n          cursor: pointer;\n        \" \n        fill=\"currentColor\" class=\"card_break_link${closed ? ' closed' : ''}\"\n      >\n      <g style=\"transform: translate(${x}px,${y}px)scale(.02)rotate(${rt+'deg'})\">\n        <rect width=\"1000\" height=\"700\" y=\"150\" style=\"opacity: 0\" />\n        <g class=\"link_upper\">\n          <g>\n            <path d=\"M616.3,426.4c19,4.5,38.1-7.4,42.6-26.4c4.4-19-7.4-38-26.5-42.5L522.5,332c-18,11.1-53.9,33.4-53.9,33.4l80.4,18.6c-7.8,4.9-19.5,12.1-31.3,19.4L616.3,426.4L616.3,426.4z\"/>\n            <path d=\"M727.4,244.2c-50.2-11.6-100.3,3.3-135.7,35.4c28.6,22.6,64.5,30.2,116.4,51.3l141,32.6c23.9,5.6,56.6,47.2,51.1,71l-4.1,17c-5.6,23.7-47.3,56.4-71.2,51l-143.4-33.2c-66.8-8.6-104.1-16.6-132.9-7.5c17.4,44.9,55.9,80.8,106.5,92.4L800.9,588c81.3,18.8,162.3-31.5,181.2-112.4l4-17c18.8-81.1-31.7-161.8-112.9-180.6L727.4,244.2z\"/>\n          </g>\n        </g>\n        <g class=\"link_lower\">\n          <path d=\"M421.2,384.9l-128,127.6c-13.9,13.8-13.9,36.2,0,50s36.3,13.8,50.2,0.1l136.2-135.8v-36.7l-58.4,58.1V384.9L421.2,384.9z\"/>\n          <path d=\"M204.6,742.8c-17.4,17.3-63.3,17.2-80.6,0.1l-12.3-12.3c-17.3-17.3,0.6-81.2,17.9-98.5l100.2-99.9c12.5-14.9,45.8-40.8,66.1-103.7c-47.7-9.4-98.9,4.2-135.8,40.9L54.2,575c-58.9,58.8-58.9,154,0,212.8L66.6,800c58.9,58.8,154.5,58.8,213.4,0l105.8-105.6c38.4-38.3,51.3-91.9,39.7-141c-44,22.7-89,62.3-116,84.8L204.6,742.8z\"/>\n        </g>\n        <g class=\"link_particles\">\n          <path d=\"M351.9,248.4l-26.5,63.4l80.6,30.1L351.9,248.4z\"/>\n          <path d=\"M529.3,208l-43,26.6l35.4,52.3L529.3,208z\"/>\n          <path d=\"M426.6,158.8l-44-2.9l61.7,134.6L426.6,158.8z\"/>\n        </g>\n      </g>\n    </g>\n  `)})\n}\n\nfunction LinkBreakIconWrapper({d,card_dim}) {\n  let g = \"\",\n    r = d.data.rels, _r = d.data._rels || {},\n    closed = d.data.hide_rels,\n    areParents = r => r.father || r.mother,\n    areChildren = r => r.children && r.children.length > 0;\n  if ((d.is_ancestry || d.data.main) && (areParents(r) || areParents(_r))) {g+=LinkBreakIcon({x:card_dim.w/2,y:0, rt: -45, closed}).template;}\n  if (!d.is_ancestry && d.added) {\n    const sp = d.spouse, sp_r = sp.data.rels, _sp_r = sp.data._rels || {};\n    if ((areChildren(r) || areChildren(_r)) && (areChildren(sp_r) || areChildren(_sp_r))) {\n      g+=LinkBreakIcon({x:d.sx - d.x + card_dim.w/2 +24.4,y: (d.x !== d.sx ? card_dim.h/2 : card_dim.h)+1, rt: 135, closed}).template;\n    }\n  }\n  return {template: g}\n}\n\nfunction CardImage({d, image, card_dim, maleIcon, femaleIcon}) {\n  return ({template: (`\n    <g style=\"transform: translate(${card_dim.img_x}px,${card_dim.img_y}px);\" class=\"card_image\" clip-path=\"url(#card_image_clip)\">\n      ${image \n        ? `<image href=\"${image}\" height=\"${card_dim.img_h}\" width=\"${card_dim.img_w}\" preserveAspectRatio=\"xMidYMin slice\" />`\n        : (d.data.data.gender === \"F\" && !!femaleIcon) ? femaleIcon({card_dim}) \n        : (d.data.data.gender === \"M\" && !!maleIcon) ? maleIcon({card_dim}) \n        : GenderlessIcon()\n      }      \n    </g>\n  `)})\n\n  function GenderlessIcon() {\n    return (`\n      <g class=\"genderless-icon\">\n        <rect height=\"${card_dim.img_h}\" width=\"${card_dim.img_w}\" fill=\"rgb(59, 85, 96)\" />\n        <g transform=\"scale(${card_dim.img_w*0.001616})\">\n         <path transform=\"translate(50,40)\" fill=\"lightgrey\" d=\"M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 \n            64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 \n            0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z\" />\n        </g>\n      </g>\n    `)\n  }\n}\n\nfunction appendTemplate(template, parent, is_first) {\n  const g = document.createElementNS(\"http://www.w3.org/2000/svg\", 'g');\n  g.innerHTML = template;\n\n  if (is_first) parent.insertBefore(g, parent.firstChild);\n  else parent.appendChild(g);\n}\n\nconst CardElements = {\n  miniTree,\n  lineBreak,\n  cardBody,\n  cardImage,\n  cardEdit: cardEditIcon,\n  cardAdd: cardAddIcon,\n};\n\nfunction miniTree(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  if (d.all_rels_displayed) return\n  const g = d3.create('svg:g').html(MiniTree({d,card_dim}).template);\n  g.on(\"click\", function (e) {\n    e.stopPropagation();\n    if (props.onMiniTreeClick) props.onMiniTreeClick.call(this, e, d);\n    else cardChangeMain(props.store, {d});\n  });\n  return g.node()\n}\n\nfunction lineBreak(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  const g = d3.create('svg:g').html(LinkBreakIconWrapper({d,card_dim}).template);\n  g.on(\"click\", (e) => {e.stopPropagation();cardShowHideRels(props.store, {d});});\n  return g.node()\n}\n\nfunction cardBody(d, props) {\n  const unknown_lbl = props.cardEditForm ? 'ADD' : 'UNKNOWN';\n  const card_dim = props.card_dim;\n\n  let g;\n  if (!d.data.to_add || !props.cardEditForm) {\n    g = d3.create('svg:g').html(CardBody({d, card_dim, card_display: props.card_display}).template);\n    g.on(\"click\", function (e) {\n      e.stopPropagation();\n      if (props.onCardClick) props.onCardClick.call(this, e, d);\n      else cardChangeMain(props.store, {d});\n    });\n  } else {\n    g = d3.create('svg:g').html(CardBodyAddNew({d, card_dim, card_add: props.cardEditForm, label: unknown_lbl}).template);\n    g.on(\"click\", (e) => {e.stopPropagation();cardEdit(props.store, {d, cardEditForm: props.cardEditForm});});\n  }\n  return g.node()\n}\n\nfunction cardImage(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  const g = d3.create('svg:g').html(CardImage({d, image: d.data.data.avatar || null, card_dim, maleIcon: null, femaleIcon: null}).template);\n  return g.node()\n}\n\nfunction cardEditIcon(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  const g = d3.create('svg:g').html(PencilIcon({card_dim, x: card_dim.w-46, y: card_dim.h-20}).template);\n  g.on(\"click\", (e) => {e.stopPropagation();cardEdit(props.store, {d, cardEditForm: props.cardEditForm});});\n\n  return g.node()\n}\n\nfunction cardAddIcon(d, props) {\n  if (d.data.to_add) return\n  const card_dim = props.card_dim;\n  const g = d3.create('svg:g').html(PlusIcon({card_dim, x: card_dim.w-26, y: card_dim.h-20}).template);\n  g.on(\"click\", (e) => {e.stopPropagation();props.addRelative({d});});\n\n  return g.node()\n}\n\n\nfunction appendElement(el_maybe, parent, is_first) {\n  if (!el_maybe) return\n  if (is_first) parent.insertBefore(el_maybe, parent.firstChild);\n  else parent.appendChild(el_maybe);\n}\n\nfunction setupCardSvgDefs(svg, card_dim) {\n  if (svg.querySelector(\"defs#f3CardDef\")) return\n  svg.insertAdjacentHTML('afterbegin', (`\n      <defs id=\"f3CardDef\">\n        <linearGradient id=\"fadeGrad\">\n          <stop offset=\"0.9\" stop-color=\"white\" stop-opacity=\"0\"/>\n          <stop offset=\".91\" stop-color=\"white\" stop-opacity=\".5\"/>\n          <stop offset=\"1\" stop-color=\"white\" stop-opacity=\"1\"/>\n        </linearGradient>\n        <mask id=\"fade\" maskContentUnits=\"objectBoundingBox\"><rect width=\"1\" height=\"1\" fill=\"url(#fadeGrad)\"/></mask>\n        <clipPath id=\"card_clip\"><path d=\"${curvedRectPath({w:card_dim.w, h:card_dim.h}, 5)}\"></clipPath>\n        <clipPath id=\"card_text_clip\"><rect width=\"${card_dim.w-10}\" height=\"${card_dim.h}\"></rect></clipPath>\n        <clipPath id=\"card_image_clip\"><path d=\"M0,0 Q 0,0 0,0 H${card_dim.img_w} V${card_dim.img_h} H0 Q 0,${card_dim.img_h} 0,${card_dim.img_h} z\"></clipPath>\n        <clipPath id=\"card_image_clip_curved\"><path d=\"${curvedRectPath({w: card_dim.img_w, h:card_dim.img_h}, 5, ['rx', 'ry'])}\"></clipPath>\n      </defs>\n    `));\n\n  function curvedRectPath(dim, curve, no_curve_corners) {\n    const {w,h} = dim,\n      c = curve,\n      ncc = no_curve_corners || [],\n      ncc_check = (corner) => ncc.includes(corner),\n      lx = ncc_check('lx') ? `M0,0` : `M0,${c} Q 0,0 5,0`,\n      rx = ncc_check('rx') ? `H${w}` : `H${w-c} Q ${w},0 ${w},5`,\n      ry = ncc_check('ry') ? `V${h}` : `V${h-c} Q ${w},${h} ${w-c},${h}`,\n      ly = ncc_check('ly') ? `H0` : `H${c} Q 0,${h} 0,${h-c}`;\n\n    return (`${lx} ${rx} ${ry} ${ly} z`)\n  }\n}\n\nfunction updateCardSvgDefs(svg, card_dim) {\n  if (svg.querySelector(\"defs#f3CardDef\")) {\n    svg.querySelector(\"defs#f3CardDef\").remove();\n  }\n  setupCardSvgDefs(svg, card_dim);\n}\n\nfunction Card(props) {\n  props = setupProps(props);\n  setupCardSvgDefs(props.svg, props.card_dim);\n\n  return function (d) {\n    const gender_class = d.data.data.gender === 'M' ? 'card-male' : d.data.data.gender === 'F' ? 'card-female' : 'card-genderless';\n    const card_dim = props.card_dim;\n\n    const card = d3.create('svg:g').attr('class', `card ${gender_class}`).attr('transform', `translate(${[-card_dim.w / 2, -card_dim.h / 2]})`);\n    card.append('g').attr('class', 'card-inner').attr('clip-path', 'url(#card_clip)');\n\n    this.innerHTML = '';\n    this.appendChild(card.node());\n\n    appendTemplate(CardBodyOutline({d,card_dim,is_new:d.data.to_add}).template, card.node(), true);\n    appendElement(CardElements.cardBody(d, props), this.querySelector('.card-inner'));\n\n    if (props.img) appendElement(CardElements.cardImage(d, props), this.querySelector('.card'));\n    if (props.mini_tree) appendElement(CardElements.miniTree(d, props), this.querySelector('.card'), true);\n    if (props.link_break) appendElement(CardElements.lineBreak(d, props), this.querySelector('.card'));\n\n    if (props.cardEditForm) {\n      appendElement(CardElements.cardEdit(d, props), this.querySelector('.card-inner'));\n      appendElement(CardElements.cardAdd(d, props), this.querySelector('.card-inner'));\n    }\n\n    if (props.onCardUpdates) props.onCardUpdates.map(fn => fn.call(this, d));\n    if (props.onCardUpdate) props.onCardUpdate.call(this, d);\n  }\n\n  function setupProps(props) {\n    const default_props = {\n      img: true,\n      mini_tree: true,\n      link_break: false,\n      card_dim: {w:220,h:70,text_x:75,text_y:15,img_w:60,img_h:60,img_x:5,img_y:5}\n    };\n    if (!props) props = {};\n    for (const k in default_props) {\n      if (typeof props[k] === 'undefined') props[k] = default_props[k];\n    }\n    return props\n  }\n}\n\nfunction CardHtml(props) {\n  const cardInner = props.style === 'default' ? cardInnerDefault \n  : props.style === 'imageCircleRect' ? cardInnerImageCircleRect\n  : props.style === 'imageCircle' ? cardInnerImageCircle \n  : props.style === 'imageRect' ? cardInnerImageRect\n  : props.style === 'rect' ? cardInnerRect\n  : cardInnerDefault;\n\n  return function (d) {\n    this.innerHTML = (`\n    <div class=\"card ${getClassList(d).join(' ')}\" data-id=\"${d.data.id}\" style=\"transform: translate(-50%, -50%); pointer-events: auto;\">\n      ${props.mini_tree ? getMiniTree(d) : ''}\n      ${cardInner(d)}\n    </div>\n    `);\n    this.querySelector('.card').addEventListener('click', e => props.onCardClick(e, d));\n    if (props.onCardUpdate) props.onCardUpdate.call(this, d);\n\n    if (props.onCardMouseenter) d3.select(this).select('.card').on('mouseenter', e => props.onCardMouseenter(e, d));\n    if (props.onCardMouseleave) d3.select(this).select('.card').on('mouseleave', e => props.onCardMouseleave(e, d));\n  }\n\n  function getCardInnerImageCircle(d) {\n    return (`\n    <div class=\"card-inner card-image-circle\" ${getCardStyle()}>\n      ${d.data.data.avatar ? `<img src=\"${d.data.data[\"avatar\"]}\" ${getCardImageStyle()}>` : noImageIcon(d)}\n      <div class=\"card-label\">${textDisplay(d)}</div>\n    </div>\n    `)\n  }\n\n  function getCardInnerImageRect(d) {\n    return (`\n    <div class=\"card-inner card-image-rect\" ${getCardStyle()}>\n      ${d.data.data.avatar ? `<img src=\"${d.data.data[\"avatar\"]}\" ${getCardImageStyle()}>` : noImageIcon(d)}\n      <div class=\"card-label\">${textDisplay(d)}</div>\n    </div>\n    `)\n  }\n\n  function getCardInnerRect(d) {\n    return (`\n    <div class=\"card-inner card-rect\" ${getCardStyle()}>\n      ${textDisplay(d)}\n    </div>\n    `)\n  }\n\n  function textDisplay(d) {\n    if (d.data._new_rel_data) return newRelDataDisplay(d)\n    if (d.data.to_add) return `<div>ADD</div>`\n    return (`\n      ${props.card_display.map(display => `<div>${display(d.data)}</div>`).join('')}\n    `)\n  }\n\n  function newRelDataDisplay(d) {\n    const attr_list = [];\n    attr_list.push(`data-rel-type=\"${d.data._new_rel_data.rel_type}\"`);\n    if (['son', 'daughter'].includes(d.data._new_rel_data.rel_type)) attr_list.push(`data-other-parent-id=\"${d.data._new_rel_data.other_parent_id}\"`);\n    return `<div ${attr_list.join(' ')}>${d.data._new_rel_data.label}</div>`\n  }\n\n  function getMiniTree(d) {\n    if (!props.mini_tree) return ''\n    if (d.data.to_add) return ''\n    if (d.data._new_rel_data) return ''\n    if (d.all_rels_displayed) return ''\n    return `<div class=\"mini-tree\">${miniTreeSvgIcon()}</div>`\n  }\n\n  function cardInnerImageCircleRect(d) {\n    return d.data.data.avatar ? cardInnerImageCircle(d) : cardInnerRect(d)\n  }\n\n  function cardInnerDefault(d) {\n    return getCardInnerImageRect(d)\n  }\n\n  function cardInnerImageCircle(d) {\n    return getCardInnerImageCircle(d)\n  }\n\n  function cardInnerImageRect(d) {\n    return getCardInnerImageRect(d)\n  }\n\n  function cardInnerRect(d) {\n    return getCardInnerRect(d)\n  }\n\n  function getClassList(d) {\n    const class_list = [];\n    if (d.data.data.gender === 'M') class_list.push('card-male');\n    else if (d.data.data.gender === 'F') class_list.push('card-female');\n    else class_list.push('card-genderless');\n\n    if (d.data.main) class_list.push('card-main');\n\n    if (d.data._new_rel_data) class_list.push('card-new-rel');\n\n    if (d.data.to_add) class_list.push('card-to-add');\n\n    return class_list\n  }\n\n  function getCardStyle() {\n    let style = 'style=\"';\n    if (props.card_dim.w || props.card_dim.h) {\n      style += `width: ${props.card_dim.w}px; min-height: ${props.card_dim.h}px;`;\n      if (props.card_dim.height_auto) style += 'height: auto;';\n      else style += `height: ${props.card_dim.h}px;`;\n    } else {\n      return ''\n    }\n    style += '\"';\n    return style\n  }\n\n  function getCardImageStyle() {\n    let style = 'style=\"position: relative;';\n    if (props.card_dim.img_w || props.card_dim.img_h || props.card_dim.img_x || props.card_dim.img_y) {\n      style += `width: ${props.card_dim.img_w}px; height: ${props.card_dim.img_h}px;`;\n      style += `left: ${props.card_dim.img_x}px; top: ${props.card_dim.img_y}px;`;\n    } else {\n      return ''\n    }\n    style += '\"';\n    return style\n  }\n\n  function noImageIcon(d) {\n    if (d.data._new_rel_data) return `<div class=\"person-icon\" ${getCardImageStyle()}>${plusSvgIcon()}</div>`\n    return `<div class=\"person-icon\" ${getCardImageStyle()}>${personSvgIcon()}</div>`\n  }\n}\n\nvar elements = /*#__PURE__*/Object.freeze({\n__proto__: null,\nappendElement: appendElement,\nCard: Card,\nCardHtml: CardHtml\n});\n\nvar addRelative = (...args) => { return new AddRelative(...args) };\n\nfunction AddRelative(store, cancelCallback, onSubmitCallback) {\n  this.store = store;\n\n  this.cancelCallback = cancelCallback;\n  this.onSubmitCallback = onSubmitCallback;\n\n  this.datum = null;\n\n  this.onChange = null;\n  this.onCancel = null;\n\n  this.is_active = false;\n  this.store_data = null;\n\n  this.addRelLabels = this.addRelLabelsDefault();\n\n  return this\n}\n\nAddRelative.prototype.activate = function(datum) {\n  if (this.is_active) this.onCancel();\n  this.is_active = true;\n\n  const store = this.store;\n\n  this.store_data = store.getData();\n  this.datum = datum;\n  datum = JSON.parse(JSON.stringify(this.datum));\n\n  const datum_rels = getDatumRelsData(datum, this.store_data, this.addRelLabels);\n  store.updateData(datum_rels);\n  store.updateTree({});\n\n  this.onChange = onChange.bind(this);\n  this.onCancel = onCancel.bind(this);\n\n  function onChange(updated_datum) {\n    if (updated_datum?._new_rel_data) {\n      const new_rel_datum = updated_datum;\n      handleNewRel({datum: this.datum, new_rel_datum, data_stash: this.store_data});\n      this.onSubmitCallback(this.datum, new_rel_datum);\n    } else if (updated_datum.id === this.datum.id) {\n      this.datum.data = updated_datum.data;  // if in meanwhile the user changed the data for main datum, we need to keep it\n    } else {\n      console.error('Something went wrong');\n    }\n  }\n\n  function onCancel() {\n    if (!this.is_active) return\n    this.is_active = false;\n\n    store.updateData(this.store_data);\n    this.cancelCallback(this.datum);\n\n    this.store_data = null;\n    this.datum = null;\n    this.onChange = null;\n    this.onCancel = null;\n  }\n\n};\n\nAddRelative.prototype.setAddRelLabels = function(add_rel_labels) {\n  if (typeof add_rel_labels !== 'object') {\n    console.error('add_rel_labels must be an object');\n    return\n  }\n  for (let key in add_rel_labels) {\n    this.addRelLabels[key] = add_rel_labels[key];\n  }\n  return this\n};\n\nAddRelative.prototype.addRelLabelsDefault = function() {\n  return {\n    father: 'Add Father',\n    mother: 'Add Mother',\n    spouse: 'Add Spouse',\n    son: 'Add Son',\n    daughter: 'Add Daughter'\n  }\n};\n\nAddRelative.prototype.getStoreData = function() {\n  return this.store_data\n};\n\nfunction getDatumRelsData(datum, store_data, addRelLabels) {\n  const datum_rels = getDatumRels(datum, store_data);\n\n  if (!datum.rels.father) {\n    const father = createNewPerson({data: {gender: \"M\"}, rels: {children: [datum.id]}});\n    father._new_rel_data = {rel_type: \"father\", label: addRelLabels.father};\n    datum.rels.father = father.id;\n    datum_rels.push(father);\n  }\n  if (!datum.rels.mother) {\n    const mother = createNewPerson({data: {gender: \"F\"}, rels: {children: [datum.id]}});\n    mother._new_rel_data = {rel_type: \"mother\", label: addRelLabels.mother};\n    datum.rels.mother = mother.id;\n    datum_rels.push(mother);\n  }\n  const mother = datum_rels.find(d => d.id === datum.rels.mother);\n  const father = datum_rels.find(d => d.id === datum.rels.father);\n  mother.rels.spouses = [father.id];\n  father.rels.spouses = [mother.id];\n\n  mother.rels.children = [datum.id];\n  father.rels.children = [datum.id];\n\n  if (!datum.rels.spouses) datum.rels.spouses = [];\n  const new_spouse = createNewPerson({data: {gender: \"F\"}, rels: {spouses: [datum.id]}});\n  new_spouse._new_rel_data = {rel_type: \"spouse\", label: addRelLabels.spouse};\n  datum.rels.spouses.push(new_spouse.id);\n  datum_rels.push(new_spouse);\n\n  if (!datum.rels.children) datum.rels.children = [];\n  datum.rels.spouses.forEach(spouse_id => {\n    const spouse = datum_rels.find(d => d.id === spouse_id);\n    if (!spouse.rels.children) spouse.rels.children = [];\n    spouse.rels.children = spouse.rels.children.filter(child_id => datum.rels.children.includes(child_id));\n    \n    const new_son = createNewPerson({data: {gender: \"M\"}, rels: {father: datum.id, mother: spouse.id}});\n    new_son._new_rel_data = {rel_type: \"son\", label: addRelLabels.son, other_parent_id: spouse.id};\n    spouse.rels.children.push(new_son.id);\n    datum.rels.children.push(new_son.id);\n    datum_rels.push(new_son);\n\n    const new_daughter = createNewPerson({data: {gender: \"F\"}, rels: {mother: spouse.id, father: datum.id}});\n    new_daughter._new_rel_data = {rel_type: \"daughter\", label: addRelLabels.daughter, other_parent_id: spouse.id};\n    spouse.rels.children.push(new_daughter.id);\n    datum.rels.children.push(new_daughter.id);\n    datum_rels.push(new_daughter);\n  });\n\n  return datum_rels\n}\n\nfunction findRel(store_data, id) {\n  return JSON.parse(JSON.stringify(store_data.find(d => d.id === id)))\n}\n\nfunction getDatumRels(datum, data) {\n  const datum_rels = [datum];\n  Object.keys(datum.rels).forEach(rel_type => {\n    const rel = datum.rels[rel_type];\n    if (Array.isArray(rel)) {\n      rel.forEach(rel_id => {\n        findAndPushRel(rel_type, rel_id);\n      });\n    } else {\n      findAndPushRel(rel_type, rel);\n    }\n  });\n  return datum_rels\n\n  function findAndPushRel(rel_type, rel_id) {\n    const rel_datum = findRel(data, rel_id);\n    if (rel_type === 'father' || rel_type === 'mother') {\n      delete rel_datum.rels.father;\n      delete rel_datum.rels.mother;\n    }\n\n    if (rel_type === 'children') {\n      rel_datum.rels.children = [];\n      rel_datum.rels.spouses = [];\n    }\n\n    datum_rels.push(rel_datum);\n  }\n}\n\nfunction editTree(...args) { return new EditTree(...args) }\n\nfunction EditTree(cont, store) {\n  this.cont = cont;\n  this.store = store;\n\n  this.fields = [\n    {type: 'text', label: 'first name', id: 'first name'},\n    {type: 'text', label: 'last name', id: 'last name'},\n    {type: 'text', label: 'birthday', id: 'birthday'},\n    {type: 'text', label: 'avatar', id: 'avatar'}\n  ];\n\n  this.form_cont = null;\n\n  this.is_fixed = true;\n\n  this.history = null;\n  this.no_edit = false;\n\n  this.onChange = null;\n\n  this.editFirst = false;\n\n  this.init();\n\n  return this\n}\n\nEditTree.prototype.init = function() {\n  this.form_cont = d3.select(this.cont).append('div').classed('f3-form-cont', true).node();\n  this.addRelativeInstance = this.setupAddRelative();\n  this.createHistory();\n};\n\nEditTree.prototype.open = function(datum) {\n  if (datum.data.data) datum = datum.data;\n  if (this.addRelativeInstance.is_active && !datum._new_rel_data) {\n    this.addRelativeInstance.onCancel();\n    datum = this.store.getDatum(datum.id);\n  }\n\n  this.cardEditForm(datum);\n};\n\nEditTree.prototype.openWithoutRelCancel = function(datum) {\n  if (datum.data.data) datum = datum.data;\n\n  this.cardEditForm(datum);\n};\n\nEditTree.prototype.cardEditForm = function(datum) {\n  const props = {};\n  const is_new_rel = datum?._new_rel_data;\n  if (is_new_rel) {\n    props.onCancel = () => this.addRelativeInstance.onCancel();\n  } else {\n    props.addRelative = this.addRelativeInstance;\n    props.deletePerson = () => {\n      const data = this.store.getData();\n      deletePerson(datum, data);\n      this.store.updateData(data);\n      this.openFormWithId(this.store.getLastAvailableMainDatum().id);\n\n      this.store.updateTree({});\n    };\n  }\n\n  const form_creator = f3.handlers.createForm({\n    store: this.store, \n    datum, \n    postSubmit: postSubmit.bind(this),\n    fields: this.fields, \n    card_display: this.card_display, \n    addRelative: null,\n    onCancel: () => {},\n    editFirst: this.editFirst,\n    ...props\n  });\n\n  form_creator.no_edit = this.no_edit;\n  const form_cont = f3.handlers.formInfoSetup(form_creator, this.closeForm.bind(this));\n\n  this.form_cont.innerHTML = '';\n  this.form_cont.appendChild(form_cont);\n\n  this.openForm();\n\n  function postSubmit(props) {\n    if (this.addRelativeInstance.is_active) this.addRelativeInstance.onChange(datum);\n    else if (!props?.delete) this.openFormWithId(datum.id);\n\n    if (!this.is_fixed) this.closeForm();\n    \n    this.store.updateTree({});\n\n    this.updateHistory();\n  }\n};\n\nEditTree.prototype.openForm = function() {\n  d3.select(this.form_cont).classed('opened', true);\n};\n\nEditTree.prototype.closeForm = function() {\n  d3.select(this.form_cont).classed('opened', false).html('');\n  this.store.updateTree({});\n};\n\nEditTree.prototype.fixed = function() {\n  this.is_fixed = true;\n  d3.select(this.form_cont).style('position', 'relative');\n\n  return this\n};\n\nEditTree.prototype.absolute = function() {\n  this.is_fixed = false;\n  d3.select(this.form_cont).style('position', 'absolute');\n\n  return this\n};\n\nEditTree.prototype.setCardClickOpen = function(card) {\n  card.setOnCardClick((e, d) => {\n    if (this.addRelativeInstance.is_active) {\n      this.open(d);\n      return\n    }\n    this.open(d);\n    this.store.updateMainId(d.data.id);\n    this.store.updateTree({});\n  });\n\n  return this\n};\n\nEditTree.prototype.openFormWithId = function(d_id) {\n  if (d_id) {\n    const d = this.store.getDatum(d_id);\n    this.openWithoutRelCancel({data: d});\n  } else {\n    const d = this.store.getMainDatum();\n    this.openWithoutRelCancel({data: d});\n  }\n};\n\nEditTree.prototype.createHistory = function() {\n  this.history = f3.handlers.createHistory(this.store, this.getStoreData.bind(this), historyUpdateTree.bind(this));\n  this.history.controls = f3.handlers.createHistoryControls(this.cont, this.history);\n  this.history.changed();\n  this.history.controls.updateButtons();\n\n  return this\n\n  function historyUpdateTree() {\n    if (this.addRelativeInstance.is_active) this.addRelativeInstance.onCancel();\n    this.store.updateTree({initial: false});\n    this.history.controls.updateButtons();\n    this.openFormWithId(this.store.getMainDatum()?.id);\n  }\n};\n\nEditTree.prototype.setNoEdit = function() {\n  this.no_edit = true;\n\n  return this\n};\n\nEditTree.prototype.setEdit = function() {\n  this.no_edit = false;\n\n  return this\n};\n\nEditTree.prototype.setFields = function(fields) {\n  const new_fields = [];\n  if (!Array.isArray(fields)) {\n    console.error('fields must be an array');\n    return this\n  }\n  for (const field of fields) {\n    if (typeof field === 'string') {\n      new_fields.push({type: 'text', label: field, id: field});\n    } else if (typeof field === 'object') {\n      if (!field.id) {\n        console.error('fields must be an array of objects with id property');\n      } else {\n        new_fields.push(field);\n      }\n    } else {\n      console.error('fields must be an array of strings or objects');\n    }\n  }\n  this.fields = new_fields;\n\n  return this\n};\n\nEditTree.prototype.setOnChange = function(fn) {\n  this.onChange = fn;\n\n  return this\n};\n\nEditTree.prototype.addRelative = function(datum) {\n  if (!datum) datum = this.store.getMainDatum();\n  this.addRelativeInstance.activate(datum);\n\n  return this\n\n};\n\nEditTree.prototype.setupAddRelative = function() {\n  return addRelative(this.store, cancelCallback.bind(this), onSubmitCallback.bind(this))\n\n  function onSubmitCallback(datum, new_rel_datum) {\n    this.store.updateMainId(datum.id);\n    this.openFormWithId(datum.id);\n  }\n\n  function cancelCallback(datum) {\n    this.store.updateMainId(datum.id);\n    this.store.updateTree({});\n    this.openFormWithId(datum.id);\n  }\n};\n\nEditTree.prototype.setEditFirst = function(editFirst) {\n  this.editFirst = editFirst;\n\n  return this\n};\n\nEditTree.prototype.isAddingRelative = function() {\n  return this.addRelativeInstance.is_active\n};\n\nEditTree.prototype.setAddRelLabels = function(add_rel_labels) {\n  this.addRelativeInstance.setAddRelLabels(add_rel_labels);\n  return this\n};\n\nEditTree.prototype.getStoreData = function() {\n  if (this.addRelativeInstance.is_active) return this.addRelativeInstance.getStoreData()\n  else return this.store.getData()\n};\n\nEditTree.prototype.getDataJson = function(fn) {\n  const data = this.getStoreData();\n  return f3.handlers.cleanupDataJson(JSON.stringify(data))\n};\n\nEditTree.prototype.updateHistory = function() {\n  if (this.history) {\n    this.history.changed();\n    this.history.controls.updateButtons();\n  }\n\n  if (this.onChange) this.onChange();\n};\n\n\n\nEditTree.prototype.destroy = function() {\n  this.history.controls.destroy();\n  this.history = null;\n  d3.select(this.cont).select('.f3-form-cont').remove();\n  if (this.addRelativeInstance.onCancel) this.addRelativeInstance.onCancel();\n  this.store.updateTree({});\n\n  return this\n};\n\nfunction createChart(...args) { return new CreateChart(...args) }\n\nfunction CreateChart(cont, data) {\n  this.cont = null;\n  this.store = null;\n  this.svg = null;\n  this.getCard = null;\n  this.node_separation = 250;\n  this.level_separation = 150;\n  this.transition_time = 2000;\n\n  this.is_card_html = false;\n\n  this.beforeUpdate = null;\n  this.afterUpdate = null;\n\n  this.init(cont, data);\n\n  return this\n}\n\nCreateChart.prototype.init = function(cont, data) {\n  this.cont = cont = setCont(cont);\n  const getSvgView = () => cont.querySelector('svg .view');\n  const getHtmlSvg = () => cont.querySelector('#htmlSvg');\n  const getHtmlView = () => cont.querySelector('#htmlSvg .cards_view');\n\n  this.svg = f3.createSvg(cont, {onZoom: f3.htmlHandlers.onZoomSetup(getSvgView, getHtmlView)});\n  f3.htmlHandlers.createHtmlSvg(cont);\n\n  this.store = f3.createStore({\n    data,\n    node_separation: this.node_separation,\n    level_separation: this.level_separation\n  });\n\n  this.setCard(f3.CardSvg); // set default card\n\n  this.store.setOnUpdate(props => {\n    if (this.beforeUpdate) this.beforeUpdate(props);\n    props = Object.assign({}, props || {}, {transition_time: this.transition_time});\n    if (this.is_card_html) props = Object.assign({}, props || {}, {cardHtml: getHtmlSvg()});\n    f3.view(this.store.getTree(), this.svg, this.getCard(), props || {});\n    if (this.afterUpdate) this.afterUpdate(props);\n  });\n};\n\nCreateChart.prototype.updateTree = function({initial=false} = {}) {\n  this.store.updateTree({initial});\n\n  return this\n};\n\nCreateChart.prototype.updateData = function(data) {\n  this.store.updateData(data);\n\n  return this\n};\n\nCreateChart.prototype.setCardYSpacing = function(card_y_spacing) {\n  if (typeof card_y_spacing !== 'number') {\n    console.error('card_y_spacing must be a number');\n    return this\n  }\n  this.store.state.level_separation = card_y_spacing;\n\n  return this\n};\n\nCreateChart.prototype.setCardXSpacing = function(card_x_spacing) {\n  if (typeof card_x_spacing !== 'number') {\n    console.error('card_x_spacing must be a number');\n    return this\n  }\n  this.store.state.node_separation = card_x_spacing;\n\n  return this\n};\n\nCreateChart.prototype.setCard = function(Card) {\n  this.is_card_html = Card.is_html;\n\n  if (this.is_card_html) {\n    this.svg.querySelector('.cards_view').innerHTML = '';\n    this.cont.querySelector('#htmlSvg').style.display = 'block';\n  } else {\n    this.cont.querySelector('#htmlSvg .cards_view').innerHTML = '';\n    this.cont.querySelector('#htmlSvg').style.display = 'none';\n  }\n\n  const card = Card(this.cont, this.store);\n  this.getCard = () => card.getCard();\n\n  return card\n};\n\nCreateChart.prototype.setTransitionTime = function(transition_time) {\n  this.transition_time = transition_time;\n\n  return this\n};\n\nCreateChart.prototype.editTree = function() {\n  return editTree(this.cont, this.store)\n};\n\nCreateChart.prototype.updateMain = function(d) {\n  this.store.updateMainId(d.data.id);\n  this.store.updateTree({});\n\n  return this\n};\n\nCreateChart.prototype.updateMainId = function(id) {\n  this.store.updateMainId(id);\n\n  return this\n};\n\nCreateChart.prototype.getMainDatum = function() {\n  return this.store.getMainDatum()\n};\n\nCreateChart.prototype.getDataJson = function(fn) {\n  const data = this.store.getData();\n  return f3.handlers.cleanupDataJson(JSON.stringify(data))\n};\n\nCreateChart.prototype.updateData = function(data) {\n  this.store.updateData(data);\n};\n\nCreateChart.prototype.setBeforeUpdate = function(fn) {\n  this.beforeUpdate = fn;\n  return this\n};\n\nCreateChart.prototype.setAfterUpdate = function(fn) {\n  this.afterUpdate = fn;\n  return this\n};\n\nfunction setCont(cont) {\n  if (typeof cont === \"string\") cont = document.querySelector(cont);\n  return cont\n}\n\nfunction processCardDisplay(card_display) {\n  const card_display_arr = [];\n  if (Array.isArray(card_display)) {\n    card_display.forEach(d => {\n      if (typeof d === 'function') {\n        card_display_arr.push(d);\n      } else if (typeof d === 'string') {\n        card_display_arr.push(d1 => d1.data[d]);\n      } else if (Array.isArray(d)) {\n        card_display_arr.push(d1 => d.map(d2 => d1.data[d2]).join(' '));\n      }\n    });\n  } else if (typeof card_display === 'function') {\n    card_display_arr.push(card_display);\n  } else if (typeof card_display === 'string') {\n    card_display_arr.push(d1 => d1.data[card_display]);\n  }\n  return card_display_arr\n}\n\nCardSvgWrapper.is_html = false;\nfunction CardSvgWrapper(...args) { return new CardSvg(...args) }\n\nfunction CardSvg(cont, store) {\n  this.cont = cont;\n  this.store = store;\n  this.svg = null;\n  this.getCard = null;\n  this.card_dim = {w:220,h:70,text_x:75,text_y:15,img_w:60,img_h:60,img_x:5,img_y:5};\n  this.card_display = [d => `${d.data[\"first name\"]} ${d.data[\"last name\"]}`];\n  this.mini_tree = true;\n  this.link_break = false;\n  this.onCardClick = this.onCardClickDefault;\n  this.onCardUpdate = null;\n  this.onCardUpdates = null;\n\n  this.init();\n\n  return this\n}\n\nCardSvg.prototype.init = function() {\n  this.svg = this.cont.querySelector('svg.main_svg');\n\n  this.getCard = () => f3.elements.Card({\n    store: this.store,\n    svg: this.svg,\n    card_dim: this.card_dim,\n    card_display: this.card_display,\n    mini_tree: this.mini_tree,\n    link_break: this.link_break,\n    onCardClick: this.onCardClick,\n    onCardUpdate: this.onCardUpdate,\n    onCardUpdates: this.onCardUpdates\n  });\n};\n\nCardSvg.prototype.setCardDisplay = function(card_display) {\n  this.card_display = processCardDisplay(card_display);\n\n  return this\n};\n\nCardSvg.prototype.setCardDim = function(card_dim) {\n  if (typeof card_dim !== 'object') {\n    console.error('card_dim must be an object');\n    return this\n  }\n  for (let key in card_dim) {\n    const val = card_dim[key];\n    if (typeof val !== 'number') {\n      console.error(`card_dim.${key} must be a number`);\n      return this\n    }\n    if (key === 'width') key = 'w';\n    if (key === 'height') key = 'h';\n    this.card_dim[key] = val;\n  }\n\n  updateCardSvgDefs(this.svg, this.card_dim);\n\n  return this\n};\n\nCardSvg.prototype.setMiniTree = function(mini_tree) {\n  this.mini_tree = mini_tree;\n\n  return this\n};\n\nCardSvg.prototype.setLinkBreak = function(link_break) {\n  this.link_break = link_break;\n\n  return this\n};\n\nCardSvg.prototype.setCardTextSvg = function(cardTextSvg) {\n  function onCardUpdate(d) {\n    const card_node = d3.select(this);\n    const card_text = card_node.select('.card-text text');\n    const card_text_g = card_text.node().parentNode;\n    card_text_g.innerHTML = cardTextSvg(d.data);\n  }\n  onCardUpdate.id = 'setCardTextSvg';\n  if (!this.onCardUpdates) this.onCardUpdates = [];\n  this.onCardUpdates = this.onCardUpdates.filter(fn => fn.id !== 'setCardTextSvg');\n  this.onCardUpdates.push(onCardUpdate);\n\n  return this\n};\n\nCardSvg.prototype.onCardClickDefault = function(e, d) {\n  this.store.updateMainId(d.data.id);\n  this.store.updateTree({});\n};\n\nCardSvg.prototype.setOnCardClick = function(onCardClick) {\n  this.onCardClick = onCardClick;\n\n  return this\n};\n\nCardHtmlWrapper.is_html = true;\nfunction CardHtmlWrapper(...args) { return new CardHtml$1(...args) }\n\nCardHtml$1.prototype.is_html = true;\nfunction CardHtml$1(cont, store) {\n  this.cont = cont;\n  this.store = store;\n  this.getCard = null;\n  this.card_display = [d => `${d.data[\"first name\"]} ${d.data[\"last name\"]}`];\n  this.onCardClick = this.onCardClickDefault;\n  this.style = 'default';\n  this.mini_tree = false;\n  this.onCardUpdate = null;\n  this.card_dim = {};\n\n  this.init();\n\n  return this\n}\n\nCardHtml$1.prototype.init = function() {\n  this.svg = this.cont.querySelector('svg.main_svg');\n\n  this.getCard = () => f3.elements.CardHtml({\n    store: this.store,\n    card_display: this.card_display,\n    onCardClick: this.onCardClick,\n    style: this.style,\n    mini_tree: this.mini_tree,\n    onCardUpdate: this.onCardUpdate,\n    card_dim: this.card_dim,\n    onCardMouseenter: this.onCardMouseenter ? this.onCardMouseenter.bind(this) : null,\n    onCardMouseleave: this.onCardMouseleave ? this.onCardMouseleave.bind(this) : null\n  });\n};\n\nCardHtml$1.prototype.setCardDisplay = function(card_display) {\n  this.card_display = processCardDisplay(card_display);\n\n  return this\n};\n\nCardHtml$1.prototype.setOnCardClick = function(onCardClick) {\n  this.onCardClick = onCardClick;\n  return this\n};\n\nCardHtml$1.prototype.onCardClickDefault = function(e, d) {\n  this.store.updateMainId(d.data.id);\n  this.store.updateTree({});\n};\n\nCardHtml$1.prototype.setStyle = function(style) {\n  this.style = style;\n  return this\n};\n\nCardHtml$1.prototype.setMiniTree = function(mini_tree) {\n  this.mini_tree = mini_tree;\n\n  return this\n};\n\nCardHtml$1.prototype.setOnCardUpdate = function(onCardUpdate) {\n  this.onCardUpdate = onCardUpdate;\n  return this\n};\n\nCardHtml$1.prototype.setCardDim = function(card_dim) {\n  if (typeof card_dim !== 'object') {\n    console.error('card_dim must be an object');\n    return this\n  }\n  for (let key in card_dim) {\n    const val = card_dim[key];\n    if (typeof val !== 'number' && typeof val !== 'boolean') {\n      console.error(`card_dim.${key} must be a number or boolean`);\n      return this\n    }\n    if (key === 'width') key = 'w';\n    if (key === 'height') key = 'h';\n    if (key === 'img_width') key = 'img_w';\n    if (key === 'img_height') key = 'img_h';\n    if (key === 'img_x') key = 'img_x';\n    if (key === 'img_y') key = 'img_y';\n    this.card_dim[key] = val;\n  }\n\n  return this\n};\n\nCardHtml$1.prototype.resetCardDim = function() {\n  this.card_dim = {};\n  return this\n};\n\nCardHtml$1.prototype.setOnHoverPathToMain = function() {\n  this.onCardMouseenter = this.onEnterPathToMain.bind(this);\n  this.onCardMouseleave = this.onLeavePathToMain.bind(this);\n  return this\n};\n\nCardHtml$1.prototype.unsetOnHoverPathToMain = function() {\n  this.onCardMouseenter = null;\n  this.onCardMouseleave = null;\n  return this\n};\n\nCardHtml$1.prototype.onEnterPathToMain = function(e, datum) {\n  this.to_transition = datum.data.id;\n  const main_datum = this.store.getTreeMainDatum();\n  const cards = d3.select(this.cont).select('div.cards_view').selectAll('.card_cont');\n  const links = d3.select(this.cont).select('svg.main_svg .links_view').selectAll('.link');\n  const [cards_node_to_main, links_node_to_main] = pathToMain(cards, links, datum, main_datum);\n  cards_node_to_main.forEach(d => {\n    const delay = Math.abs(datum.depth - d.card.depth) * 200;\n    d3.select(d.node.querySelector('div.card-inner'))\n      .transition().duration(0).delay(delay)\n      .on('end', () => this.to_transition === datum.data.id && d3.select(d.node.querySelector('div.card-inner')).classed('f3-path-to-main', true));\n  });\n  links_node_to_main.forEach(d => {\n    const delay = Math.abs(datum.depth - d.link.depth) * 200;\n    d3.select(d.node)\n      .transition().duration(0).delay(delay)\n      .on('end', () => this.to_transition === datum.data.id && d3.select(d.node).classed('f3-path-to-main', true));\n  });\n\n  return this\n};\n\nCardHtml$1.prototype.onLeavePathToMain = function(e, d) {\n  this.to_transition = false;\n  d3.select(this.cont).select('div.cards_view').selectAll('div.card-inner').classed('f3-path-to-main', false);\n  d3.select(this.cont).select('svg.main_svg .links_view').selectAll('.link').classed('f3-path-to-main', false);\n\n  return this\n};\n\nvar f3 = {\n  CalculateTree,\n  createStore,\n  view,\n  createSvg,\n  handlers,\n  elements,\n  htmlHandlers,\n  icons,\n  createChart,\n\n  CardSvg: CardSvgWrapper,\n  CardHtml: CardHtmlWrapper,\n};\n\nreturn f3;\n\n})));\n","export { default } from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&lang=css\"; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../node_modules/vue-loader-v16/dist/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./App.vue?vue&type=style&index=0&lang=css\""],"sourceRoot":""}